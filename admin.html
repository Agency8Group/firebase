<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>0000ì…€ëŸ¬ ì£¼ë¬¸ ê´€ë¦¬ì í˜ì´ì§€</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <style>
            * {
                box-sizing: border-box;
            }

            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background-color: #f8f9fa;
                line-height: 1.45;
                -webkit-text-size-adjust: 100%;
            }

            .header {
                background: white;
                padding: 28px;
                border-radius: 16px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                margin-bottom: 24px;
                border: 1px solid #f1f3f4;
            }

            .header h1 {
                margin: 0 0 20px 0;
                color: #212529;
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 24px;
                font-weight: 600;
            }

            .header-stats {
                display: flex;
                gap: 32px;
                margin-bottom: 20px;
                padding: 20px;
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 12px;
                color: #333;
            }

            .stats-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                flex: 1;
            }

            .stats-item .stats-label {
                font-size: 13px;
                color: #6c757d;
                margin-bottom: 6px;
                font-weight: 500;
            }

            .stats-item .stats-number {
                font-size: 24px;
                font-weight: 700;
                color: #212529;
            }

            .status-bar {
                display: flex;
                justify-content: flex-end;
                align-items: center;
            }

            .status-indicator {
                display: inline-block;
                width: 16px;
                height: 16px;
                border-radius: 50%;
                margin-left: 12px;
                vertical-align: middle;
                border: 2px solid #ddd;
                animation: pulse 2s infinite;
            }

            .status-indicator.connected {
                background-color: #28a745;
                border-color: #28a745;
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
                animation: pulse 2s infinite;
            }

            .status-indicator.disconnected {
                background-color: #dc3545;
                border-color: #dc3545;
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
                animation: pulse-disconnected 2s infinite;
            }

            @keyframes pulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
                }
            }

            @keyframes pulse-disconnected {
                0% {
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
                }
            }

            .controls {
                display: flex;
                gap: 10px;
            }

            .btn {
                padding: 12px 20px;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                min-height: 44px;
                transition: all 0.2s ease;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
                font-weight: 500;
            }

            .btn-primary {
                background-color: #007bff;
                color: white;
            }

            .btn-primary:hover {
                background-color: #0056b3;
                transform: translateY(-1px);
            }

            .btn-success {
                background-color: #28a745;
                color: white;
            }

            .btn-success:hover {
                background-color: #1e7e34;
                transform: translateY(-1px);
            }

            .btn-warning {
                background-color: #ffc107;
                color: #212529;
            }

            .btn-warning:hover {
                background-color: #e0a800;
                transform: translateY(-1px);
            }

            .main-content {
                display: block;
                width: 100%;
            }

            .orders-section {
                background: white;
                border-radius: 16px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                overflow: hidden;
                border: 1px solid #f1f3f4;
            }

            .section-header {
                padding: 24px;
                border-bottom: 1px solid #f1f3f4;
                background-color: #fafbfc;
            }

            .section-header h2 {
                margin: 0;
                color: #212529;
                font-size: 18px;
                font-weight: 600;
            }

            .filters {
                display: flex;
                flex-direction: column;
                gap: 12px;
                margin-top: 10px;
            }

            .search-fields {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }

            .search-input {
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 14px;
                min-width: 200px;
                flex: 1;
            }

            .search-input:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
            }

            .filter-selects {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }

            .filter-select {
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 14px;
            }

            .table-container {
                overflow-x: auto;
                max-height: 600px;
                overflow-y: auto;
            }

            .orders-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 14px;
            }

            .orders-table th {
                background-color: #f8f9fa;
                border: 1px solid #dee2e6;
                padding: 12px 8px;
                text-align: left;
                font-weight: 600;
                color: #495057;
                position: sticky;
                top: 0;
                z-index: 10;
            }

            .orders-table td {
                border: 1px solid #dee2e6;
                padding: 8px;
                vertical-align: top;
            }

            .status-badge {
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 12px;
                font-weight: 500;
            }

            .status-ì ‘ìˆ˜ {
                background-color: #fff3cd;
                color: #856404;
            }

            .status-ë°°ì†¡ì¤‘ {
                background-color: #d1ecf1;
                color: #0c5460;
            }

            .status-ë°°ì†¡ì™„ë£Œ {
                background-color: #d4edda;
                color: #155724;
            }

            .status-ì·¨ì†Œ {
                background-color: #f5c6cb;
                color: #721c24;
            }

            .order-type-badge {
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 11px;
                font-weight: 500;
                background-color: #e3f2fd;
                color: #1976d2;
            }

            .status-select {
                padding: 4px 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 12px;
            }

            .sidebar {
                background: white;
                border-radius: 16px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                padding: 24px;
                border: 1px solid #f1f3f4;
            }

            .recent-orders {
                margin-top: 20px;
            }

            .recent-orders h3 {
                margin: 0 0 16px 0;
                color: #212529;
                font-size: 16px;
                font-weight: 600;
            }

            .recent-order-item {
                padding: 12px;
                border: 1px solid #f1f3f4;
                border-radius: 8px;
                margin-bottom: 12px;
                background-color: #fafbfc;
                transition: all 0.2s ease;
            }

            .recent-order-item:hover {
                border-color: #e1e5e9;
                background-color: #f8f9fa;
            }

            /* SVG Icon Styles */
            .inline-icon {
                width: 18px;
                height: 18px;
                vertical-align: middle;
                margin-right: 6px;
            }

            .recent-order-item h4 {
                margin: 0 0 5px 0;
                font-size: 14px;
                color: #333;
            }

            .recent-order-item p {
                margin: 0;
                font-size: 12px;
                color: #666;
            }

            /* ìë™ ì‚­ì œ ê²½ê³  ìŠ¤íƒ€ì¼ */
            .auto-delete-warning {
                display: flex;
                align-items: center;
                gap: 8px;
                background-color: #fff3cd;
                border: 1px solid #ffeaa7;
                border-radius: 8px;
                padding: 12px 16px;
                margin-top: 12px;
                color: #856404;
                font-size: 14px;
                line-height: 1.4;
            }

            .auto-delete-warning .inline-icon {
                flex-shrink: 0;
                width: 20px;
                height: 20px;
            }

            .auto-delete-warning span {
                flex: 1;
            }

            /* ì¼ê´„ ì²˜ë¦¬ ë„êµ¬ ìŠ¤íƒ€ì¼ */
            .bulk-actions {
                background-color: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                padding: 16px;
                margin-bottom: 16px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-wrap: wrap;
                gap: 12px;
            }

            .bulk-actions-info {
                font-weight: 600;
                color: #495057;
            }

            .bulk-actions-buttons {
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
            }

            .btn-sm {
                padding: 8px 12px;
                font-size: 12px;
                min-height: 36px;
            }

            /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
            .order-checkbox {
                width: 16px;
                height: 16px;
                cursor: pointer;
            }

            #selectAll {
                width: 16px;
                height: 16px;
                cursor: pointer;
            }

            @media (max-width: 768px) {
                body {
                    padding: 8px;
                    font-size: 13px;
                }

                .header {
                    padding: 12px;
                    border-radius: 12px;
                }

                .header h1 {
                    font-size: 20px;
                    margin-bottom: 16px;
                }

                .header-stats {
                    flex-direction: column;
                    gap: 10px;
                    padding: 12px;
                }

                .stats-item {
                    flex-direction: row;
                    justify-content: space-between;
                    width: 100%;
                }

                .stats-item .stats-number {
                    font-size: 16px;
                }

                .stats-item .stats-label {
                    font-size: 11px;
                }

                .main-content {
                    grid-template-columns: 1fr;
                    gap: 12px;
                }

                .filters {
                    flex-direction: column;
                    gap: 8px;
                }

                .search-fields {
                    flex-direction: column;
                    gap: 8px;
                }

                .search-input {
                    min-width: auto;
                    width: 100%;
                }

                .filter-selects {
                    flex-direction: column;
                    gap: 8px;
                }

                .controls {
                    flex-direction: column;
                    gap: 8px;
                }

                .orders-table {
                    font-size: 11px;
                }

                .orders-table th,
                .orders-table td {
                    padding: 4px 2px;
                }

                .btn {
                    padding: 8px 12px;
                    min-height: 40px;
                    font-size: 13px;
                }
            }

            /* Simple Footer */
            .simple-footer {
                margin-top: 40px;
                padding: 20px 0;
                text-align: center;
                border-top: 1px solid #e9ecef;
            }

            .simple-footer a {
                color: #6c757d;
                text-decoration: none;
                font-size: 12px;
                transition: color 0.2s ease;
            }

            .simple-footer a:hover {
                color: #495057;
            }
        </style>
    </head>
    <body>
        <!-- ìƒë‹¨ í‘¸í„° -->
        <div
            class="top-footer"
            style="
                background: #f8f9fa;
                border-bottom: 1px solid #e9ecef;
                padding: 8px 0;
                text-align: center;
                position: sticky;
                top: 0;
                z-index: 1000;
            "
        >
            <a
                href="https://cx-tech-builder.netlify.app/"
                target="_blank"
                style="
                    color: #6c757d;
                    text-decoration: none;
                    font-size: 12px;
                    transition: color 0.2s ease;
                "
            >
                Powered by CX Tech Builder
            </a>
        </div>

        <div class="header">
            <h1>
                <svg
                    class="inline-icon"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                >
                    <path
                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                    />
                </svg>
                0000ì…€ëŸ¬ ì£¼ë¬¸ ì ‘ìˆ˜ ê´€ë¦¬ì<span
                    id="status"
                    class="status-indicator disconnected"
                ></span>
            </h1>
            <div class="header-stats">
                <div class="stats-item">
                    <span class="stats-label">ì˜¤ëŠ˜ ì‹ ê·œì£¼ë¬¸</span>
                    <span class="stats-number" id="todayNewOrders">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">êµí™˜ì ‘ìˆ˜ìš”ì²­</span>
                    <span class="stats-number" id="todayExchangeRequests"
                        >0</span
                    >
                </div>
                <div class="stats-item">
                    <span class="stats-label">ë°˜í’ˆì ‘ìˆ˜ìš”ì²­</span>
                    <span class="stats-number" id="todayReturnRequests">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">ì·¨ì†Œìš”ì²­</span>
                    <span class="stats-number" id="todayCancelRequests">0</span>
                </div>
            </div>
            <div class="status-bar">
                <div class="controls">
                    <button
                        class="btn btn-warning"
                        onclick="filterNewOrdersInProgress()"
                    >
                        <svg
                            class="inline-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                        >
                            <path
                                d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                            />
                        </svg>
                        ì‹ ê·œì£¼ë¬¸ ì§„í–‰ì¤‘
                    </button>
                    <button
                        class="btn btn-info"
                        onclick="filterExchangeReturnInProgress()"
                    >
                        <svg
                            class="inline-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                        >
                            <path
                                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"
                            />
                        </svg>
                        êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ì§„í–‰ì¤‘
                    </button>
                    <button class="btn btn-secondary" onclick="showAllOrders()">
                        <svg
                            class="inline-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                        >
                            <path
                                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"
                            />
                        </svg>
                        ì „ì²´ ë³´ê¸°
                    </button>
                    <button class="btn btn-success" onclick="exportToExcelAI()">
                        <svg
                            class="inline-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                        >
                            <path
                                d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"
                            />
                        </svg>
                        AI ë³€í™˜ìš© ë‚´ë³´ë‚´ê¸°(ì—‘ì…€)
                    </button>
                    <button class="btn btn-info" onclick="exportToExcelFull()">
                        <svg
                            class="inline-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                        >
                            <path
                                d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"
                            />
                        </svg>
                        ì†¡ì¥ í¬í•¨ ì „ì²´ ë‚´ë³´ë‚´ê¸°(ì—‘ì…€)
                    </button>
                    <button class="btn btn-primary" onclick="refreshOrders()">
                        <svg
                            class="inline-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                        >
                            <path
                                d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"
                            />
                        </svg>
                        ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button
                        class="btn btn-outline"
                        onclick="openInvoiceUploadModal()"
                    >
                        <svg
                            class="inline-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                        >
                            <path
                                d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"
                            />
                        </svg>
                        ì†¡ì¥ ì—…ë¡œë“œ
                    </button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="orders-section">
                <div class="section-header">
                    <h2>
                        <svg
                            class="inline-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                        >
                            <path
                                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"
                            />
                        </svg>
                        ì£¼ë¬¸ ëª©ë¡
                    </h2>
                    <div class="auto-delete-warning">
                        <svg
                            class="inline-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                            style="color: #dc3545"
                        >
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                            />
                        </svg>
                        <span
                            >âš ï¸ ì£¼ë¬¸ ë°ì´í„°ëŠ” 7ì¼ì´ ì§€ë‚˜ë©´ ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
                            <span
                                id="deletionDateInfo"
                                style="font-weight: bold; color: #e74c3c"
                            ></span>
                            ì¤‘ìš”í•œ ë°ì´í„°ëŠ” Excelë¡œ ë‹¤ìš´ë¡œë“œí•˜ì—¬
                            ë°±ì—…í•˜ì„¸ìš”.</span
                        >
                    </div>
                    <div
                        class="auto-complete-info"
                        style="
                            margin-top: 8px;
                            padding: 8px 12px;
                            background: #f8f9fa;
                            font-size: 12px;
                            color: #6c757d;
                        "
                    >
                        <svg
                            class="inline-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                            style="color: #6c757d"
                        >
                            <path
                                d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                            />
                        </svg>
                        <span
                            >âœ… ì†¡ì¥ë²ˆí˜¸ ë“±ë¡ í›„ 3ì˜ì—…ì¼(ì£¼ë§/ê³µíœ´ì¼ ì œì™¸)ì´
                            ì§€ë‚˜ë©´ ìë™ìœ¼ë¡œ ë°°ì†¡ì™„ë£Œ ì²˜ë¦¬ë©ë‹ˆë‹¤.</span
                        >
                    </div>

                    <!-- ì†¡ì¥ ì—…ë¡œë“œ ëª¨ë‹¬ -->
                    <div
                        id="invoiceUploadModal"
                        style="
                            display: none;
                            position: fixed;
                            inset: 0;
                            background: rgba(0, 0, 0, 0.4);
                            align-items: center;
                            justify-content: center;
                            z-index: 2000;
                        "
                    >
                        <div
                            style="
                                background: #fff;
                                padding: 20px;
                                border-radius: 10px;
                                width: 420px;
                                max-width: 90%;
                            "
                        >
                            <h3 style="margin-top: 0">ì†¡ì¥ë²ˆí˜¸ ì—…ë¡œë“œ</h3>
                            <p style="color: #666; font-size: 13px">
                                ì—‘ì…€ ì–‘ì‹: ì£¼ë¬¸ë²ˆí˜¸ / íƒë°°ì‚¬ / ì†¡ì¥ë²ˆí˜¸
                            </p>
                            <div
                                style="
                                    display: flex;
                                    gap: 8px;
                                    margin: 10px 0 16px;
                                "
                            >
                                <button
                                    class="btn btn-secondary btn-sm"
                                    onclick="downloadInvoiceTemplate()"
                                >
                                    ì–‘ì‹ ë‚´ë ¤ë°›ê¸°
                                </button>
                                <label
                                    class="btn btn-primary btn-sm"
                                    style="cursor: pointer"
                                >
                                    íŒŒì¼ ì„ íƒ
                                    <input
                                        id="invoiceFileInput"
                                        type="file"
                                        accept=".xlsx,.xls"
                                        style="display: none"
                                        onchange="previewInvoiceFile()"
                                    />
                                </label>
                                <button
                                    id="uploadBtn"
                                    class="btn btn-success btn-sm"
                                    onclick="startInvoiceImport()"
                                    disabled
                                >
                                    ì—…ë¡œë“œ
                                </button>
                            </div>
                            <div
                                id="invoiceImportStatus"
                                style="font-size: 12px; color: #555"
                            ></div>
                            <div
                                id="invoicePreview"
                                style="
                                    margin: 10px 0;
                                    padding: 10px;
                                    background: #f8f9fa;
                                    border-radius: 4px;
                                    display: none;
                                "
                            ></div>
                            <div style="text-align: right; margin-top: 12px">
                                <button
                                    class="btn"
                                    onclick="closeInvoiceUploadModal()"
                                >
                                    ë‹«ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="filters">
                        <div class="search-fields">
                            <input
                                type="text"
                                id="phoneSearch"
                                class="search-input"
                                placeholder="íœ´ëŒ€í°ë²ˆí˜¸ ê²€ìƒ‰"
                                onkeyup="filterOrders()"
                            />
                            <input
                                type="text"
                                id="orderNumberSearch"
                                class="search-input"
                                placeholder="ì£¼ë¬¸ë²ˆí˜¸ ê²€ìƒ‰"
                                onkeyup="filterOrders()"
                            />
                        </div>

                        <div class="filter-selects">
                            <select
                                id="orderTypeFilter"
                                class="filter-select"
                                onchange="filterOrders()"
                            >
                                <option value="">ì „ì²´ ì£¼ë¬¸ìœ í˜•</option>
                                <option value="ì‹ ê·œì£¼ë¬¸">ì‹ ê·œì£¼ë¬¸</option>
                                <option value="êµí™˜">êµí™˜</option>
                                <option value="ë°˜í’ˆ">ë°˜í’ˆ</option>
                                <option value="ì·¨ì†Œ">ì·¨ì†Œ</option>
                            </select>
                            <select
                                id="statusFilter"
                                class="filter-select"
                                onchange="filterOrders()"
                            >
                                <option value="">ì „ì²´ ë°°ì†¡ìƒíƒœ</option>
                                <option value="ì ‘ìˆ˜">ì ‘ìˆ˜</option>
                                <option value="ë°°ì†¡ì¤‘">ë°°ì†¡ì¤‘</option>
                                <option value="ë°°ì†¡ì™„ë£Œ">ë°°ì†¡ì™„ë£Œ</option>
                                <option value="ì·¨ì†Œ">ì·¨ì†Œ</option>
                            </select>
                            <select
                                id="dateFilter"
                                class="filter-select"
                                onchange="filterOrders()"
                            >
                                <option value="">ì „ì²´ ê¸°ê°„</option>
                                <option value="today" selected>ì˜¤ëŠ˜</option>
                                <option value="week">ì´ë²ˆ ì£¼</option>
                            </select>
                            <select
                                id="itemsPerPageFilter"
                                class="filter-select"
                                onchange="changeItemsPerPage(this.value)"
                            >
                                <option value="30" selected>30ê°œì”© ë³´ê¸°</option>
                                <option value="50">50ê°œì”© ë³´ê¸°</option>
                                <option value="100">100ê°œì”© ë³´ê¸°</option>
                            </select>
                            <button
                                class="btn btn-primary btn-sm"
                                onclick="refreshOrders()"
                            >
                                <svg
                                    class="inline-icon"
                                    viewBox="0 0 24 24"
                                    fill="currentColor"
                                >
                                    <path
                                        d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"
                                    />
                                </svg>
                                ìƒˆë¡œê³ ì¹¨
                            </button>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <!-- ì¼ê´„ ì²˜ë¦¬ ë„êµ¬ -->
                    <div class="bulk-actions" style="display: none">
                        <div class="bulk-actions-info">
                            <span id="selectedCount">0ê°œ ì„ íƒë¨</span>
                        </div>
                        <div class="bulk-actions-buttons">
                            <button
                                class="btn btn-success btn-sm"
                                onclick="bulkUpdateStatus('ë°°ì†¡ì™„ë£Œ')"
                            >
                                <svg
                                    class="inline-icon"
                                    viewBox="0 0 24 24"
                                    fill="currentColor"
                                >
                                    <path
                                        d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                                    />
                                </svg>
                                ì„ íƒëœ ì£¼ë¬¸ ë°°ì†¡ì™„ë£Œ
                            </button>
                            <button
                                class="btn btn-warning btn-sm"
                                onclick="bulkUpdateStatus('ë°°ì†¡ì¤‘')"
                            >
                                <svg
                                    class="inline-icon"
                                    viewBox="0 0 24 24"
                                    fill="currentColor"
                                >
                                    <path
                                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                                    />
                                </svg>
                                ì„ íƒëœ ì£¼ë¬¸ ë°°ì†¡ì¤‘
                            </button>
                            <button
                                class="btn btn-danger btn-sm"
                                onclick="bulkUpdateStatus('ì·¨ì†Œ')"
                            >
                                <svg
                                    class="inline-icon"
                                    viewBox="0 0 24 24"
                                    fill="currentColor"
                                >
                                    <path
                                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                    />
                                </svg>
                                ì„ íƒëœ ì£¼ë¬¸ ì·¨ì†Œ
                            </button>
                        </div>
                    </div>

                    <table class="orders-table" id="ordersTable">
                        <thead>
                            <tr>
                                <th>
                                    <input
                                        type="checkbox"
                                        id="selectAll"
                                        onchange="toggleSelectAll()"
                                        title="ì „ì²´ ì„ íƒ"
                                    />
                                </th>
                                <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                                <th>ì£¼ë¬¸ì‹œê°„</th>
                                <th>ì…ê¸ˆìëª…</th>
                                <th>ì—°ë½ì²˜</th>
                                <th>ì£¼ë¬¸ìœ í˜•</th>
                                <th>ê¸°ì¡´ì£¼ë¬¸ë²ˆí˜¸</th>
                                <th>êµ¬ë§¤ì œí’ˆ</th>
                                <th>ì£¼ì†Œ</th>
                                <th>ìƒì„¸ì£¼ì†Œ</th>
                                <th>ë°°ì†¡ë©”ì„¸ì§€</th>
                                <th>ë°°ì†¡ìƒíƒœ</th>
                                <th>íƒë°°ì‚¬</th>
                                <th>ì†¡ì¥ë²ˆí˜¸</th>
                                <th>ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <!-- ì£¼ë¬¸ ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>

                    <!-- í˜ì´ì§€ ì •ë³´ ë° í˜ì´ì§€ë„¤ì´ì…˜ -->
                    <div
                        class="pagination-container"
                        style="margin-top: 20px; text-align: center"
                    >
                        <div
                            id="pageInfo"
                            style="
                                margin-bottom: 15px;
                                color: #666;
                                font-size: 14px;
                            "
                        >
                            <!-- í˜ì´ì§€ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                        <div
                            class="pagination-controls"
                            style="
                                display: flex;
                                justify-content: center;
                                gap: 10px;
                                align-items: center;
                            "
                        >
                            <button
                                class="btn btn-outline-primary btn-sm"
                                onclick="changePage(1)"
                                id="firstPage"
                            >
                                ì²˜ìŒ
                            </button>
                            <button
                                class="btn btn-outline-primary btn-sm"
                                onclick="changePage(currentPage - 1)"
                                id="prevPage"
                            >
                                ì´ì „
                            </button>
                            <span id="pageNumbers" style="margin: 0 15px">
                                <!-- í˜ì´ì§€ ë²ˆí˜¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                            </span>
                            <button
                                class="btn btn-outline-primary btn-sm"
                                onclick="changePage(currentPage + 1)"
                                id="nextPage"
                            >
                                ë‹¤ìŒ
                            </button>
                            <button
                                class="btn btn-outline-primary btn-sm"
                                onclick="changePage(Math.ceil(allFilteredData.length / itemsPerPage))"
                                id="lastPage"
                            >
                                ë§ˆì§€ë§‰
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Simple Footer -->
        <footer class="simple-footer">
            <!-- cx-tech-builder ë§í¬ëŠ” ì£¼ë¬¸ ëª©ë¡ ì„¹ì…˜ìœ¼ë¡œ ì´ë™ë¨ -->
        </footer>

        <!-- Firebase SDK -->
        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
            import {
                getDatabase,
                ref,
                onValue,
                set,
                query,
                orderByChild,
                get,
            } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";
            import * as XLSX from "https://cdn.jsdelivr.net/npm/xlsx@0.18.5/+esm";

            // Your web app's Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyA4Z1B42fmBIJznBED11XIIiVVKN5OSQ1E",
                authDomain: "seller1-b8a4c.firebaseapp.com",
                projectId: "seller1-b8a4c",
                storageBucket: "seller1-b8a4c.firebasestorage.app",
                messagingSenderId: "740000823974",
                appId: "1:740000823974:web:ac62ca392ffb34e96e9267",
                measurementId: "G-Q8ZNT6PDB9",
                databaseURL:
                    "https://seller1-b8a4c-default-rtdb.asia-southeast1.firebasedatabase.app",
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);

            // DOM ìš”ì†Œë“¤
            const statusDiv = document.getElementById("status");
            const ordersTableBody = document.getElementById("ordersTableBody");
            const recentOrdersList =
                document.getElementById("recentOrdersList");

            // í˜ì´ì§€ë„¤ì´ì…˜ ê´€ë ¨ ë³€ìˆ˜
            let currentPage = 1;
            let itemsPerPage = 30;
            let allFilteredData = [];

            // ì—°ê²° ìƒíƒœ í™•ì¸
            const connectedRef = ref(database, ".info/connected");
            onValue(connectedRef, (snap) => {
                if (snap.val() === true) {
                    statusDiv.className = "status-indicator connected";
                } else {
                    statusDiv.className = "status-indicator disconnected";
                }
            });

            // ì‚­ì œ ì˜ˆì •ì¼ ê³„ì‚° ë° í‘œì‹œ
            function updateDeletionDateInfo() {
                const today = new Date();
                const deletionDate = new Date(
                    today.getTime() + 7 * 24 * 60 * 60 * 1000
                ); // 7ì¼ í›„

                const deletionDateInfo =
                    document.getElementById("deletionDateInfo");
                if (deletionDateInfo) {
                    const formattedDate = deletionDate.toLocaleDateString(
                        "ko-KR",
                        {
                            year: "numeric",
                            month: "long",
                            day: "numeric",
                            weekday: "long",
                        }
                    );
                    deletionDateInfo.textContent = `ì˜¤ëŠ˜ ê¸°ì¤€ ${formattedDate} ì‚­ì œ ì˜ˆì •`;
                }
            }

            // ì‹¤ì‹œê°„ ì£¼ë¬¸ ë°ì´í„° ë¦¬ìŠ¤ë„ˆ
            const ordersRef = ref(database, "orders");
            const ordersQuery = query(ordersRef, orderByChild("createdAt"));
            onValue(ordersQuery, (snapshot) => {
                const data = snapshot.val();
                updateOrdersTable(data);
                updateStats(data);
                updateRecentOrders(data);

                // 7ì¼ì´ ì§€ë‚œ ì£¼ë¬¸ ìë™ ì‚­ì œ
                deleteOldOrders(data);

                // 3ì¼ì´ ì§€ë‚œ ë°°ì†¡ì¤‘ ì£¼ë¬¸ ìë™ ì™„ë£Œ ì²˜ë¦¬
                autoCompleteShippedOrders(data);

                // ì‚­ì œ ì˜ˆì •ì¼ ì •ë³´ ì—…ë°ì´íŠ¸
                updateDeletionDateInfo();
            });

            // ì†¡ì¥ ì—…ë¡œë“œ ëª¨ë‹¬ ì œì–´
            window.openInvoiceUploadModal = function () {
                document.getElementById("invoiceUploadModal").style.display =
                    "flex";
                document.getElementById("invoiceImportStatus").textContent = "";
                document.getElementById("invoicePreview").style.display =
                    "none";
                document.getElementById("uploadBtn").disabled = true;
                const fileInput = document.getElementById("invoiceFileInput");
                if (fileInput) fileInput.value = "";
            };
            window.closeInvoiceUploadModal = function () {
                document.getElementById("invoiceUploadModal").style.display =
                    "none";
            };

            // ì†¡ì¥ ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
            window.downloadInvoiceTemplate = function () {
                const headers = [
                    {
                        ì£¼ë¬¸ë²ˆí˜¸: "ORD20240101000000",
                        íƒë°°ì‚¬: "CJëŒ€í•œí†µìš´",
                        ì†¡ì¥ë²ˆí˜¸: "123456789012",
                    },
                ];
                const ws = XLSX.utils.json_to_sheet(headers);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "ì†¡ì¥ì—…ë¡œë“œì–‘ì‹");
                XLSX.writeFile(wb, "ì†¡ì¥ì—…ë¡œë“œ_ì–‘ì‹.xlsx");
            };

            // íŒŒì¼ ì„ íƒ í›„ ë¯¸ë¦¬ë³´ê¸°
            window.previewInvoiceFile = async function () {
                const input = document.getElementById("invoiceFileInput");
                const preview = document.getElementById("invoicePreview");
                const uploadBtn = document.getElementById("uploadBtn");
                const status = document.getElementById("invoiceImportStatus");

                if (!input || !input.files || input.files.length === 0) {
                    preview.style.display = "none";
                    uploadBtn.disabled = true;
                    return;
                }

                try {
                    status.textContent = "íŒŒì¼ ë¶„ì„ ì¤‘...";
                    preview.style.display = "none";

                    const file = input.files[0];
                    const data = await file.arrayBuffer();
                    const workbook = XLSX.read(data);
                    const sheetName = workbook.SheetNames[0];
                    const rows = XLSX.utils.sheet_to_json(
                        workbook.Sheets[sheetName],
                        { defval: "" }
                    );

                    if (rows.length === 0) {
                        status.textContent = "íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
                        uploadBtn.disabled = true;
                        return;
                    }

                    // ë°ì´í„° ë¶„ì„
                    let validRows = 0,
                        invalidRows = 0;
                    const sampleData = [];

                    for (let i = 0; i < Math.min(rows.length, 5); i++) {
                        const row = rows[i];
                        const orderNumber = String(
                            row["ì£¼ë¬¸ë²ˆí˜¸"] || ""
                        ).trim();
                        const courier = String(row["íƒë°°ì‚¬"] || "").trim();
                        const invoice = String(row["ì†¡ì¥ë²ˆí˜¸"] || "").trim();

                        if (orderNumber && courier && invoice) {
                            validRows++;
                            if (sampleData.length < 3) {
                                sampleData.push({
                                    orderNumber: orderNumber,
                                    courier: courier,
                                    invoice: invoice,
                                });
                            }
                        } else {
                            invalidRows++;
                        }
                    }

                    // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                    let previewHTML = `
                        <div style="margin-bottom:10px;">
                            <strong>ğŸ“ íŒŒì¼ ë¶„ì„ ê²°ê³¼</strong>
                        </div>
                        <div style="font-size:12px; margin-bottom:8px;">
                            ğŸ“Š ì´ ${rows.length}í–‰, ìœ íš¨ ${validRows}í–‰, ì˜¤ë¥˜ ${invalidRows}í–‰
                        </div>
                    `;

                    if (sampleData.length > 0) {
                        previewHTML += `
                            <div style="font-size:12px; margin-bottom:8px;">
                                <strong>ğŸ“‹ ìƒ˜í”Œ ë°ì´í„° (ì²˜ìŒ 3ê±´):</strong>
                            </div>
                            <div style="font-size:11px; color:#666;">
                        `;

                        sampleData.forEach((item, index) => {
                            previewHTML += `
                                ${index + 1}. ${item.orderNumber} | ${
                                item.courier
                            } | ${item.invoice}<br>
                            `;
                        });

                        previewHTML += `</div>`;
                    }

                    if (invalidRows > 0) {
                        previewHTML += `
                            <div style="font-size:12px; color:#dc3545; margin-top:8px;">
                                âš ï¸ ${invalidRows}í–‰ì— í•„ìˆ˜ ë°ì´í„°ê°€ ëˆ„ë½ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
                            </div>
                        `;
                    }

                    preview.innerHTML = previewHTML;
                    preview.style.display = "block";

                    // ì—…ë¡œë“œ ë²„íŠ¼ í™œì„±í™”
                    uploadBtn.disabled = false;
                    status.textContent = `íŒŒì¼ ì¤€ë¹„ ì™„ë£Œ: ${rows.length}í–‰ (${validRows}ê±´ ìœ íš¨)`;
                } catch (error) {
                    console.error("íŒŒì¼ ë¶„ì„ ì˜¤ë¥˜:", error);
                    status.textContent = "íŒŒì¼ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                    preview.style.display = "none";
                    uploadBtn.disabled = true;
                }
            };

            // ì†¡ì¥ ì—…ë¡œë“œ ì²˜ë¦¬
            window.startInvoiceImport = async function () {
                const input = document.getElementById("invoiceFileInput");
                const status = document.getElementById("invoiceImportStatus");
                if (!input || !input.files || input.files.length === 0) {
                    alert("ì—…ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.");
                    return;
                }
                try {
                    status.textContent = "ì²˜ë¦¬ ì¤‘...";
                    const file = input.files[0];
                    const data = await file.arrayBuffer();
                    const workbook = XLSX.read(data);
                    const sheetName = workbook.SheetNames[0];
                    const rows = XLSX.utils.sheet_to_json(
                        workbook.Sheets[sheetName],
                        { defval: "" }
                    );

                    // rows: [{ ì£¼ë¬¸ë²ˆí˜¸, íƒë°°ì‚¬, ì†¡ì¥ë²ˆí˜¸ }]
                    let updated = 0,
                        notFound = 0,
                        errors = 0,
                        claimWarnings = 0;
                    const claimWarningOrders = [];
                    const allSnap = await get(ref(database, "orders"));
                    const all = allSnap.val() || {};

                    const orderNumberToId = new Map();
                    Object.entries(all).forEach(([id, o]) => {
                        if (o && o.orderNumber)
                            orderNumberToId.set(o.orderNumber, id);
                    });

                    for (const row of rows) {
                        const orderNumber = String(
                            row["ì£¼ë¬¸ë²ˆí˜¸"] || ""
                        ).trim();
                        const courier = String(row["íƒë°°ì‚¬"] || "").trim();
                        const invoice = String(row["ì†¡ì¥ë²ˆí˜¸"] || "").trim();
                        if (!orderNumber || !courier || !invoice) {
                            errors++;
                            continue;
                        }

                        const orderId = orderNumberToId.get(orderNumber);
                        if (!orderId) {
                            notFound++;
                            continue;
                        }

                        try {
                            const order = all[orderId];
                            if (!order) {
                                notFound++;
                                continue;
                            }

                            // í´ë ˆì„ ì²´í¬: í•´ë‹¹ ì£¼ë¬¸ì— ëŒ€í•œ êµí™˜/ë°˜í’ˆ/ì·¨ì†Œê°€ ì ‘ìˆ˜/ë°°ì†¡ì¤‘ì¸ì§€ í™•ì¸
                            const relatedClaims = Object.values(all).filter(
                                (o) =>
                                    o &&
                                    o.existingOrderNumber ===
                                        order.orderNumber &&
                                    (o.orderType === "êµí™˜" ||
                                        o.orderType === "ë°˜í’ˆ" ||
                                        o.orderType === "ì·¨ì†Œ") &&
                                    (o.status === "ì ‘ìˆ˜" ||
                                        o.status === "ë°°ì†¡ì¤‘")
                            );

                            // ì†¡ì¥ ì •ë³´ ì—…ë°ì´íŠ¸
                            await set(
                                ref(database, `orders/${orderId}/courier`),
                                courier
                            );
                            await set(
                                ref(
                                    database,
                                    `orders/${orderId}/invoiceNumber`
                                ),
                                invoice
                            );

                            // í´ë ˆì„ì´ ì—†ìœ¼ë©´ ë°°ì†¡ì¤‘ìœ¼ë¡œ ìë™ ì „í™˜
                            if (relatedClaims.length === 0) {
                                await set(
                                    ref(database, `orders/${orderId}/status`),
                                    "ë°°ì†¡ì¤‘"
                                );
                                // ë°°ì†¡ ì‹œì‘ ì‹œê°„ ê¸°ë¡ (3ì¼ í›„ ìë™ ì™„ë£Œìš©)
                                await set(
                                    ref(
                                        database,
                                        `orders/${orderId}/shippingStartTime`
                                    ),
                                    Date.now()
                                );
                            } else {
                                // í´ë ˆì„ì´ ìˆìœ¼ë©´ ê²½ê³  ëˆ„ì  (ì†¡ì¥ ì •ë³´ëŠ” ì €ì¥ë˜ì§€ë§Œ ìƒíƒœëŠ” ê·¸ëŒ€ë¡œ)
                                claimWarnings++;
                                claimWarningOrders.push(order.orderNumber);
                                console.warn(
                                    `í´ë ˆì„ ì§„í–‰ ì¤‘: ${order.orderNumber} (${relatedClaims.length}ê±´)`
                                );
                            }

                            updated++;
                        } catch (e) {
                            errors++;
                        }
                    }

                    let message = `ì™„ë£Œ: ${updated}ê±´ ì—…ë°ì´íŠ¸, ${notFound}ê±´ ë¯¸ë§¤ì¹­, ${errors}ê±´ ì˜¤ë¥˜`;

                    // í´ë ˆì„ ê²½ê³ ê°€ ìˆìœ¼ë©´ ì•ŒëŸ¿ì— í¬í•¨
                    if (claimWarnings > 0) {
                        message += `\n\nâš ï¸ í´ë ˆì„ ì§„í–‰ ì¤‘ì¸ ì£¼ë¬¸ ${claimWarnings}ê±´ì€ ì†¡ì¥ë§Œ ë“±ë¡ë˜ê³  ë°°ì†¡ì¤‘ ì²˜ë¦¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
                        const sample = claimWarningOrders
                            .slice(0, 5)
                            .join(", ");
                        if (sample)
                            message += `\nì˜ˆ: ${sample}${
                                claimWarningOrders.length > 5 ? " ì™¸" : ""
                            }`;
                        message += `\ní•´ë‹¹ ì£¼ë¬¸ì˜ êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ìš”ì²­ì„ ë¨¼ì € ì²˜ë¦¬í•´ì£¼ì„¸ìš”.`;
                    } else {
                        message += `\n\nâœ… ì •ìƒ ì£¼ë¬¸ ${updated}ê±´ì€ ì†¡ì¥ ë“±ë¡ í›„ 3ì˜ì—…ì¼ í›„ ìë™ ë°°ì†¡ì™„ë£Œ ì²˜ë¦¬ë©ë‹ˆë‹¤.`;
                    }

                    status.textContent = message.split("\n")[0]; // ì²« ì¤„ë§Œ statusì— í‘œì‹œ
                    alert(message);
                } catch (e) {
                    console.error(e);
                    alert("ì—…ë¡œë“œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            };

            // í˜ì´ì§€ë„¤ì´ì…˜ í•¨ìˆ˜ë“¤
            function updatePagination() {
                const totalPages = Math.ceil(
                    allFilteredData.length / itemsPerPage
                );
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;

                // í˜„ì¬ í˜ì´ì§€ ë°ì´í„°ë§Œ í‘œì‹œ
                const currentPageData = allFilteredData.slice(
                    startIndex,
                    endIndex
                );

                // í…Œì´ë¸” ì—…ë°ì´íŠ¸
                ordersTableBody.innerHTML = "";

                if (currentPageData.length === 0) {
                    ordersTableBody.innerHTML =
                        '<tr><td colspan="14" style="text-align: center; padding: 20px;">í‘œì‹œí•  ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    return;
                }

                currentPageData.forEach(([id, order]) => {
                    const row = createOrderRow(id, order);
                    ordersTableBody.appendChild(row);
                });

                // í˜ì´ì§€ ì •ë³´ í‘œì‹œ
                updatePageInfo(totalPages);
            }

            function updatePageInfo(totalPages) {
                const pageInfo = document.getElementById("pageInfo");
                const pageNumbers = document.getElementById("pageNumbers");

                if (pageInfo) {
                    pageInfo.innerHTML = `
                        <span>ì´ ${allFilteredData.length}ê±´ ì¤‘ ${
                        (currentPage - 1) * itemsPerPage + 1
                    }-${Math.min(
                        currentPage * itemsPerPage,
                        allFilteredData.length
                    )}ê±´ í‘œì‹œ</span>
                        <span style="margin-left: 20px;">í˜ì´ì§€ ${currentPage} / ${totalPages}</span>
                    `;
                }

                // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ ìƒì„±
                if (pageNumbers && totalPages > 1) {
                    let pageButtons = "";
                    const startPage = Math.max(1, currentPage - 2);
                    const endPage = Math.min(totalPages, currentPage + 2);

                    for (let i = startPage; i <= endPage; i++) {
                        if (i === currentPage) {
                            pageButtons += `<button class="btn btn-primary btn-sm" style="margin: 0 2px;">${i}</button>`;
                        } else {
                            pageButtons += `<button class="btn btn-outline-primary btn-sm" style="margin: 0 2px;" onclick="changePage(${i})">${i}</button>`;
                        }
                    }
                    pageNumbers.innerHTML = pageButtons;
                } else if (pageNumbers) {
                    pageNumbers.innerHTML = "";
                }

                // í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
                updatePaginationButtons(totalPages);
            }

            function updatePaginationButtons(totalPages) {
                const firstPage = document.getElementById("firstPage");
                const prevPage = document.getElementById("prevPage");
                const nextPage = document.getElementById("nextPage");
                const lastPage = document.getElementById("lastPage");

                if (firstPage) firstPage.disabled = currentPage === 1;
                if (prevPage) prevPage.disabled = currentPage === 1;
                if (nextPage) nextPage.disabled = currentPage === totalPages;
                if (lastPage) lastPage.disabled = currentPage === totalPages;
            }

            function changePage(page) {
                const totalPages = Math.ceil(
                    allFilteredData.length / itemsPerPage
                );
                if (page >= 1 && page <= totalPages) {
                    currentPage = page;
                    updatePagination();
                }
            }

            function changeItemsPerPage(newItemsPerPage) {
                itemsPerPage = parseInt(newItemsPerPage);
                currentPage = 1; // ì²« í˜ì´ì§€ë¡œ ë¦¬ì…‹
                updatePagination();
            }

            // ì£¼ë¬¸ í…Œì´ë¸” ì—…ë°ì´íŠ¸
            function updateOrdersTable(data) {
                if (!data) {
                    allFilteredData = [];
                    updatePagination();
                    return;
                }

                const entries = Object.entries(data);
                allFilteredData = filterOrdersData(entries).sort((a, b) => {
                    const aTime = a[1]?.createdAt || 0;
                    const bTime = b[1]?.createdAt || 0;
                    return bTime - aTime; // ìµœì‹ ìˆœ
                });

                // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
                currentPage = 1; // ì²« í˜ì´ì§€ë¡œ ë¦¬ì…‹
                updatePagination();
            }

            // ì£¼ë¬¸ í–‰ ìƒì„±
            function createOrderRow(id, order) {
                const row = document.createElement("tr");
                const orderDate = new Date(order.createdAt);

                row.innerHTML = `
                <td>
                    <input type="checkbox" class="order-checkbox" value="${id}" data-status="${
                    order.status
                }">
                </td>
                <td><strong>${order.orderNumber}</strong></td>
                <td>${orderDate.toLocaleString("ko-KR")}</td>
                <td>${order.customerName}</td>
                <td>${order.phone}</td>
                <td><span class="order-type-badge">${
                    order.orderType || "ì‹ ê·œì£¼ë¬¸"
                }</span></td>
                <td>${order.existingOrderNumber || "-"}</td>
                <td>${order.product} (${order.quantity}ê°œ)</td>
                <td style="max-width: 150px; word-break: break-all;">${
                    order.address || ""
                }</td>
                <td style="max-width: 150px; word-break: break-all;">${
                    order.detailAddress || ""
                }</td>
                <td style="max-width: 150px; word-break: break-all;">${
                    order.memo || ""
                }</td>
                <td>
                    <span class="status-badge status-${order.status}">${
                    order.status
                }</span>
                </td>
                <td style="max-width: 120px; word-break: break-all;">${
                    order.courier || ""
                }</td>
                <td style="max-width: 140px; word-break: break-all;">${
                    order.invoiceNumber || ""
                }</td>
                <td>
                    <select class="status-select" onchange="updateOrderStatus('${id}', this.value)">
                        <option value="ì ‘ìˆ˜" ${
                            order.status === "ì ‘ìˆ˜" ? "selected" : ""
                        }>ì ‘ìˆ˜</option>
                        <option value="ë°°ì†¡ì¤‘" ${
                            order.status === "ë°°ì†¡ì¤‘" ? "selected" : ""
                        }>ë°°ì†¡ì¤‘</option>
                        <option value="ë°°ì†¡ì™„ë£Œ" ${
                            order.status === "ë°°ì†¡ì™„ë£Œ" ? "selected" : ""
                        }>ë°°ì†¡ì™„ë£Œ</option>
                        <option value="ì·¨ì†Œ" ${
                            order.status === "ì·¨ì†Œ" ? "selected" : ""
                        }>ì·¨ì†Œ</option>
                    </select>
                </td>
            `;

                return row;
            }

            // ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ (í´ë ˆì„ ì‚¬ì „ í™•ì¸ í¬í•¨)
            window.updateOrderStatus = async function (orderId, newStatus) {
                try {
                    // ëŒ€ìƒ ì£¼ë¬¸ ì¡°íšŒ
                    const orderSnap = await get(
                        ref(database, `orders/${orderId}`)
                    );
                    const order = orderSnap.val();
                    if (!order) return;

                    // ë°°ì†¡ì¤‘/ë°°ì†¡ì™„ë£Œë¡œ ë³€ê²½í•˜ëŠ” ê²½ìš°, ì—°ê³„ í´ë ˆì„(êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ) ì§„í–‰ ì—¬ë¶€ í™•ì¸
                    if (newStatus === "ë°°ì†¡ì¤‘" || newStatus === "ë°°ì†¡ì™„ë£Œ") {
                        const allSnap = await get(ref(database, `orders`));
                        const all = allSnap.val() || {};
                        const relatedClaims = Object.values(all).filter(
                            (o) =>
                                o &&
                                o.existingOrderNumber === order.orderNumber &&
                                (o.orderType === "êµí™˜" ||
                                    o.orderType === "ë°˜í’ˆ" ||
                                    o.orderType === "ì·¨ì†Œ") &&
                                (o.status === "ì ‘ìˆ˜" || o.status === "ë°°ì†¡ì¤‘")
                        );

                        if (relatedClaims.length > 0) {
                            const proceed = confirm(
                                "ìƒˆë¡œìš´ í´ë ˆì„ì´ ì¡´ì¬í•©ë‹ˆë‹¤.\n" +
                                    "í•´ë‹¹ ì£¼ë¬¸ì— ëŒ€í•´ êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ìš”ì²­ì´ ì ‘ìˆ˜/ì§„í–‰ ì¤‘ì¼ ìˆ˜ ìˆì–´ìš”.\n" +
                                    `ê·¸ë˜ë„ '${newStatus}'ë¡œ ìƒíƒœë¥¼ ë³€ê²½í• ê¹Œìš”?`
                            );
                            if (!proceed) return;
                        }
                    }

                    // ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤í–‰
                    const statusRef = ref(database, `orders/${orderId}/status`);
                    await set(statusRef, newStatus);
                } catch (err) {
                    console.error("ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:", err);
                    alert("ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            };

            // í†µê³„ ì—…ë°ì´íŠ¸
            function updateStats(data) {
                if (!data) {
                    document.getElementById("todayNewOrders").textContent = "0";
                    document.getElementById(
                        "todayExchangeRequests"
                    ).textContent = "0";
                    document.getElementById("todayReturnRequests").textContent =
                        "0";
                    document.getElementById("todayCancelRequests").textContent =
                        "0";
                    return;
                }

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);

                const entries = Object.entries(data);
                const todayOrders = entries.filter(([id, order]) => {
                    const orderDate = new Date(order.createdAt);
                    return orderDate >= today && orderDate < tomorrow;
                });

                // ì£¼ë¬¸ ìœ í˜•ë³„ í†µê³„
                const newOrders = todayOrders.filter(
                    ([id, order]) => order.orderType === "ì‹ ê·œì£¼ë¬¸"
                );
                const exchangeRequests = todayOrders.filter(
                    ([id, order]) => order.orderType === "êµí™˜"
                );
                const returnRequests = todayOrders.filter(
                    ([id, order]) => order.orderType === "ë°˜í’ˆ"
                );
                const cancelRequests = todayOrders.filter(
                    ([id, order]) => order.orderType === "ì·¨ì†Œ"
                );

                document.getElementById("todayNewOrders").textContent =
                    newOrders.length;
                document.getElementById("todayExchangeRequests").textContent =
                    exchangeRequests.length;
                document.getElementById("todayReturnRequests").textContent =
                    returnRequests.length;
                document.getElementById("todayCancelRequests").textContent =
                    cancelRequests.length;
            }

            // ìµœê·¼ ì£¼ë¬¸ ì—…ë°ì´íŠ¸
            // ìµœê·¼ì£¼ë¬¸ ì„¹ì…˜ ì œê±°ë¡œ ë”ë¯¸ í•¨ìˆ˜ ìœ ì§€
            function updateRecentOrders(data) {
                /* no-op */
            }

            // ì£¼ë¬¸ í•„í„°ë§
            function filterOrdersData(entries) {
                const statusFilter =
                    document.getElementById("statusFilter").value;
                const orderTypeFilter =
                    document.getElementById("orderTypeFilter").value;
                const dateFilter = document.getElementById("dateFilter").value;
                const phoneSearch = document
                    .getElementById("phoneSearch")
                    .value.toLowerCase();
                const orderNumberSearch = document
                    .getElementById("orderNumberSearch")
                    .value.toLowerCase();

                return entries.filter(([id, order]) => {
                    // íœ´ëŒ€í°ë²ˆí˜¸ ê²€ìƒ‰
                    if (
                        phoneSearch &&
                        !order.phone.toLowerCase().includes(phoneSearch)
                    ) {
                        return false;
                    }

                    // ì£¼ë¬¸ë²ˆí˜¸ ê²€ìƒ‰
                    if (
                        orderNumberSearch &&
                        !order.orderNumber
                            .toLowerCase()
                            .includes(orderNumberSearch)
                    ) {
                        return false;
                    }

                    // ë°°ì†¡ìƒíƒœ í•„í„°
                    if (statusFilter && order.status !== statusFilter) {
                        return false;
                    }

                    // ì£¼ë¬¸ìœ í˜• í•„í„°
                    if (
                        orderTypeFilter &&
                        order.orderType !== orderTypeFilter
                    ) {
                        return false;
                    }

                    // ë‚ ì§œ í•„í„°
                    if (dateFilter) {
                        const orderDate = new Date(order.createdAt);
                        const now = new Date();

                        switch (dateFilter) {
                            case "today":
                                const today = new Date(now);
                                today.setHours(0, 0, 0, 0);
                                const tomorrow = new Date(today);
                                tomorrow.setDate(tomorrow.getDate() + 1);
                                return (
                                    orderDate >= today && orderDate < tomorrow
                                );

                            case "week":
                                const weekAgo = new Date(now);
                                weekAgo.setDate(weekAgo.getDate() - 7);
                                return orderDate >= weekAgo;
                        }
                    }

                    return true;
                });
            }

            // í•„í„° ì ìš©
            window.filterOrders = function () {
                const ordersRef = ref(database, "orders");
                const ordersQuery = query(ordersRef, orderByChild("createdAt"));
                onValue(
                    ordersQuery,
                    (snapshot) => {
                        const data = snapshot.val();
                        updateOrdersTable(data);
                        updateStats(data);
                        updateRecentOrders(data);
                    },
                    { onlyOnce: true }
                );
            };

            // ìƒˆë¡œê³ ì¹¨
            window.refreshOrders = function () {
                // ëª¨ë“  í•„í„°ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
                document.getElementById("orderTypeFilter").value = ""; // ì „ì²´ ì£¼ë¬¸ìœ í˜•
                document.getElementById("statusFilter").value = ""; // ì „ì²´ ë°°ì†¡ìƒíƒœ
                document.getElementById("dateFilter").value = "today"; // ì˜¤ëŠ˜
                document.getElementById("phoneSearch").value = ""; // ê²€ìƒ‰ì–´ ì´ˆê¸°í™”
                document.getElementById("orderNumberSearch").value = ""; // ê²€ìƒ‰ì–´ ì´ˆê¸°í™”

                // ì£¼ë¬¸ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                const ordersRef = ref(database, "orders");
                const ordersQuery = query(ordersRef, orderByChild("createdAt"));
                onValue(
                    ordersQuery,
                    (snapshot) => {
                        const data = snapshot.val();
                        updateOrdersTable(data);
                        updateStats(data);
                        updateRecentOrders(data);
                    },
                    { onlyOnce: true }
                );

                // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                alert("ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ! ê¸°ë³¸ í•„í„°ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.");
            };

            // ì‹ ê·œì£¼ë¬¸ ì§„í–‰ì¤‘ í•„í„°ë§
            window.filterNewOrdersInProgress = function () {
                // í•„í„° ì´ˆê¸°í™”
                document.getElementById("orderTypeFilter").value = "";
                document.getElementById("statusFilter").value = "";
                document.getElementById("dateFilter").value = "";
                document.getElementById("phoneSearch").value = "";
                document.getElementById("orderNumberSearch").value = "";

                // JavaScriptì—ì„œ ì§ì ‘ í•„í„°ë§
                filterNewOrdersInProgressCustom();

                // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                alert("ì‹ ê·œì£¼ë¬¸ ì¤‘ ì ‘ìˆ˜/ë°°ì†¡ì¤‘ ìƒíƒœì¸ ì£¼ë¬¸ë§Œ í‘œì‹œë©ë‹ˆë‹¤.");
            };

            // êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ì§„í–‰ì¤‘ í•„í„°ë§
            window.filterExchangeReturnInProgress = function () {
                // í•„í„° ì´ˆê¸°í™”
                document.getElementById("orderTypeFilter").value = "";
                document.getElementById("statusFilter").value = "";
                document.getElementById("dateFilter").value = "";
                document.getElementById("phoneSearch").value = "";
                document.getElementById("orderNumberSearch").value = "";

                // JavaScriptì—ì„œ ì§ì ‘ í•„í„°ë§
                filterExchangeReturnInProgressCustom();

                // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                alert(
                    "êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ì¤‘ ì ‘ìˆ˜/ë°°ì†¡ì¤‘ ìƒíƒœì¸ ì£¼ë¬¸ë§Œ í‘œì‹œë©ë‹ˆë‹¤."
                );
            };

            // ì „ì²´ ë³´ê¸° (ëª¨ë“  ì£¼ë¬¸ í‘œì‹œ)
            window.showAllOrders = function () {
                // ëª¨ë“  í•„í„° ì´ˆê¸°í™”
                document.getElementById("orderTypeFilter").value = "";
                document.getElementById("statusFilter").value = "";
                document.getElementById("dateFilter").value = "";
                document.getElementById("phoneSearch").value = "";
                document.getElementById("orderNumberSearch").value = "";

                // ì „ì²´ ì£¼ë¬¸ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
                const ordersRef = ref(database, "orders");
                const ordersQuery = query(ordersRef, orderByChild("createdAt"));
                onValue(
                    ordersQuery,
                    (snapshot) => {
                        const data = snapshot.val();
                        updateOrdersTable(data);
                        updateStats(data);
                        updateRecentOrders(data);
                    },
                    { onlyOnce: true }
                );

                // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                alert("ì „ì²´ ì£¼ë¬¸ì´ í‘œì‹œë©ë‹ˆë‹¤.");
            };

            // ì „ì²´ ì„ íƒ/í•´ì œ
            window.toggleSelectAll = function () {
                const selectAll = document.getElementById("selectAll");
                const checkboxes = document.querySelectorAll(".order-checkbox");

                checkboxes.forEach((checkbox) => {
                    checkbox.checked = selectAll.checked;
                });

                updateBulkActions();
            };

            // ì²´í¬ë°•ìŠ¤ ì„ íƒ ìƒíƒœ ë³€ê²½ ì‹œ ì¼ê´„ ì²˜ë¦¬ ë„êµ¬ í‘œì‹œ/ìˆ¨ê¹€
            document.addEventListener("change", function (e) {
                if (e.target.classList.contains("order-checkbox")) {
                    updateBulkActions();
                }
            });

            // ì¼ê´„ ì²˜ë¦¬ ë„êµ¬ ì—…ë°ì´íŠ¸
            function updateBulkActions() {
                const checkboxes = document.querySelectorAll(
                    ".order-checkbox:checked"
                );
                const bulkActions = document.querySelector(".bulk-actions");
                const selectedCount = document.getElementById("selectedCount");

                if (checkboxes.length > 0) {
                    bulkActions.style.display = "block";
                    selectedCount.textContent = `${checkboxes.length}ê°œ ì„ íƒë¨`;
                } else {
                    bulkActions.style.display = "none";
                    selectAll.checked = false;
                }
            }

            // ì‹ ê·œì£¼ë¬¸ ì§„í–‰ì¤‘ ì»¤ìŠ¤í…€ í•„í„°ë§
            function filterNewOrdersInProgressCustom() {
                const ordersRef = ref(database, "orders");
                const ordersQuery = query(ordersRef, orderByChild("createdAt"));
                onValue(
                    ordersQuery,
                    (snapshot) => {
                        const data = snapshot.val();
                        if (!data) {
                            updateOrdersTable({});
                            return;
                        }

                        const entries = Object.entries(data);
                        console.log("ì „ì²´ ì£¼ë¬¸ ë°ì´í„°:", entries.length, "ê±´");

                        const filteredEntries = entries.filter(
                            ([id, order]) => {
                                // ì£¼ë¬¸ìœ í˜• í•„í„° (ì‹ ê·œì£¼ë¬¸ë§Œ)
                                if (order.orderType !== "ì‹ ê·œì£¼ë¬¸") {
                                    return false;
                                }

                                // ìƒíƒœ í•„í„° (ì ‘ìˆ˜ ë˜ëŠ” ë°°ì†¡ì¤‘ë§Œ)
                                if (
                                    order.status !== "ì ‘ìˆ˜" &&
                                    order.status !== "ë°°ì†¡ì¤‘"
                                ) {
                                    return false;
                                }

                                console.log(
                                    "ì‹ ê·œì£¼ë¬¸ ì§„í–‰ì¤‘ í†µê³¼:",
                                    order.orderType,
                                    order.status,
                                    order.orderNumber
                                );
                                return true;
                            }
                        );

                        console.log(
                            "ì‹ ê·œì£¼ë¬¸ ì§„í–‰ì¤‘ í•„í„°ë§ ê²°ê³¼:",
                            filteredEntries.length,
                            "ê±´"
                        );

                        // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ì—…ë°ì´íŠ¸ (í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©)
                        const filteredData = {};
                        filteredEntries.forEach(([id, order]) => {
                            filteredData[id] = order;
                        });

                        // í˜ì´ì§€ë„¤ì´ì…˜ ë¦¬ì…‹ ë° í…Œì´ë¸” ì—…ë°ì´íŠ¸
                        currentPage = 1;
                        allFilteredData = Object.entries(filteredData);
                        updatePagination();
                        updateStats(filteredData);
                        updateRecentOrders(filteredData);
                    },
                    { onlyOnce: true }
                );
            }

            // êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ì§„í–‰ì¤‘ ì»¤ìŠ¤í…€ í•„í„°ë§
            function filterExchangeReturnInProgressCustom() {
                const ordersRef = ref(database, "orders");
                const ordersQuery = query(ordersRef, orderByChild("createdAt"));
                onValue(
                    ordersQuery,
                    (snapshot) => {
                        const data = snapshot.val();
                        if (!data) {
                            updateOrdersTable({});
                            return;
                        }

                        const entries = Object.entries(data);
                        console.log("ì „ì²´ ì£¼ë¬¸ ë°ì´í„°:", entries.length, "ê±´");

                        const filteredEntries = entries.filter(
                            ([id, order]) => {
                                // ì£¼ë¬¸ìœ í˜• í•„í„° (êµí™˜, ë°˜í’ˆ, ì·¨ì†Œë§Œ)
                                if (
                                    order.orderType !== "êµí™˜" &&
                                    order.orderType !== "ë°˜í’ˆ" &&
                                    order.orderType !== "ì·¨ì†Œ"
                                ) {
                                    return false;
                                }

                                // ìƒíƒœ í•„í„° (ì ‘ìˆ˜ ë˜ëŠ” ë°°ì†¡ì¤‘ë§Œ)
                                if (
                                    order.status !== "ì ‘ìˆ˜" &&
                                    order.status !== "ë°°ì†¡ì¤‘"
                                ) {
                                    return false;
                                }

                                console.log(
                                    "êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ì§„í–‰ì¤‘ í†µê³¼:",
                                    order.orderType,
                                    order.status,
                                    order.orderNumber
                                );
                                return true;
                            }
                        );

                        console.log(
                            "êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ì§„í–‰ì¤‘ í•„í„°ë§ ê²°ê³¼:",
                            filteredEntries.length,
                            "ê±´"
                        );

                        // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ì—…ë°ì´íŠ¸ (í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©)
                        const filteredData = {};
                        filteredEntries.forEach(([id, order]) => {
                            filteredData[id] = order;
                        });

                        // í˜ì´ì§€ë„¤ì´ì…˜ ë¦¬ì…‹ ë° í…Œì´ë¸” ì—…ë°ì´íŠ¸
                        currentPage = 1;
                        allFilteredData = Object.entries(filteredData);
                        updatePagination();
                        updateStats(filteredData);
                        updateRecentOrders(filteredData);
                    },
                    { onlyOnce: true }
                );
            }

            // ì»¤ìŠ¤í…€ ìƒíƒœ í•„í„°ë§ (ì—¬ëŸ¬ ìƒíƒœ ë™ì‹œ ì§€ì›)
            function filterOrdersWithCustomStatus(allowedStatuses) {
                const ordersRef = ref(database, "orders");
                const ordersQuery = query(ordersRef, orderByChild("createdAt"));
                onValue(
                    ordersQuery,
                    (snapshot) => {
                        const data = snapshot.val();
                        if (!data) {
                            updateOrdersTable({});
                            return;
                        }

                        const entries = Object.entries(data);
                        const filteredEntries = entries.filter(
                            ([id, order]) => {
                                // ì£¼ë¬¸ìœ í˜• í•„í„° (ì‹ ê·œì£¼ë¬¸)
                                if (order.orderType !== "ì‹ ê·œì£¼ë¬¸") {
                                    return false;
                                }

                                // ìƒíƒœ í•„í„° (ì ‘ìˆ˜ ë˜ëŠ” ë°°ì†¡ì¤‘)
                                if (!allowedStatuses.includes(order.status)) {
                                    return false;
                                }

                                return true;
                            }
                        );

                        // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                        const filteredData = {};
                        filteredEntries.forEach(([id, order]) => {
                            filteredData[id] = order;
                        });

                        updateOrdersTable(filteredData);
                        updateStats(filteredData);
                        updateRecentOrders(filteredData);
                    },
                    { onlyOnce: true }
                );
            }

            // ì»¤ìŠ¤í…€ ì£¼ë¬¸ìœ í˜•ê³¼ ìƒíƒœ í•„í„°ë§
            function filterOrdersWithCustomTypeAndStatus(
                allowedTypes,
                allowedStatuses
            ) {
                const ordersRef = ref(database, "orders");
                const ordersQuery = query(ordersRef, orderByChild("createdAt"));
                onValue(
                    ordersQuery,
                    (snapshot) => {
                        const data = snapshot.val();
                        if (!data) {
                            updateOrdersTable({});
                            return;
                        }

                        const entries = Object.entries(data);
                        console.log("ì „ì²´ ì£¼ë¬¸ ë°ì´í„°:", entries.length, "ê±´");
                        console.log("í—ˆìš©ëœ ì£¼ë¬¸ìœ í˜•:", allowedTypes);
                        console.log("í—ˆìš©ëœ ìƒíƒœ:", allowedStatuses);

                        const filteredEntries = entries.filter(
                            ([id, order]) => {
                                // ì£¼ë¬¸ìœ í˜• í•„í„° (êµí™˜, ë°˜í’ˆ, ì·¨ì†Œ)
                                if (!allowedTypes.includes(order.orderType)) {
                                    console.log(
                                        "ì£¼ë¬¸ìœ í˜• í•„í„°ë§ ì œì™¸:",
                                        order.orderType,
                                        order.orderNumber
                                    );
                                    return false;
                                }

                                // ìƒíƒœ í•„í„° (ì ‘ìˆ˜ ë˜ëŠ” ë°°ì†¡ì¤‘)
                                if (!allowedStatuses.includes(order.status)) {
                                    console.log(
                                        "ìƒíƒœ í•„í„°ë§ ì œì™¸:",
                                        order.status,
                                        order.orderNumber
                                    );
                                    return false;
                                }

                                console.log(
                                    "í•„í„°ë§ í†µê³¼:",
                                    order.orderType,
                                    order.status,
                                    order.orderNumber
                                );
                                return true;
                            }
                        );

                        console.log(
                            "í•„í„°ë§ ê²°ê³¼:",
                            filteredEntries.length,
                            "ê±´"
                        );

                        // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                        const filteredData = {};
                        filteredEntries.forEach(([id, order]) => {
                            filteredData[id] = order;
                        });

                        updateOrdersTable(filteredData);
                        updateStats(filteredData);
                        updateRecentOrders(filteredData);
                    },
                    { onlyOnce: true }
                );
            }

            // ì¼ê´„ ìƒíƒœ ì—…ë°ì´íŠ¸
            window.bulkUpdateStatus = async function (newStatus) {
                const checkboxes = document.querySelectorAll(
                    ".order-checkbox:checked"
                );

                if (checkboxes.length === 0) {
                    alert("ì„ íƒëœ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                const confirmMessage = `ì„ íƒëœ ${checkboxes.length}ê°œ ì£¼ë¬¸ì˜ ìƒíƒœë¥¼ '${newStatus}'ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
                if (!confirm(confirmMessage)) {
                    return;
                }

                // ëª¨ë“  ì£¼ë¬¸ì„ í•œ ë²ˆë§Œ ë¡œë“œ
                const allSnap = await get(ref(database, `orders`));
                const all = allSnap.val() || {};

                // ì„ íƒëœ ì£¼ë¬¸ë“¤ì˜ ìƒì„¸ ìˆ˜ì§‘
                const selectedOrders = [];
                for (const checkbox of checkboxes) {
                    const orderId = checkbox.value;
                    const order = all[orderId];
                    if (order) selectedOrders.push({ orderId, order });
                }

                // í´ë ˆì„ ê°ì§€ (ë°°ì†¡ì¤‘/ë°°ì†¡ì™„ë£Œ ì²˜ë¦¬ ì‹œë§Œ ì˜ë¯¸ ìˆìŒ)
                let claimAffected = [];
                if (newStatus === "ë°°ì†¡ì¤‘" || newStatus === "ë°°ì†¡ì™„ë£Œ") {
                    claimAffected = selectedOrders.filter(({ order }) => {
                        return Object.values(all).some(
                            (o) =>
                                o &&
                                o.existingOrderNumber === order.orderNumber &&
                                (o.orderType === "êµí™˜" ||
                                    o.orderType === "ë°˜í’ˆ" ||
                                    o.orderType === "ì·¨ì†Œ") &&
                                (o.status === "ì ‘ìˆ˜" || o.status === "ë°°ì†¡ì¤‘")
                        );
                    });
                }

                if (claimAffected.length > 0) {
                    const sample = claimAffected
                        .slice(0, 5)
                        .map((v) => v.order.orderNumber)
                        .join(", ");
                    const proceed = confirm(
                        "ìƒˆë¡œìš´ í´ë ˆì„ì´ ì¡´ì¬í•©ë‹ˆë‹¤.\n" +
                            "ì„ íƒëœ ì£¼ë¬¸ ì¤‘ ì¼ë¶€ëŠ” êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ìš”ì²­ì´ ì ‘ìˆ˜/ì§„í–‰ ì¤‘ì´ì—ìš”.\n" +
                            `í•´ë‹¹ ì£¼ë¬¸ì€ ìŠ¤í‚µí•˜ê³  ë‚˜ë¨¸ì§€ë§Œ '${newStatus}'ë¡œ ë³€ê²½í• ê¹Œìš”?` +
                            (sample
                                ? `\nì˜ˆ: ${sample}${
                                      claimAffected.length > 5 ? " ì™¸" : ""
                                  }`
                                : "")
                    );
                    if (!proceed) return;
                }

                let successCount = 0;
                let skippedCount = 0;
                let errorCount = 0;

                for (const { orderId, order } of selectedOrders) {
                    // í´ë ˆì„ ì˜í–¥ ì£¼ë¬¸ì€ ìŠ¤í‚µ
                    const isClaimed = claimAffected.some(
                        (v) => v.orderId === orderId
                    );
                    if (isClaimed) {
                        skippedCount++;
                        continue;
                    }
                    try {
                        const statusRef = ref(
                            database,
                            `orders/${orderId}/status`
                        );
                        await set(statusRef, newStatus);
                        successCount++;
                    } catch (error) {
                        console.error("ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:", error);
                        errorCount++;
                    }
                }

                // ì²´í¬ë°•ìŠ¤ ì„ íƒ í•´ì œ
                checkboxes.forEach((checkbox) => (checkbox.checked = false));
                const selectAll = document.getElementById("selectAll");
                if (selectAll) selectAll.checked = false;
                updateBulkActions();

                // ê²°ê³¼ ì•Œë¦¼
                let message = `${successCount}ê°œ ìƒíƒœ ë³€ê²½ ì™„ë£Œ`;
                if (skippedCount > 0)
                    message += `\n${skippedCount}ê°œëŠ” í´ë ˆì„ ì§„í–‰ ì¤‘ìœ¼ë¡œ ìŠ¤í‚µë¨`;
                if (errorCount > 0) message += `\n${errorCount}ê°œ ì‹¤íŒ¨`;
                alert(message);
            };

            // 7ì¼ì´ ì§€ë‚œ ì£¼ë¬¸ ìë™ ì‚­ì œ
            async function deleteOldOrders(data) {
                if (!data) return;

                const sevenDaysAgo = Date.now() - 7 * 24 * 60 * 60 * 1000; // 7ì¼ ì „
                const entries = Object.entries(data);
                let deletedCount = 0;

                for (const [id, order] of entries) {
                    if (order.createdAt && order.createdAt < sevenDaysAgo) {
                        try {
                            const orderRef = ref(database, `orders/${id}`);
                            await set(orderRef, null); // ì‚­ì œ
                            deletedCount++;
                        } catch (error) {
                            console.error("ì£¼ë¬¸ ì‚­ì œ ì˜¤ë¥˜:", error);
                        }
                    }
                }

                if (deletedCount > 0) {
                    console.log(
                        `${deletedCount}ê°œì˜ ì˜¤ë˜ëœ ì£¼ë¬¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`
                    );
                }
            }

            // ì˜ì—…ì¼ ê³„ì‚° í•¨ìˆ˜ (ì£¼ë§ê³¼ ê³µíœ´ì¼ ì œì™¸)
            function isBusinessDay(date) {
                const day = date.getDay();
                // ì£¼ë§ ì œì™¸ (0: ì¼ìš”ì¼, 6: í† ìš”ì¼)
                if (day === 0 || day === 6) return false;

                // í•œêµ­ ê³µíœ´ì¼ ì²´í¬ (ì£¼ìš” ê³µíœ´ì¼ë§Œ)
                const month = date.getMonth() + 1;
                const dayOfMonth = date.getDate();

                // ì‹ ì •, ì„¤ë‚ , ì‚¼ì¼ì ˆ, ì–´ë¦°ì´ë‚ , ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ , í˜„ì¶©ì¼, ê´‘ë³µì ˆ, ê°œì²œì ˆ, í•œê¸€ë‚ , ì„±íƒ„ì ˆ
                const holidays = [
                    { month: 1, day: 1 }, // ì‹ ì •
                    { month: 3, day: 1 }, // ì‚¼ì¼ì ˆ
                    { month: 5, day: 5 }, // ì–´ë¦°ì´ë‚ 
                    { month: 6, day: 6 }, // í˜„ì¶©ì¼
                    { month: 8, day: 15 }, // ê´‘ë³µì ˆ
                    { month: 10, day: 3 }, // ê°œì²œì ˆ
                    { month: 10, day: 9 }, // í•œê¸€ë‚ 
                    { month: 12, day: 25 }, // ì„±íƒ„ì ˆ
                ];

                // ì„¤ë‚ ê³¼ ì¶”ì„ì€ ìŒë ¥ì´ë¼ ë³µì¡í•˜ë¯€ë¡œ ê°„ë‹¨íˆ ì²˜ë¦¬ (ì¶”í›„ ê°œì„  ê°€ëŠ¥)
                // ì—¬ê¸°ì„œëŠ” ì£¼ìš” ì–‘ë ¥ ê³µíœ´ì¼ë§Œ ì²´í¬

                return !holidays.some(
                    (holiday) =>
                        holiday.month === month && holiday.day === dayOfMonth
                );
            }

            // ì˜ì—…ì¼ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ê³„ì‚°
            function addBusinessDays(startDate, businessDays) {
                let currentDate = new Date(startDate);
                let addedDays = 0;

                while (addedDays < businessDays) {
                    currentDate.setDate(currentDate.getDate() + 1);
                    if (isBusinessDay(currentDate)) {
                        addedDays++;
                    }
                }

                return currentDate;
            }

            // 3ì˜ì—…ì¼ì´ ì§€ë‚œ ë°°ì†¡ì¤‘ ì£¼ë¬¸ ìë™ ì™„ë£Œ ì²˜ë¦¬
            async function autoCompleteShippedOrders(data) {
                if (!data) return;

                const now = new Date();
                let completedCount = 0;

                for (const [id, order] of Object.entries(data)) {
                    // ë°°ì†¡ì¤‘ ìƒíƒœì´ê³  ë°°ì†¡ ì‹œì‘ ì‹œê°„ì´ ìˆëŠ” ì£¼ë¬¸
                    if (order.status === "ë°°ì†¡ì¤‘" && order.shippingStartTime) {
                        const shippingStartDate = new Date(
                            order.shippingStartTime
                        );
                        const expectedCompletionDate = addBusinessDays(
                            shippingStartDate,
                            3
                        );

                        // 3ì˜ì—…ì¼ì´ ì§€ë‚¬ëŠ”ì§€ í™•ì¸
                        if (now >= expectedCompletionDate) {
                            try {
                                // ë°°ì†¡ì™„ë£Œë¡œ ìƒíƒœ ë³€ê²½
                                await set(
                                    ref(database, `orders/${id}/status`),
                                    "ë°°ì†¡ì™„ë£Œ"
                                );
                                // ìë™ ì™„ë£Œ ì‹œê°„ ê¸°ë¡
                                await set(
                                    ref(
                                        database,
                                        `orders/${id}/autoCompletedTime`
                                    ),
                                    Date.now()
                                );
                                completedCount++;

                                console.log(
                                    `ì£¼ë¬¸ ${order.orderNumber}ì´(ê°€) 3ì˜ì—…ì¼ í›„ ìë™ìœ¼ë¡œ ë°°ì†¡ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`
                                );
                            } catch (error) {
                                console.error(
                                    `ìë™ ë°°ì†¡ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜ (${id}):`,
                                    error
                                );
                            }
                        }
                    }
                }

                if (completedCount > 0) {
                    console.log(
                        `${completedCount}ê°œì˜ ë°°ì†¡ì¤‘ ì£¼ë¬¸ì´ 3ì˜ì—…ì¼ í›„ ìë™ìœ¼ë¡œ ë°°ì†¡ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`
                    );
                }
            }

            // AI ì œí’ˆ ë§¤ì¹­ìš© Excel ë‚´ë³´ë‚´ê¸° (ë°°ì†¡ìƒíƒœê¹Œì§€)
            window.exportToExcelAI = function () {
                // ë¡œë”© í‘œì‹œ
                const exportBtn = document.querySelector(
                    'button[onclick="exportToExcelAI()"]'
                );
                const originalText = exportBtn.innerHTML;
                exportBtn.disabled = true;
                exportBtn.innerHTML =
                    '<svg class="inline-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg> ì²˜ë¦¬ì¤‘...';

                try {
                    // í•„í„°ë§ëœ ì „ì²´ ë°ì´í„° ì‚¬ìš© (í˜ì´ì§€ë„¤ì´ì…˜ ë¬´ê´€)
                    if (!allFilteredData || allFilteredData.length === 0) {
                        alert("ë‚´ë³´ë‚¼ ì£¼ë¬¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                        return;
                    }

                    // í•„í„°ë§ëœ ì „ì²´ ë°ì´í„° ìˆ˜ì§‘ (AIìš© - ë°°ì†¡ìƒíƒœê¹Œì§€ë§Œ)
                    const filteredData = [];
                    let processedCount = 0;
                    const totalCount = allFilteredData.length;

                    allFilteredData.forEach(([id, order]) => {
                        processedCount++;

                        // 1000ê±´ë§ˆë‹¤ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
                        if (processedCount % 1000 === 0) {
                            const progress = Math.round(
                                (processedCount / totalCount) * 100
                            );
                            exportBtn.innerHTML = `<svg class="inline-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg> ${progress}%`;
                        }

                        // ì£¼ë¬¸ ë°ì´í„°ë¥¼ Excel í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (AIìš©)
                        filteredData.push({
                            ì£¼ë¬¸ë²ˆí˜¸: order.orderNumber || "",
                            ì£¼ë¬¸ì‹œê°„: order.createdAt
                                ? new Date(order.createdAt).toLocaleString(
                                      "ko-KR"
                                  )
                                : "",
                            ì…ê¸ˆìëª…: order.customerName || "",
                            ì—°ë½ì²˜: order.phone || "",
                            ì£¼ë¬¸ìœ í˜•: order.orderType || "ì‹ ê·œì£¼ë¬¸",
                            ê¸°ì¡´ì£¼ë¬¸ë²ˆí˜¸: order.existingOrderNumber || "-",
                            êµ¬ë§¤ì œí’ˆ: `${order.product || ""} (${
                                order.quantity || 0
                            }ê°œ)`,
                            ì£¼ì†Œ: order.address || "",
                            ìƒì„¸ì£¼ì†Œ: order.detailAddress || "",
                            ë°°ì†¡ë©”ì„¸ì§€: order.memo || "",
                            ë°°ì†¡ìƒíƒœ: order.status || "",
                        });
                    });

                    // ë°ì´í„° ê°œìˆ˜ í™•ì¸
                    if (filteredData.length > 10000) {
                        const confirm = window.confirm(
                            `ì´ ${filteredData.length.toLocaleString()}ê±´ì˜ ë°ì´í„°ë¥¼ ë‚´ë³´ëƒ…ë‹ˆë‹¤.\n` +
                                `ì²˜ë¦¬ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
                        );
                        if (!confirm) {
                            return;
                        }
                    }

                    // Excel íŒŒì¼ ìƒì„±
                    const ws = XLSX.utils.json_to_sheet(filteredData);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "ì£¼ë¬¸ëª©ë¡_AIìš©");

                    const fileName = `ì£¼ë¬¸ëª©ë¡_AIìš©_${
                        new Date().toISOString().split("T")[0]
                    }_${filteredData.length}ê±´.xlsx`;
                    XLSX.writeFile(wb, fileName);

                    // ì™„ë£Œ ë©”ì‹œì§€
                    alert(
                        `AIìš© Excel íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ ${filteredData.length.toLocaleString()}ê±´ì˜ ë°ì´í„°ê°€ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.`
                    );
                } catch (error) {
                    console.error("AIìš© Excel ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:", error);
                    alert("AIìš© Excel ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                } finally {
                    // ë²„íŠ¼ ë³µì›
                    exportBtn.disabled = false;
                    exportBtn.innerHTML = originalText;
                }
            };

            // ëª¨ë“  ì •ë³´ Excel ë‚´ë³´ë‚´ê¸° (íƒë°°ì‚¬/ì†¡ì¥ë²ˆí˜¸/ì‘ì—…ê¹Œì§€ ëª¨ë‘)
            window.exportToExcelFull = function () {
                // ë¡œë”© í‘œì‹œ
                const exportBtn = document.querySelector(
                    'button[onclick="exportToExcelFull()"]'
                );
                const originalText = exportBtn.innerHTML;
                exportBtn.disabled = true;
                exportBtn.innerHTML =
                    '<svg class="inline-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg> ì²˜ë¦¬ì¤‘...';

                try {
                    // í•„í„°ë§ëœ ì „ì²´ ë°ì´í„° ì‚¬ìš© (í˜ì´ì§€ë„¤ì´ì…˜ ë¬´ê´€)
                    if (!allFilteredData || allFilteredData.length === 0) {
                        alert("ë‚´ë³´ë‚¼ ì£¼ë¬¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                        return;
                    }

                    // í•„í„°ë§ëœ ì „ì²´ ë°ì´í„° ìˆ˜ì§‘ (ì „ì²´ ì •ë³´)
                    const filteredData = [];
                    let processedCount = 0;
                    const totalCount = allFilteredData.length;

                    allFilteredData.forEach(([id, order]) => {
                        processedCount++;

                        // 1000ê±´ë§ˆë‹¤ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
                        if (processedCount % 1000 === 0) {
                            const progress = Math.round(
                                (processedCount / totalCount) * 100
                            );
                            exportBtn.innerHTML = `<svg class="inline-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg> ${progress}%`;
                        }

                        // ì£¼ë¬¸ ë°ì´í„°ë¥¼ Excel í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ì „ì²´ ì •ë³´)
                        filteredData.push({
                            ì£¼ë¬¸ë²ˆí˜¸: order.orderNumber || "",
                            ì£¼ë¬¸ì‹œê°„: order.createdAt
                                ? new Date(order.createdAt).toLocaleString(
                                      "ko-KR"
                                  )
                                : "",
                            ì…ê¸ˆìëª…: order.customerName || "",
                            ì—°ë½ì²˜: order.phone || "",
                            ì£¼ë¬¸ìœ í˜•: order.orderType || "ì‹ ê·œì£¼ë¬¸",
                            ê¸°ì¡´ì£¼ë¬¸ë²ˆí˜¸: order.existingOrderNumber || "-",
                            êµ¬ë§¤ì œí’ˆ: `${order.product || ""} (${
                                order.quantity || 0
                            }ê°œ)`,
                            ì£¼ì†Œ: order.address || "",
                            ìƒì„¸ì£¼ì†Œ: order.detailAddress || "",
                            ë°°ì†¡ë©”ì„¸ì§€: order.memo || "",
                            ë°°ì†¡ìƒíƒœ: order.status || "",
                            íƒë°°ì‚¬: order.courier || "-",
                            ì†¡ì¥ë²ˆí˜¸: order.invoiceNumber || "-",
                        });
                    });

                    // ë°ì´í„° ê°œìˆ˜ í™•ì¸
                    if (filteredData.length > 10000) {
                        const confirm = window.confirm(
                            `ì´ ${filteredData.length.toLocaleString()}ê±´ì˜ ë°ì´í„°ë¥¼ ë‚´ë³´ëƒ…ë‹ˆë‹¤.\n` +
                                `ì²˜ë¦¬ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
                        );
                        if (!confirm) {
                            return;
                        }
                    }

                    // Excel íŒŒì¼ ìƒì„±
                    const ws = XLSX.utils.json_to_sheet(filteredData);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "ì£¼ë¬¸ëª©ë¡_ì „ì²´");

                    const fileName = `ì£¼ë¬¸ëª©ë¡_ì „ì²´_${
                        new Date().toISOString().split("T")[0]
                    }_${filteredData.length}ê±´.xlsx`;
                    XLSX.writeFile(wb, fileName);

                    // ì™„ë£Œ ë©”ì‹œì§€
                    alert(
                        `ì „ì²´ Excel íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ ${filteredData.length.toLocaleString()}ê±´ì˜ ë°ì´í„°ê°€ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.`
                    );
                } catch (error) {
                    console.error("ì „ì²´ Excel ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:", error);
                    alert("ì „ì²´ Excel ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                } finally {
                    // ë²„íŠ¼ ë³µì›
                    exportBtn.disabled = false;
                    exportBtn.innerHTML = originalText;
                }
            };
        </script>
    </body>
</html>
