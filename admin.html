<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>0000ÏÖÄÎü¨ Ï£ºÎ¨∏ Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <!-- ÏÑ§Ï†ï ÌååÏùº Ï†úÍ±∞: Î™®Î∞îÏùº/Î∞∞Ìè¨ ÌôòÍ≤ΩÏóêÏÑú Î°úÎî© Ïù¥Ïäà Î∞©ÏßÄ -->
        <!-- <script src="config.js"></script> -->
        <!-- Firebase Authentication SDK Ï∂îÍ∞Ä -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
            import {
                getAuth,
                signInWithEmailAndPassword,
                signOut,
                onAuthStateChanged,
            } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

            // Firebase ÏÑ§Ï†ï (ÌïòÎìúÏΩîÎî©)
            const firebaseConfig = {
                apiKey: "AIzaSyA4Z1B42fmBIJznBED11XIIiVVKN5OSQ1E",
                authDomain: "seller1-b8a4c.firebaseapp.com",
                projectId: "seller1-b8a4c",
                storageBucket: "seller1-b8a4c.firebasestorage.app",
                messagingSenderId: "740000823974",
                appId: "1:740000823974:web:ac62ca392ffb34e96e9267",
                measurementId: "G-Q8ZNT6PDB9",
                databaseURL:
                    "https://seller1-b8a4c-default-rtdb.asia-southeast1.firebasedatabase.app",
            };

            // Firebase Ï¥àÍ∏∞Ìôî
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);

            // Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú authÏôÄ app Í∞ùÏ≤¥ ÏÑ§Ï†ï
            window.auth = auth;
            window.app = app;

            // Ïù∏Ï¶ù ÏÉÅÌÉú Î≥ÄÍ≤Ω Í∞êÏßÄ
            // Ï¥àÍ∏∞ Î†åÎçîÎßÅ Ïãú Î™®Îã¨ ÍπúÎπ°ÏûÑ Î∞©ÏßÄ: DOMContentLoaded Ïù¥ÌõÑÏóê ÏÉÅÌÉú Î∞òÏòÅ
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ
                    document.getElementById("loginModal").style.display =
                        "none";
                    document.getElementById("mainContent").style.display =
                        "block";
                    const userInfo = document.getElementById("userInfo");
                    const userInfoSpan = userInfo
                        ? userInfo.querySelector("span")
                        : null;
                    if (userInfoSpan) {
                        userInfoSpan.textContent = `Í¥ÄÎ¶¨Ïûê: ${user.email}`;
                    }
                    if (userInfo) userInfo.style.display = "flex";
                    const logoutBtn = document.getElementById("logoutBtn");
                    if (logoutBtn) logoutBtn.style.display = "inline-flex";

                    // Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ ÌôòÏòÅ ÏïåÎ¶º ÌëúÏãú (ÏÑ∏ÏÖòÎãπ 1Ìöå)
                    try {
                        const key = `loginWelcomeShown_${user.uid}`;
                        if (!sessionStorage.getItem(key)) {
                            alert(
                                `üéâ Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ!\nÌôòÏòÅÌï©ÎãàÎã§, ${user.email}Îãò!\n\n Ï£ºÎ¨∏ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖúÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§.`
                            );
                            sessionStorage.setItem(key, "1");
                        }
                    } catch (_) {}

                    // Î°úÍ∑∏Ïù∏ ÏßÅÌõÑ Îç∞Ïù¥ÌÑ∞Í∞Ä ÎπÑÏñ¥ Î≥¥Ïù¥Îäî ÌòÑÏÉÅ Î∞©ÏßÄ: Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ® Ìä∏Î¶¨Í±∞
                    try {
                        setTimeout(() => {
                            if (typeof window.refreshOrders === "function")
                                window.refreshOrders();
                        }, 0);
                    } catch (_) {}
                } else {
                    // Î°úÍ∑∏ÏïÑÏõÉ ÏÉÅÌÉú
                    document.getElementById("loginModal").style.display =
                        "flex";
                    document.getElementById("mainContent").style.display =
                        "none";
                    const userInfo = document.getElementById("userInfo");
                    const userInfoSpan = userInfo
                        ? userInfo.querySelector("span")
                        : null;
                    if (userInfoSpan) userInfoSpan.textContent = "";
                    if (userInfo) userInfo.style.display = "none";
                    const logoutBtn = document.getElementById("logoutBtn");
                    if (logoutBtn) logoutBtn.style.display = "none";
                }
            });

            // Î°úÍ∑∏Ïù∏ Ìï®Ïàò
            window.login = async function () {
                const email = document.getElementById("loginEmail").value;
                const password = document.getElementById("loginPassword").value;

                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    document.getElementById("loginError").textContent = "";
                } catch (error) {
                    document.getElementById("loginError").textContent =
                        "Ïù¥Î©îÏùº Ï£ºÏÜå Î∞è ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.";
                }
            };

            // Î°úÍ∑∏ÏïÑÏõÉ Ìï®Ïàò
            window.logout = function () {
                try {
                    const user = auth.currentUser;
                    if (user) {
                        sessionStorage.removeItem(
                            `loginWelcomeShown_${user.uid}`
                        );
                    }
                } catch (_) {}
                signOut(auth);
            };
        </script>
        <style>
            * {
                box-sizing: border-box;
            }

            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background-color: #f8f9fa;
                line-height: 1.45;
                -webkit-text-size-adjust: 100%;
            }

            /* Î°úÍ∑∏Ïù∏ Î™®Îã¨ Ïä§ÌÉÄÏùº */
            .login-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            }

            .login-container {
                background: white;
                padding: 40px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                width: 100%;
                max-width: 400px;
                text-align: center;
            }

            .login-container h2 {
                margin: 0 0 30px 0;
                color: #333;
                font-size: 24px;
            }

            .password-container {
                position: relative;
                width: 100%;
                margin: 10px 0;
            }

            .login-input {
                width: 100%;
                padding: 12px;
                padding-right: 45px;
                margin: 0;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 16px;
                box-sizing: border-box;
            }

            .password-toggle {
                position: absolute;
                right: 8px;
                top: 50%;
                transform: translateY(-50%);
                background: none;
                border: none;
                cursor: pointer;
                padding: 8px;
                border-radius: 4px;
                transition: background-color 0.2s ease;
            }

            .password-toggle:hover {
                background-color: #f0f0f0;
            }

            .eye-icon {
                width: 20px;
                height: 20px;
                color: #666;
            }

            .password-toggle.hide .eye-icon {
                color: #999;
            }

            .login-btn {
                width: 100%;
                padding: 12px;
                background: #007bff;
                color: white;
                border: none;
                border-radius: 6px;
                font-size: 16px;
                cursor: pointer;
                margin-top: 20px;
            }

            .login-btn:hover {
                background: #0056b3;
            }

            .login-error {
                color: #dc3545;
                margin-top: 10px;
                font-size: 14px;
            }

            .user-info {
                background: transparent;
                padding: 0;
                border-radius: 0;
                margin: 0;
                display: flex;
                gap: 12px;
                align-items: center;
            }

            .logout-btn {
                background: #dc3545;
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 6px;
                cursor: pointer;
            }

            .logout-btn:hover {
                background: #c82333;
            }

            .header {
                background: white;
                padding: 28px;
                border-radius: 16px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                margin-bottom: 24px;
                border: 1px solid #f1f3f4;
                position: relative;
            }

            .header h1 {
                margin: 0 0 20px 0;
                color: #212529;
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 24px;
                font-weight: 600;
            }

            .header-stats {
                display: flex;
                gap: 32px;
                margin-bottom: 20px;
                padding: 20px;
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 12px;
                color: #333;
            }

            .stats-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                flex: 1;
            }

            .stats-item .stats-label {
                font-size: 13px;
                color: #6c757d;
                margin-bottom: 6px;
                font-weight: 500;
            }

            .stats-item .stats-number {
                font-size: 24px;
                font-weight: 700;
                color: #212529;
            }

            .status-bar {
                display: flex;
                justify-content: flex-end;
                align-items: center;
            }

            .status-indicator {
                display: inline-block;
                width: 16px;
                height: 16px;
                border-radius: 50%;
                margin-left: 12px;
                vertical-align: middle;
                border: 2px solid #ddd;
                animation: pulse 2s infinite;
            }

            .status-indicator.connected {
                background-color: #28a745;
                border-color: #28a745;
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
                animation: pulse 2s infinite;
            }

            .status-indicator.disconnected {
                background-color: #dc3545;
                border-color: #dc3545;
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
                animation: pulse-disconnected 2s infinite;
            }

            @keyframes pulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
                }
            }

            @keyframes pulse-disconnected {
                0% {
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
                }
            }

            .controls {
                display: flex;
                gap: 10px;
            }

            .btn {
                padding: 12px 20px;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                min-height: 44px;
                transition: all 0.2s ease;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
                font-weight: 500;
            }

            .btn-primary {
                background-color: #007bff;
                color: white;
            }

            .btn-primary:hover {
                background-color: #0056b3;
                transform: translateY(-1px);
            }

            .btn-success {
                background-color: #6fcf97;
                color: white;
            }

            .btn-success:hover {
                background-color: #5ab885;
                transform: translateY(-1px);
            }

            .btn-info {
                background-color: #6fcf97;
                color: white;
            }

            .btn-info:hover {
                background-color: #5ab885;
                transform: translateY(-1px);
            }

            .btn-warning {
                background-color: #ffc107;
                color: #212529;
            }

            .btn-warning:hover {
                background-color: #e0a800;
                transform: translateY(-1px);
            }

            .btn-danger {
                background-color: #dc3545;
                color: white;
            }

            .btn-danger:hover {
                background-color: #c82333;
                transform: translateY(-1px);
            }

            .btn-exchange {
                background-color: #fd7e14;
                color: white;
            }

            .btn-exchange:hover {
                background-color: #e8650e;
                transform: translateY(-1px);
            }

            .btn-return {
                background-color: #6f42c1;
                color: white;
            }

            .btn-return:hover {
                background-color: #5a32a3;
                transform: translateY(-1px);
            }

            .main-content {
                display: block;
                width: 100%;
            }

            .orders-section {
                background: white;
                border-radius: 16px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                overflow: hidden;
                border: 1px solid #f1f3f4;
            }

            .section-header {
                padding: 24px;
                border-bottom: 1px solid #f1f3f4;
                background-color: #fafbfc;
            }

            .section-header h2 {
                margin: 0;
                color: #212529;
                font-size: 18px;
                font-weight: 600;
            }

            .filters {
                display: flex;
                flex-direction: column;
                gap: 12px;
                margin-top: 10px;
            }

            .search-fields {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }

            .search-input {
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 14px;
                min-width: 200px;
                flex: 1;
            }

            .search-input:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
            }

            .filter-selects {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }

            .filter-select {
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 14px;
            }

            .table-container {
                overflow-x: auto;
                max-height: 600px;
                overflow-y: auto;
            }

            .orders-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 14px;
            }

            .orders-table th {
                background-color: #f8f9fa;
                border: 1px solid #dee2e6;
                padding: 12px 8px;
                text-align: left;
                font-weight: 600;
                color: #495057;
                position: sticky;
                top: 0;
                z-index: 10;
            }

            .orders-table td {
                border: 1px solid #dee2e6;
                padding: 8px;
                vertical-align: top;
            }

            .status-badge {
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 12px;
                font-weight: 500;
            }

            .status-Ï†ëÏàò {
                background-color: #fff3cd;
                color: #856404;
            }

            .status-Î∞∞ÏÜ°Ï§ë {
                background-color: #d1ecf1;
                color: #0c5460;
            }

            .status-Î∞∞ÏÜ°ÏôÑÎ£å {
                background-color: #d4edda;
                color: #155724;
            }

            .status-Ï∑®ÏÜå {
                background-color: #f5c6cb;
                color: #721c24;
            }

            .order-type-badge {
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 11px;
                font-weight: 500;
                background-color: #e3f2fd;
                color: #1976d2;
            }

            .status-select {
                padding: 4px 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 12px;
            }

            .sidebar {
                background: white;
                border-radius: 16px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                padding: 24px;
                border: 1px solid #f1f3f4;
            }

            .recent-orders {
                margin-top: 20px;
            }

            .recent-orders h3 {
                margin: 0 0 16px 0;
                color: #212529;
                font-size: 16px;
                font-weight: 600;
            }

            .recent-order-item {
                padding: 12px;
                border: 1px solid #f1f3f4;
                border-radius: 8px;
                margin-bottom: 12px;
                background-color: #fafbfc;
                transition: all 0.2s ease;
            }

            .recent-order-item:hover {
                border-color: #e1e5e9;
                background-color: #f8f9fa;
            }

            /* SVG Icon Styles */
            .inline-icon {
                width: 18px;
                height: 18px;
                vertical-align: middle;
                margin-right: 6px;
            }

            .recent-order-item h4 {
                margin: 0 0 5px 0;
                font-size: 14px;
                color: #333;
            }

            .recent-order-item p {
                margin: 0;
                font-size: 12px;
                color: #666;
            }

            /* ÏùºÍ¥Ñ Ï≤òÎ¶¨ ÎèÑÍµ¨ Ïä§ÌÉÄÏùº */
            .bulk-actions {
                background-color: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                padding: 16px;
                margin-bottom: 16px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-wrap: wrap;
                gap: 12px;
            }

            .bulk-actions-info {
                font-weight: 600;
                color: #495057;
            }

            .bulk-actions-buttons {
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
            }

            .btn-sm {
                padding: 8px 12px;
                font-size: 12px;
                min-height: 36px;
            }

            /* Ï≤¥ÌÅ¨Î∞ïÏä§ Ïä§ÌÉÄÏùº */
            .order-checkbox {
                width: 16px;
                height: 16px;
                cursor: pointer;
            }

            #selectAll {
                width: 16px;
                height: 16px;
                cursor: pointer;
            }

            @media (max-width: 768px) {
                body {
                    padding: 8px;
                    font-size: 13px;
                }

                .header {
                    padding: 12px;
                    border-radius: 12px;
                }

                .header h1 {
                    font-size: 20px;
                    margin-bottom: 16px;
                }

                .header-stats {
                    flex-direction: column;
                    gap: 10px;
                    padding: 12px;
                }

                .stats-item {
                    flex-direction: row;
                    justify-content: space-between;
                    width: 100%;
                }

                .stats-item .stats-number {
                    font-size: 16px;
                }

                .stats-item .stats-label {
                    font-size: 11px;
                }

                .main-content {
                    grid-template-columns: 1fr;
                    gap: 12px;
                }

                .filters {
                    flex-direction: column;
                    gap: 8px;
                }

                .search-fields {
                    flex-direction: column;
                    gap: 8px;
                }

                .search-input {
                    min-width: auto;
                    width: 100%;
                }

                .filter-selects {
                    flex-direction: column;
                    gap: 8px;
                }

                .controls {
                    flex-direction: column;
                    gap: 8px;
                }

                .orders-table {
                    font-size: 11px;
                }

                .orders-table th,
                .orders-table td {
                    padding: 4px 2px;
                }

                .btn {
                    padding: 8px 12px;
                    min-height: 40px;
                    font-size: 13px;
                }
            }

            /* Simple Footer */
            .simple-footer {
                margin-top: 40px;
                padding: 20px 0;
                text-align: center;
                border-top: 1px solid #e9ecef;
            }

            .simple-footer a {
                color: #6c757d;
                text-decoration: none;
                font-size: 12px;
                transition: color 0.2s ease;
            }

            .simple-footer a:hover {
                color: #495057;
            }
        </style>
    </head>
    <body>
        <!-- Î°úÍ∑∏Ïù∏ Î™®Îã¨ -->
        <div id="loginModal" class="login-modal" style="display: none">
            <div class="login-container">
                <h2>Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏</h2>
                <input
                    type="email"
                    id="loginEmail"
                    class="login-input"
                    placeholder="Ïù¥Î©îÏùº Ï£ºÏÜå"
                    required
                />
                <div class="password-container">
                    <input
                        type="password"
                        id="loginPassword"
                        class="login-input"
                        placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏"
                        required
                    />
                    <button
                        type="button"
                        class="password-toggle"
                        onclick="togglePassword()"
                    >
                        <svg
                            class="eye-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                        >
                            <path
                                d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"
                            />
                        </svg>
                    </button>
                </div>
                <button onclick="login()" class="login-btn">Î°úÍ∑∏Ïù∏</button>
                <div id="loginError" class="login-error"></div>
            </div>
        </div>

        <script>
            // Enter ÌÇ§Î°ú Î°úÍ∑∏Ïù∏
            document
                .getElementById("loginPassword")
                .addEventListener("keypress", function (e) {
                    if (e.key === "Enter") {
                        login();
                    }
                });

            // ÎπÑÎ∞ÄÎ≤àÌò∏ ÌëúÏãú/Ïà®ÍπÄ ÌÜ†Í∏Ä Ìï®Ïàò
            function togglePassword() {
                const passwordInput = document.getElementById("loginPassword");
                const toggleBtn = document.querySelector(".password-toggle");

                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleBtn.classList.add("hide");
                    toggleBtn.innerHTML = `
                        <svg class="eye-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
                        </svg>
                    `;
                } else {
                    passwordInput.type = "password";
                    toggleBtn.classList.remove("hide");
                    toggleBtn.innerHTML = `
                        <svg class="eye-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                        </svg>
                    `;
                }
            }
        </script>

        <!-- ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î∞è Î°úÍ∑∏ÏïÑÏõÉ Î≤ÑÌäº -->
        <!-- ÏúÑÏπòÎ•º Ìó§Îçî ÎÇ¥Î∂ÄÎ°ú Ïù¥Îèô (h1Í≥º Ï¢åÏö∞ Ï†ïÎ†¨) -->

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div id="mainContent" style="display: none">
            <!-- ÏÉÅÎã® Ìë∏ÌÑ∞ -->
            <div
                class="top-footer"
                style="
                    background: #f8f9fa;
                    border-bottom: 1px solid #e9ecef;
                    padding: 8px 0;
                    text-align: center;
                    position: sticky;
                    top: 0;
                    z-index: 1000;
                "
            >
                <a
                    href="https://cx-tech-builder.netlify.app/"
                    target="_blank"
                    style="
                        color: #6c757d;
                        text-decoration: none;
                        font-size: 12px;
                        transition: color 0.2s ease;
                    "
                >
                    Powered by CX Tech Builder
                </a>
            </div>

            <div class="header">
                <div
                    class="header-title-row"
                    style="
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        gap: 16px;
                    "
                >
                    <h1 style="margin: 0">
                        <svg
                            class="inline-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                        >
                            <path
                                d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                            />
                        </svg>
                        0000ÏÖÄÎü¨ Ï£ºÎ¨∏ Ï†ëÏàò Í¥ÄÎ¶¨Ïûê<span
                            id="status"
                            class="status-indicator disconnected"
                        ></span>
                    </h1>
                    <div
                        id="userInfo"
                        class="user-info"
                        style="display: none; position: static; gap: 8px"
                    >
                        <span style="font-size: 14px; color: #495057"></span>
                        <button
                            id="logoutBtn"
                            onclick="logout()"
                            class="btn btn-primary"
                            style="min-height: 36px; padding: 8px 12px"
                        >
                            Î°úÍ∑∏ÏïÑÏõÉ
                        </button>
                    </div>
                </div>
                <div class="header-stats">
                    <div class="stats-item">
                        <span class="stats-label">Ïò§Îäò Ïã†Í∑úÏ£ºÎ¨∏</span>
                        <span class="stats-number" id="todayNewOrders">0</span>
                    </div>
                    <div class="stats-item">
                        <span class="stats-label">ÍµêÌôòÏ†ëÏàò ÏßÑÌñâÏ§ë</span>
                        <span class="stats-number" id="todayExchangeRequests"
                            >0</span
                        >
                    </div>
                    <div class="stats-item">
                        <span class="stats-label">Î∞òÌíàÏ†ëÏàò ÏßÑÌñâÏ§ë</span>
                        <span class="stats-number" id="todayReturnRequests"
                            >0</span
                        >
                    </div>
                    <div class="stats-item">
                        <span class="stats-label">Ï∑®ÏÜå ÏöîÏ≤≠ ÏßÑÌñâÏ§ë</span>
                        <span class="stats-number" id="todayCancelRequests"
                            >0</span
                        >
                    </div>
                </div>
                <div class="status-bar">
                    <div class="controls">
                        <button
                            class="btn btn-warning"
                            onclick="filterNewOrdersInProgress()"
                        >
                            <svg
                                class="inline-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                                />
                            </svg>
                            Ïã†Í∑úÏ£ºÎ¨∏ ÏßÑÌñâÏ§ë
                        </button>
                        <button
                            class="btn btn-exchange"
                            onclick="filterExchangeInProgress()"
                        >
                            <svg
                                class="inline-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                                />
                            </svg>
                            ÍµêÌôòÏ†ëÏàò ÏßÑÌñâÏ§ë
                        </button>
                        <button
                            class="btn btn-return"
                            onclick="filterReturnInProgress()"
                        >
                            <svg
                                class="inline-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M19 7h-8v6h8V7zm-2 4h-4V9h4v2zm4-12H3C1.9 1 1 1.9 1 3v18c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 18H3V5h18v14z"
                                />
                            </svg>
                            Î∞òÌíàÏ†ëÏàò ÏßÑÌñâÏ§ë
                        </button>
                        <button
                            class="btn btn-danger"
                            onclick="filterCancelInProgress()"
                        >
                            <svg
                                class="inline-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                />
                            </svg>
                            Ï∑®ÏÜåÏöîÏ≤≠ ÏßÑÌñâÏ§ë
                        </button>
                        <button
                            class="btn btn-secondary"
                            onclick="showAllOrders()"
                        >
                            <svg
                                class="inline-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"
                                />
                            </svg>
                            Ï†ÑÏ≤¥ Î≥¥Í∏∞
                        </button>
                        <button
                            class="btn btn-info"
                            onclick="exportToExcelFull()"
                        >
                            <svg
                                class="inline-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"
                                />
                            </svg>
                            Ï£ºÎ¨∏ÎÇ¥Ïó≠ ÎÇ¥Î≥¥ÎÇ¥Í∏∞(ÏóëÏÖÄ)
                        </button>
                        <button
                            class="btn btn-outline"
                            onclick="openInvoiceUploadModal()"
                        >
                            <svg
                                class="inline-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"
                                />
                            </svg>
                            ÏÜ°Ïû• ÏóÖÎ°úÎìú
                        </button>
                        <button
                            class="btn btn-primary"
                            onclick="refreshOrders()"
                        >
                            <svg
                                class="inline-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"
                                />
                            </svg>
                            ÏÉàÎ°úÍ≥†Ïπ®
                        </button>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="orders-section">
                    <div class="section-header">
                        <h2>
                            <svg
                                class="inline-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"
                                />
                            </svg>
                            Ï£ºÎ¨∏ Î™©Î°ù
                        </h2>
                        <div
                            class="auto-complete-info"
                            style="
                                margin-top: 8px;
                                padding: 8px 12px;
                                background: #f8f9fa;
                                font-size: 12px;
                                color: #6c757d;
                            "
                        >
                            <svg
                                class="inline-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                                style="color: #6c757d"
                            >
                                <path
                                    d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                                />
                            </svg>
                            <span
                                >‚úÖ ÏÜ°Ïû•Î≤àÌò∏ Îì±Î°ù ÌõÑ 3ÏòÅÏóÖÏùº(Ï£ºÎßê/Í≥µÌú¥Ïùº Ï†úÏô∏)Ïù¥
                                ÏßÄÎÇòÎ©¥ ÏûêÎèôÏúºÎ°ú Î∞∞ÏÜ°ÏôÑÎ£å Ï≤òÎ¶¨Îê©ÎãàÎã§.</span
                            >
                        </div>

                        <!-- ÌòÑÏû¨ ÌïÑÌÑ∞ ÏÉÅÌÉú ÌëúÏãú -->
                        <div
                            id="currentFilterStatus"
                            style="
                                margin-top: 8px;
                                padding: 8px 12px;
                                background: #e3f2fd;
                                font-size: 12px;
                                color: #1976d2;
                                display: none;
                            "
                        >
                            <svg
                                class="inline-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                                style="color: #1976d2"
                            >
                                <path
                                    d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"
                                />
                            </svg>
                            <span id="filterStatusText"
                                >ÌòÑÏû¨ ÌïÑÌÑ∞Í∞Ä Ï†ÅÏö©ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.</span
                            >
                        </div>

                        <!-- Í¥ÄÎ†® Ï£ºÎ¨∏ Î™®Îã¨ -->
                        <div
                            id="relatedOrdersModal"
                            style="
                                display: none;
                                position: fixed;
                                inset: 0;
                                background: rgba(0, 0, 0, 0.4);
                                align-items: center;
                                justify-content: center;
                                z-index: 2000;
                            "
                        >
                            <div
                                style="
                                    background: #fff;
                                    padding: 24px;
                                    border-radius: 12px;
                                    width: 90%;
                                    max-width: 1200px;
                                    max-height: 90vh;
                                    overflow-y: auto;
                                "
                            >
                                <div
                                    style="
                                        display: flex;
                                        justify-content: space-between;
                                        align-items: center;
                                        margin-bottom: 20px;
                                    "
                                >
                                    <h3 style="margin: 0; color: #212529">
                                        <svg
                                            class="inline-icon"
                                            viewBox="0 0 24 24"
                                            fill="currentColor"
                                            style="color: #007bff"
                                        >
                                            <path
                                                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"
                                            />
                                        </svg>
                                        ÏõêÏ£ºÎ¨∏Î≤àÌò∏:
                                        <span
                                            id="modalOrderNumber"
                                            style="
                                                color: #007bff;
                                                font-weight: bold;
                                            "
                                        ></span>
                                    </h3>
                                    <button
                                        class="btn"
                                        onclick="closeRelatedOrdersModal()"
                                        style="
                                            background: #6c757d;
                                            color: white;
                                            padding: 8px 16px;
                                            border: none;
                                            border-radius: 6px;
                                            cursor: pointer;
                                        "
                                    >
                                        ‚úï Îã´Í∏∞
                                    </button>
                                </div>

                                <div id="relatedOrdersContent">
                                    <!-- Í¥ÄÎ†® Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                                </div>
                            </div>
                        </div>

                        <!-- ÏÜ°Ïû• ÏóÖÎ°úÎìú Î™®Îã¨ -->
                        <div
                            id="invoiceUploadModal"
                            style="
                                display: none;
                                position: fixed;
                                inset: 0;
                                background: rgba(0, 0, 0, 0.4);
                                align-items: center;
                                justify-content: center;
                                z-index: 2000;
                            "
                        >
                            <div
                                style="
                                    background: #fff;
                                    padding: 20px;
                                    border-radius: 10px;
                                    width: 420px;
                                    max-width: 90%;
                                "
                            >
                                <h3 style="margin-top: 0">ÏÜ°Ïû•Î≤àÌò∏ ÏóÖÎ°úÎìú</h3>
                                <p style="color: #666; font-size: 13px">
                                    ÏóëÏÖÄ ÏñëÏãù: Ï£ºÎ¨∏Î≤àÌò∏ / ÌÉùÎ∞∞ÏÇ¨ / ÏÜ°Ïû•Î≤àÌò∏
                                </p>
                                <div
                                    style="
                                        display: flex;
                                        gap: 8px;
                                        margin: 10px 0 16px;
                                    "
                                >
                                    <button
                                        class="btn btn-secondary btn-sm"
                                        onclick="downloadInvoiceTemplate()"
                                    >
                                        ÏñëÏãù ÎÇ¥Î†§Î∞õÍ∏∞
                                    </button>
                                    <label
                                        class="btn btn-primary btn-sm"
                                        style="
                                            cursor: pointer;
                                            display: inline-flex;
                                            align-items: center;
                                            justify-content: center;
                                        "
                                    >
                                        ÌååÏùº ÏÑ†ÌÉù
                                        <input
                                            id="invoiceFileInput"
                                            type="file"
                                            accept=".xlsx,.xls"
                                            style="display: none"
                                            onchange="previewInvoiceFile()"
                                        />
                                    </label>
                                    <button
                                        id="uploadBtn"
                                        class="btn btn-success btn-sm"
                                        onclick="startInvoiceImport()"
                                        disabled
                                    >
                                        ÏóÖÎ°úÎìú
                                    </button>
                                </div>
                                <div
                                    id="invoiceImportStatus"
                                    style="font-size: 12px; color: #555"
                                ></div>
                                <div
                                    id="invoicePreview"
                                    style="
                                        margin: 10px 0;
                                        padding: 10px;
                                        background: #f8f9fa;
                                        border-radius: 4px;
                                        display: none;
                                    "
                                ></div>
                                <div
                                    style="text-align: right; margin-top: 12px"
                                >
                                    <button
                                        class="btn"
                                        onclick="closeInvoiceUploadModal()"
                                    >
                                        Îã´Í∏∞
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="filters">
                            <div class="search-fields">
                                <input
                                    type="text"
                                    id="phoneSearch"
                                    class="search-input"
                                    placeholder="Ìú¥ÎåÄÌè∞Î≤àÌò∏ Í≤ÄÏÉâ"
                                    onkeyup="filterOrders()"
                                />
                                <input
                                    type="text"
                                    id="orderNumberSearch"
                                    class="search-input"
                                    placeholder="Ï£ºÎ¨∏Î≤àÌò∏ Í≤ÄÏÉâ"
                                    onkeyup="filterOrders()"
                                />
                            </div>

                            <div class="filter-selects">
                                <select
                                    id="orderTypeFilter"
                                    class="filter-select"
                                    onchange="filterOrders()"
                                >
                                    <option value="">Ï†ÑÏ≤¥ Ï£ºÎ¨∏Ïú†Ìòï</option>
                                    <option value="Ïã†Í∑úÏ£ºÎ¨∏">Ïã†Í∑úÏ£ºÎ¨∏</option>
                                    <option value="ÍµêÌôò">ÍµêÌôò</option>
                                    <option value="Î∞òÌíà">Î∞òÌíà</option>
                                    <option value="Ï∑®ÏÜå">Ï∑®ÏÜå</option>
                                </select>
                                <select
                                    id="statusFilter"
                                    class="filter-select"
                                    onchange="filterOrders()"
                                >
                                    <option value="">Ï†ÑÏ≤¥ Î∞∞ÏÜ°ÏÉÅÌÉú</option>
                                    <option value="Ï†ëÏàò">Ï†ëÏàò</option>
                                    <option value="Î∞∞ÏÜ°Ï§ë">Î∞∞ÏÜ°Ï§ë</option>
                                    <option value="Î∞∞ÏÜ°ÏôÑÎ£å">Î∞∞ÏÜ°ÏôÑÎ£å</option>
                                    <option value="Ï∑®ÏÜå">Ï∑®ÏÜå</option>
                                </select>
                                <select
                                    id="dateFilter"
                                    class="filter-select"
                                    onchange="filterOrders()"
                                >
                                    <option value="">Ï†ÑÏ≤¥ Í∏∞Í∞Ñ</option>
                                    <option value="recent3days" selected>
                                        ÏµúÍ∑º 3Ïùº
                                    </option>
                                    <option value="today">Ïò§Îäò</option>
                                    <option value="week">Ïù¥Î≤à Ï£º</option>
                                </select>
                                <select
                                    id="itemsPerPageFilter"
                                    class="filter-select"
                                    onchange="changeItemsPerPage(this.value)"
                                >
                                    <option value="30" selected>
                                        30Í∞úÏî© Î≥¥Í∏∞
                                    </option>
                                    <option value="50">50Í∞úÏî© Î≥¥Í∏∞</option>
                                    <option value="100">100Í∞úÏî© Î≥¥Í∏∞</option>
                                </select>
                                <button
                                    class="btn btn-primary btn-sm"
                                    onclick="refreshOrders()"
                                >
                                    <svg
                                        class="inline-icon"
                                        viewBox="0 0 24 24"
                                        fill="currentColor"
                                    >
                                        <path
                                            d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"
                                        />
                                    </svg>
                                    ÏÉàÎ°úÍ≥†Ïπ®
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <!-- ÏùºÍ¥Ñ Ï≤òÎ¶¨ ÎèÑÍµ¨ -->
                        <div class="bulk-actions" style="display: none">
                            <div class="bulk-actions-info">
                                <span id="selectedCount">0Í∞ú ÏÑ†ÌÉùÎê®</span>
                            </div>
                            <div class="bulk-actions-buttons">
                                <button
                                    class="btn btn-success btn-sm"
                                    onclick="bulkUpdateStatus('Î∞∞ÏÜ°ÏôÑÎ£å')"
                                >
                                    <svg
                                        class="inline-icon"
                                        viewBox="0 0 24 24"
                                        fill="currentColor"
                                    >
                                        <path
                                            d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                                        />
                                    </svg>
                                    ÏÑ†ÌÉùÎêú Ï£ºÎ¨∏ Î∞∞ÏÜ°ÏôÑÎ£å
                                </button>
                                <button
                                    class="btn btn-warning btn-sm"
                                    onclick="bulkUpdateStatus('Î∞∞ÏÜ°Ï§ë')"
                                >
                                    <svg
                                        class="inline-icon"
                                        viewBox="0 0 24 24"
                                        fill="currentColor"
                                    >
                                        <path
                                            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                                        />
                                    </svg>
                                    ÏÑ†ÌÉùÎêú Ï£ºÎ¨∏ Î∞∞ÏÜ°Ï§ë
                                </button>
                                <button
                                    class="btn btn-danger btn-sm"
                                    onclick="bulkUpdateStatus('Ï∑®ÏÜå')"
                                >
                                    <svg
                                        class="inline-icon"
                                        viewBox="0 0 24 24"
                                        fill="currentColor"
                                    >
                                        <path
                                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                        />
                                    </svg>
                                    ÏÑ†ÌÉùÎêú Ï£ºÎ¨∏ Ï∑®ÏÜå
                                </button>
                            </div>
                        </div>

                        <table class="orders-table" id="ordersTable">
                            <thead>
                                <tr>
                                    <th>
                                        <input
                                            type="checkbox"
                                            id="selectAll"
                                            onchange="toggleSelectAll()"
                                            title="Ï†ÑÏ≤¥ ÏÑ†ÌÉù"
                                        />
                                    </th>
                                    <th>Ï£ºÎ¨∏Î≤àÌò∏</th>
                                    <th>Ï£ºÎ¨∏ÏãúÍ∞Ñ</th>
                                    <th>ÏûÖÍ∏àÏûêÎ™Ö</th>
                                    <th>Ïó∞ÎùΩÏ≤ò</th>
                                    <th>Ï£ºÎ¨∏Ïú†Ìòï</th>
                                    <th>Í∏∞Ï°¥Ï£ºÎ¨∏Î≤àÌò∏</th>
                                    <th>Íµ¨Îß§Ï†úÌíà</th>
                                    <th>Ï£ºÏÜå</th>
                                    <th>ÏÉÅÏÑ∏Ï£ºÏÜå</th>
                                    <th>Î∞∞ÏÜ°Î©îÏÑ∏ÏßÄ</th>
                                    <th>Î∞∞ÏÜ°ÏÉÅÌÉú</th>
                                    <th>ÌÉùÎ∞∞ÏÇ¨</th>
                                    <th>ÏÜ°Ïû•Î≤àÌò∏</th>
                                    <th>ÏûëÏóÖ</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <!-- Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞Í∞Ä Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                            </tbody>
                        </table>

                        <!-- ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥ Î∞è ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
                        <div
                            class="pagination-container"
                            style="margin-top: 20px; text-align: center"
                        >
                            <div
                                id="pageInfo"
                                style="
                                    margin-bottom: 15px;
                                    color: #666;
                                    font-size: 14px;
                                "
                            >
                                <!-- ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                            </div>
                            <div
                                class="pagination-controls"
                                style="
                                    display: flex;
                                    justify-content: center;
                                    gap: 10px;
                                    align-items: center;
                                "
                            >
                                <button
                                    class="btn btn-outline-primary btn-sm"
                                    onclick="changePage(1)"
                                    id="firstPage"
                                >
                                    Ï≤òÏùå
                                </button>
                                <button
                                    class="btn btn-outline-primary btn-sm"
                                    onclick="changePage(currentPage - 1)"
                                    id="prevPage"
                                >
                                    Ïù¥Ï†Ñ
                                </button>
                                <span id="pageNumbers" style="margin: 0 15px">
                                    <!-- ÌéòÏù¥ÏßÄ Î≤àÌò∏Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                                </span>
                                <button
                                    class="btn btn-outline-primary btn-sm"
                                    onclick="changePage(currentPage + 1)"
                                    id="nextPage"
                                >
                                    Îã§Ïùå
                                </button>
                                <button
                                    class="btn btn-outline-primary btn-sm"
                                    onclick="changePage(Math.ceil(allFilteredData.length / itemsPerPage))"
                                    id="lastPage"
                                >
                                    ÎßàÏßÄÎßâ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simple Footer -->
            <footer class="simple-footer">
                <!-- cx-tech-builder ÎßÅÌÅ¨Îäî Ï£ºÎ¨∏ Î™©Î°ù ÏÑπÏÖòÏúºÎ°ú Ïù¥ÎèôÎê® -->
            </footer>

            <!-- Firebase SDK -->
            <script type="module">
                // Import the functions you need from the SDKs you need
                import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
                import {
                    getDatabase,
                    ref,
                    onValue,
                    set,
                    query,
                    orderByChild,
                    get,
                } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";
                import * as XLSX from "https://cdn.jsdelivr.net/npm/xlsx@0.18.5/+esm";

                // Firebase ÏÑ§Ï†ïÏùÄ Ïù¥ÎØ∏ headÏóêÏÑú Ï¥àÍ∏∞ÌôîÎê®
                const database = getDatabase(window.app);

                // DOM ÏöîÏÜåÎì§
                const statusDiv = document.getElementById("status");
                const ordersTableBody =
                    document.getElementById("ordersTableBody");
                const recentOrdersList =
                    document.getElementById("recentOrdersList");

                // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Í¥ÄÎ†® Î≥ÄÏàò
                let currentPage = 1;
                let itemsPerPage = 30;
                let allFilteredData = [];

                // ÌïÑÌÑ∞ ÏÉÅÌÉú Ï†ÄÏû• Î≥ÄÏàò
                let currentFilterState = {
                    type: null, // 'newOrders', 'exchangeReturn', 'all'
                    filters: {},
                    searchTerms: {},
                };

                // Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏
                const connectedRef = ref(database, ".info/connected");
                onValue(connectedRef, (snap) => {
                    if (snap.val() === true) {
                        statusDiv.className = "status-indicator connected";
                    } else {
                        statusDiv.className = "status-indicator disconnected";
                    }
                });

                // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞Î•º ÏàòÏßëÌïòÎäî Í≥µÌÜµ Ìï®Ïàò
                function collectAllOrders(data) {
                    if (!data) return [];

                    let allEntries = [];
                    for (const [key, value] of Object.entries(data)) {
                        // ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞Ïù∏ÏßÄ ÌôïÏù∏ (YYYY-MM ÌòïÏãù)
                        if (
                            key.match(/^\d{4}-\d{2}$/) &&
                            value &&
                            typeof value === "object"
                        ) {
                            // ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞
                            const monthOrderEntries = Object.entries(value);
                            allEntries = allEntries.concat(monthOrderEntries);
                        } else if (
                            value &&
                            typeof value === "object" &&
                            value.orderNumber
                        ) {
                            // Í∏∞Ï°¥ Íµ¨Ï°∞ (ÏßÅÏ†ë Ï£ºÎ¨∏ Í∞ùÏ≤¥)
                            allEntries.push([key, value]);
                        } else if (value && typeof value === "object") {
                            // Í∏∞ÌÉÄ Ìè¥Îçî Íµ¨Ï°∞
                            const folderOrderEntries = Object.entries(value);
                            allEntries = allEntries.concat(folderOrderEntries);
                        }
                    }
                    return allEntries;
                }

                // Ï£ºÎ¨∏ IDÎ°ú ÏõîÎ≥Ñ Ìè¥Îçî Í≤ΩÎ°úÎ•º Ï∞æÎäî Ìï®Ïàò
                async function findOrderPath(orderId) {
                    try {
                        console.log("Ï£ºÎ¨∏ Í≤ΩÎ°ú Í≤ÄÏÉâ ÏãúÏûë:", orderId);
                        const ordersRef = ref(database, "orders");
                        const snapshot = await get(ordersRef);
                        const data = snapshot.val();

                        if (!data) {
                            console.log("Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§");
                            return null;
                        }

                        console.log("Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞:", Object.keys(data));

                        // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ Í≤ÄÏÉâ (ÏõîÎ≥Ñ Ìè¥Îçî + Í∏∞Ï°¥ Íµ¨Ï°∞)
                        for (const [key, value] of Object.entries(data)) {
                            // ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞Ïù∏ÏßÄ ÌôïÏù∏ (YYYY-MM ÌòïÏãù)
                            if (
                                key.match(/^\d{4}-\d{2}$/) &&
                                value &&
                                typeof value === "object"
                            ) {
                                console.log(
                                    `${key} (ÏõîÎ≥Ñ Ìè¥Îçî)ÏóêÏÑú Í≤ÄÏÉâ Ï§ë...`,
                                    Object.keys(value)
                                );
                                if (value[orderId]) {
                                    const path = `orders/${key}/${orderId}`;
                                    console.log(
                                        "Ï£ºÎ¨∏ Í≤ΩÎ°ú Ï∞æÏùå (ÏõîÎ≥Ñ Ìè¥Îçî):",
                                        path
                                    );
                                    return path;
                                }
                            } else if (
                                value &&
                                typeof value === "object" &&
                                value.orderNumber
                            ) {
                                // Í∏∞Ï°¥ Íµ¨Ï°∞ (ÏßÅÏ†ë Ï£ºÎ¨∏ Í∞ùÏ≤¥)
                                if (key === orderId) {
                                    const path = `orders/${orderId}`;
                                    console.log(
                                        "Ï£ºÎ¨∏ Í≤ΩÎ°ú Ï∞æÏùå (Í∏∞Ï°¥ Íµ¨Ï°∞):",
                                        path
                                    );
                                    return path;
                                }
                            } else if (value && typeof value === "object") {
                                // Í∏∞ÌÉÄ Ìè¥Îçî Íµ¨Ï°∞
                                console.log(
                                    `${key} (Í∏∞ÌÉÄ Ìè¥Îçî)ÏóêÏÑú Í≤ÄÏÉâ Ï§ë...`,
                                    Object.keys(value)
                                );
                                if (value[orderId]) {
                                    const path = `orders/${key}/${orderId}`;
                                    console.log(
                                        "Ï£ºÎ¨∏ Í≤ΩÎ°ú Ï∞æÏùå (Í∏∞ÌÉÄ Ìè¥Îçî):",
                                        path
                                    );
                                    return path;
                                }
                            }
                        }
                        console.log("Ï£ºÎ¨∏ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå:", orderId);
                        return null;
                    } catch (error) {
                        console.error("Ï£ºÎ¨∏ Í≤ΩÎ°ú Ï∞æÍ∏∞ Ïò§Î•ò:", error);
                        return null;
                    }
                }

                // Ïã§ÏãúÍ∞Ñ Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞ Î¶¨Ïä§ÎÑà (ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞ ÏßÄÏõê)
                const ordersRef = ref(database, "orders");
                onValue(ordersRef, (snapshot) => {
                    const data = snapshot.val();

                    // ÌïÑÌÑ∞ ÏÉÅÌÉúÍ∞Ä ÏûàÏúºÎ©¥ Ìï¥Îãπ ÌïÑÌÑ∞ Ï†ÅÏö©, ÏóÜÏúºÎ©¥ Ï†ÑÏ≤¥ ÌëúÏãú
                    if (
                        currentFilterState.type &&
                        currentFilterState.type !== "all"
                    ) {
                        applyCurrentFilter(data);
                    } else {
                        updateOrdersTable(data);
                        updateStats(data);
                        updateRecentOrders(data);
                    }

                    // 3ÏùºÏù¥ ÏßÄÎÇú Î∞∞ÏÜ°Ï§ë Ï£ºÎ¨∏ ÏûêÎèô ÏôÑÎ£å Ï≤òÎ¶¨
                    autoCompleteShippedOrders(data);
                });

                // ÌòÑÏû¨ ÌïÑÌÑ∞ ÏÉÅÌÉúÎ•º Ï†ÅÏö©ÌïòÎäî Ìï®Ïàò (ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞ ÏßÄÏõê)
                function applyCurrentFilter(data) {
                    if (!data || !currentFilterState.type) return;

                    // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                    const allEntries = collectAllOrders(data);
                    let filteredEntries = allEntries;

                    switch (currentFilterState.type) {
                        case "newOrders":
                            filteredEntries = filteredEntries.filter(
                                ([id, order]) => {
                                    return (
                                        order.orderType === "Ïã†Í∑úÏ£ºÎ¨∏" &&
                                        (order.status === "Ï†ëÏàò" ||
                                            order.status === "Î∞∞ÏÜ°Ï§ë")
                                    );
                                }
                            );
                            break;
                        case "exchangeReturn":
                            filteredEntries = filteredEntries.filter(
                                ([id, order]) => {
                                    return (
                                        ["ÍµêÌôò", "Î∞òÌíà", "Ï∑®ÏÜå"].includes(
                                            order.orderType
                                        ) &&
                                        (order.status === "Ï†ëÏàò" ||
                                            order.status === "Î∞∞ÏÜ°Ï§ë")
                                    );
                                }
                            );
                            break;
                        default:
                            break;
                    }

                    // ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞Î°ú ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏ (ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïú†ÏßÄ)
                    const filteredData = {};
                    filteredEntries.forEach(([id, order]) => {
                        filteredData[id] = order;
                    });

                    // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïú†ÏßÄ (Î¶¨ÏÖãÌïòÏßÄ ÏïäÏùå)
                    allFilteredData = Object.entries(filteredData);
                    updatePagination();
                    // ÌÜµÍ≥ÑÎäî Ìï≠ÏÉÅ Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏ (ÎØ∏Ï≤òÎ¶¨ Ï≤¥ÌÅ¨ Í∞úÎÖê Ïú†ÏßÄ)
                    updateStats(data);
                    updateRecentOrders(filteredData);

                    // ÌïÑÌÑ∞ ÏÉÅÌÉú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                    updateFilterStatusDisplay();
                }

                // ÌïÑÌÑ∞ ÏÉÅÌÉú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                function updateFilterStatusDisplay() {
                    const filterStatus = document.getElementById(
                        "currentFilterStatus"
                    );
                    const filterStatusText =
                        document.getElementById("filterStatusText");

                    if (
                        currentFilterState.type &&
                        currentFilterState.type !== "all"
                    ) {
                        let statusText = "";
                        switch (currentFilterState.type) {
                            case "newOrders":
                                statusText =
                                    "Ïã†Í∑úÏ£ºÎ¨∏ ÏßÑÌñâÏ§ë ÌïÑÌÑ∞Í∞Ä Ï†ÅÏö©ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.";
                                break;
                            case "exchange":
                                statusText =
                                    "ÍµêÌôòÏ†ëÏàò ÏßÑÌñâÏ§ë ÌïÑÌÑ∞Í∞Ä Ï†ÅÏö©ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.";
                                break;
                            case "return":
                                statusText =
                                    "Î∞òÌíàÏ†ëÏàò ÏßÑÌñâÏ§ë ÌïÑÌÑ∞Í∞Ä Ï†ÅÏö©ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.";
                                break;
                            case "cancel":
                                statusText =
                                    "Ï∑®ÏÜåÏöîÏ≤≠ ÏßÑÌñâÏ§ë ÌïÑÌÑ∞Í∞Ä Ï†ÅÏö©ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.";
                                break;
                            case "exchangeReturn":
                                statusText =
                                    "ÍµêÌôò/Î∞òÌíà/Ï∑®ÏÜå ÏßÑÌñâÏ§ë ÌïÑÌÑ∞Í∞Ä Ï†ÅÏö©ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.";
                                break;
                        }
                        filterStatusText.textContent = statusText;
                        filterStatus.style.display = "block";
                    } else {
                        filterStatus.style.display = "none";
                    }
                }

                // Í¥ÄÎ†® Ï£ºÎ¨∏ Î™®Îã¨ Ï†úÏñ¥
                window.showRelatedOrdersModal = async function (orderNumber) {
                    try {
                        // Î™®Îã¨ ÌëúÏãú
                        document.getElementById(
                            "relatedOrdersModal"
                        ).style.display = "flex";
                        document.getElementById(
                            "modalOrderNumber"
                        ).textContent = orderNumber;

                        // Î°úÎî© ÌëúÏãú
                        document.getElementById(
                            "relatedOrdersContent"
                        ).innerHTML =
                            '<div style="text-align: center; padding: 40px; color: #666;">Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>';

                        // Í¥ÄÎ†® Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå
                        const allSnap = await get(ref(database, "orders"));
                        const all = allSnap.val() || {};

                        // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                        const allOrders = collectAllOrders(all);

                        // Ìï¥Îãπ Ï£ºÎ¨∏Î≤àÌò∏ÏôÄ Í¥ÄÎ†®Îêú Î™®Îì† Ï£ºÎ¨∏ Ï∞æÍ∏∞
                        const relatedOrders = [];

                        // 1. ÏõêÏ£ºÎ¨∏ Ï∞æÍ∏∞
                        const originalOrderEntry = allOrders.find(
                            ([id, order]) =>
                                order && order.orderNumber === orderNumber
                        );

                        if (originalOrderEntry) {
                            const [id, order] = originalOrderEntry;
                            relatedOrders.push({
                                id: id,
                                order: order,
                                type: "ÏõêÏ£ºÎ¨∏",
                            });
                        }

                        // 2. Í¥ÄÎ†® ÌÅ¥Î†àÏûÑÎì§ Ï∞æÍ∏∞ (ÍµêÌôò/Î∞òÌíà/Ï∑®ÏÜå)
                        allOrders.forEach(([id, order]) => {
                            if (
                                order &&
                                order.existingOrderNumber === orderNumber
                            ) {
                                relatedOrders.push({
                                    id: id,
                                    order: order,
                                    type: "ÌÅ¥Î†àÏûÑ",
                                });
                            }
                        });

                        // Ï£ºÎ¨∏ ÏãúÍ∞ÑÏàúÏúºÎ°ú Ï†ïÎ†¨
                        relatedOrders.sort(
                            (a, b) => a.order.createdAt - b.order.createdAt
                        );

                        // Î™®Îã¨ ÎÇ¥Ïö© ÏóÖÎç∞Ïù¥Ìä∏
                        updateRelatedOrdersModal(relatedOrders);
                    } catch (error) {
                        console.error("Í¥ÄÎ†® Ï£ºÎ¨∏ Ï°∞Ìöå Ïò§Î•ò:", error);
                        document.getElementById(
                            "relatedOrdersContent"
                        ).innerHTML =
                            '<div style="text-align: center; padding: 40px; color: #dc3545;">Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</div>';
                    }
                };

                window.closeRelatedOrdersModal = function () {
                    document.getElementById(
                        "relatedOrdersModal"
                    ).style.display = "none";
                };

                // Í¥ÄÎ†® Ï£ºÎ¨∏ Î™®Îã¨ ÎÇ¥Ïö© ÏóÖÎç∞Ïù¥Ìä∏
                function updateRelatedOrdersModal(relatedOrders) {
                    if (relatedOrders.length === 0) {
                        document.getElementById(
                            "relatedOrdersContent"
                        ).innerHTML =
                            '<div style="text-align: center; padding: 40px; color: #666;">Í¥ÄÎ†®Îêú Ï£ºÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§.</div>';
                        return;
                    }

                    let modalHTML = `
                     <div style="margin-bottom: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                         <div style="font-weight: 600; color: #495057; margin-bottom: 8px;">üìä Í¥ÄÎ†® Ï£ºÎ¨∏ ÏöîÏïΩ</div>
                         <div style="display: flex; gap: 20px; font-size: 14px;">
                             <span>Ï¥ù ${relatedOrders.length}Í±¥</span>
                             <span>ÏõêÏ£ºÎ¨∏: ${
                                 relatedOrders.filter(
                                     (o) => o.type === "ÏõêÏ£ºÎ¨∏"
                                 ).length
                             }Í±¥</span>
                             <span>ÌÅ¥Î†àÏûÑ: ${
                                 relatedOrders.filter(
                                     (o) => o.type === "ÌÅ¥Î†àÏûÑ"
                                 ).length
                             }Í±¥</span>
                         </div>
                     </div>
                     
                     <div style="overflow-x: auto;">
                         <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                             <thead>
                                 <tr style="background: #f8f9fa;">
                                     <th style="padding: 12px 8px; border: 1px solid #dee2e6; text-align: left;">Ïú†Ìòï</th>
                                     <th style="padding: 12px 8px; border: 1px solid #dee2e6; text-align: left;">Ï£ºÎ¨∏Î≤àÌò∏</th>
                                     <th style="padding: 12px 8px; border: 1px solid #dee2e6; text-align: left;">Ï£ºÎ¨∏ÏãúÍ∞Ñ</th>
                                     <th style="padding: 12px 8px; border: 1px solid #dee2e6; text-align: left;">ÏûÖÍ∏àÏûêÎ™Ö</th>
                                     <th style="padding: 12px 8px; border: 1px solid #dee2e6; text-align: left;">Ïó∞ÎùΩÏ≤ò</th>
                                     <th style="padding: 12px 8px; border: 1px solid #dee2e6; text-align: left;">Ï£ºÎ¨∏Ïú†Ìòï</th>
                                     <th style="padding: 12px 8px; border: 1px solid #dee2e6; text-align: left;">Íµ¨Îß§Ï†úÌíà</th>
                                     <th style="padding: 12px 8px; border: 1px solid #dee2e6; text-align: left;">Î∞∞ÏÜ°ÏÉÅÌÉú</th>
                                     <th style="padding: 12px 8px; border: 1px solid #dee2e6; text-align: left;">ÏûëÏóÖ</th>
                                 </tr>
                             </thead>
                             <tbody>
                 `;

                    relatedOrders.forEach(({ id, order, type }) => {
                        const orderDate = new Date(order.createdAt);
                        const typeBadge =
                            type === "ÏõêÏ£ºÎ¨∏"
                                ? '<span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px;">ÏõêÏ£ºÎ¨∏</span>'
                                : '<span style="background: #ffc107; color: #212529; padding: 4px 8px; border-radius: 12px; font-size: 11px;">ÌÅ¥Î†àÏûÑ</span>';

                        modalHTML += `
                         <tr style="border-bottom: 1px solid #f1f3f4;">
                             <td style="padding: 12px 8px; border: 1px solid #dee2e6;">${typeBadge}</td>
                             <td style="padding: 12px 8px; border: 1px solid #dee2e6;"><strong>${
                                 order.orderNumber
                             }</strong></td>
                             <td style="padding: 12px 8px; border: 1px solid #dee2e6;">${orderDate.toLocaleString(
                                 "ko-KR"
                             )}</td>
                             <td style="padding: 12px 8px; border: 1px solid #dee2e6;">${
                                 order.customerName || ""
                             }</td>
                             <td style="padding: 12px 8px; border: 1px solid #dee2e6;">${
                                 order.phone || ""
                             }</td>
                             <td style="padding: 12px 8px; border: 1px solid #dee2e6;">
                                 <span style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 12px; font-size: 11px;">
                                     ${order.orderType || "Ïã†Í∑úÏ£ºÎ¨∏"}
                                 </span>
                             </td>
                             <td style="padding: 12px 8px; border: 1px solid #dee2e6;">${
                                 order.product || ""
                             } (${order.quantity || 0}Í∞ú)</td>
                             <td style="padding: 12px 8px; border: 1px solid #dee2e6;">
                                 <span style="background: ${getStatusColor(
                                     order.status
                                 )}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px;">
                                     ${order.status}
                                 </span>
                             </td>
                             <td style="padding: 12px 8px; border: 1px solid #dee2e6;">
                                 <select onchange="updateOrderStatusFromModal('${id}', this.value)" style="padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                                     <option value="Ï†ëÏàò" ${
                                         order.status === "Ï†ëÏàò"
                                             ? "selected"
                                             : ""
                                     }>Ï†ëÏàò</option>
                                     <option value="Î∞∞ÏÜ°Ï§ë" ${
                                         order.status === "Î∞∞ÏÜ°Ï§ë"
                                             ? "selected"
                                             : ""
                                     }>Î∞∞ÏÜ°Ï§ë</option>
                                     <option value="Î∞∞ÏÜ°ÏôÑÎ£å" ${
                                         order.status === "Î∞∞ÏÜ°ÏôÑÎ£å"
                                             ? "selected"
                                             : ""
                                     }>Î∞∞ÏÜ°ÏôÑÎ£å</option>
                                     <option value="Ï∑®ÏÜå" ${
                                         order.status === "Ï∑®ÏÜå"
                                             ? "selected"
                                             : ""
                                     }>Ï∑®ÏÜå</option>
                                 </select>
                             </td>
                         </tr>
                     `;
                    });

                    modalHTML += `
                             </tbody>
                         </table>
                     </div>
                     
                     <div style="margin-top: 20px; padding: 16px; background: #e3f2fd; border-radius: 8px; border: 1px solid #bbdefb;">
                         <div style="font-weight: 600; color: #1976d2; margin-bottom: 8px;">üí° ÏûëÏóÖ ÌåÅ</div>
                         <div style="font-size: 13px; color: #1976d2; line-height: 1.5;">
                             ‚Ä¢ ÏõêÏ£ºÎ¨∏Í≥º Í¥ÄÎ†® ÌÅ¥Î†àÏûÑÎì§Ïùò ÏÉÅÌÉúÎ•º ÏùºÍ¥ÑÏ†ÅÏúºÎ°ú Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÏäµÎãàÎã§.<br>
                             ‚Ä¢ ÌÅ¥Î†àÏûÑÏù¥ ÏßÑÌñâ Ï§ëÏù∏ Í≤ΩÏö∞ ÏõêÏ£ºÎ¨∏ ÏÉÅÌÉú Î≥ÄÍ≤Ω Ïãú Ï£ºÏùòÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.<br>
                             ‚Ä¢ Î™®Îì† Í¥ÄÎ†® Ï£ºÎ¨∏Ïùò ÏÉÅÌÉúÎ•º ÌôïÏù∏ÌïòÍ≥† ÏùºÍ¥ÄÏÑ± ÏûàÍ≤å Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî.
                         </div>
                     </div>
                 `;

                    document.getElementById("relatedOrdersContent").innerHTML =
                        modalHTML;
                }

                // ÏÉÅÌÉúÎ≥Ñ ÏÉâÏÉÅ Î∞òÌôò
                function getStatusColor(status) {
                    switch (status) {
                        case "Ï†ëÏàò":
                            return "#ffc107";
                        case "Î∞∞ÏÜ°Ï§ë":
                            return "#17a2b8";
                        case "Î∞∞ÏÜ°ÏôÑÎ£å":
                            return "#28a745";
                        case "Ï∑®ÏÜå":
                            return "#dc3545";
                        default:
                            return "#6c757d";
                    }
                }

                // Î™®Îã¨ÏóêÏÑú Ï£ºÎ¨∏ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                window.updateOrderStatusFromModal = async function (
                    orderId,
                    newStatus
                ) {
                    try {
                        await updateOrderStatus(orderId, newStatus);

                        // Î™®Îã¨ ÏÉàÎ°úÍ≥†Ïπ® (ÏÉÅÌÉú Î≥ÄÍ≤Ω ÌõÑ ÏµúÏã† Îç∞Ïù¥ÌÑ∞ Î∞òÏòÅ)
                        const orderNumber =
                            document.getElementById(
                                "modalOrderNumber"
                            ).textContent;
                        await showRelatedOrdersModal(orderNumber);
                    } catch (error) {
                        console.error("Î™®Îã¨ÏóêÏÑú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:", error);
                        alert("ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
                    }
                };

                // ÏÜ°Ïû• ÏóÖÎ°úÎìú Î™®Îã¨ Ï†úÏñ¥
                window.openInvoiceUploadModal = function () {
                    document.getElementById(
                        "invoiceUploadModal"
                    ).style.display = "flex";
                    document.getElementById("invoiceImportStatus").textContent =
                        "";
                    document.getElementById("invoicePreview").style.display =
                        "none";
                    document.getElementById("uploadBtn").disabled = true;
                    const fileInput =
                        document.getElementById("invoiceFileInput");
                    if (fileInput) fileInput.value = "";
                };
                window.closeInvoiceUploadModal = function () {
                    document.getElementById(
                        "invoiceUploadModal"
                    ).style.display = "none";
                };

                // ÏÜ°Ïû• ÏñëÏãù Îã§Ïö¥Î°úÎìú
                window.downloadInvoiceTemplate = function () {
                    const headers = [
                        {
                            Ï£ºÎ¨∏Î≤àÌò∏: "ORD20240101000000",
                            ÌÉùÎ∞∞ÏÇ¨: "CJÎåÄÌïúÌÜµÏö¥",
                            ÏÜ°Ïû•Î≤àÌò∏: "123456789012",
                        },
                    ];
                    const ws = XLSX.utils.json_to_sheet(headers);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "ÏÜ°Ïû•ÏóÖÎ°úÎìúÏñëÏãù");
                    XLSX.writeFile(wb, "ÏÜ°Ïû•ÏóÖÎ°úÎìú_ÏñëÏãù.xlsx");
                };

                // ÌååÏùº ÏÑ†ÌÉù ÌõÑ ÎØ∏Î¶¨Î≥¥Í∏∞
                window.previewInvoiceFile = async function () {
                    const input = document.getElementById("invoiceFileInput");
                    const preview = document.getElementById("invoicePreview");
                    const uploadBtn = document.getElementById("uploadBtn");
                    const status = document.getElementById(
                        "invoiceImportStatus"
                    );

                    if (!input || !input.files || input.files.length === 0) {
                        preview.style.display = "none";
                        uploadBtn.disabled = true;
                        return;
                    }

                    try {
                        status.textContent = "ÌååÏùº Î∂ÑÏÑù Ï§ë...";
                        preview.style.display = "none";

                        const file = input.files[0];
                        const data = await file.arrayBuffer();
                        const workbook = XLSX.read(data);
                        const sheetName = workbook.SheetNames[0];
                        const rows = XLSX.utils.sheet_to_json(
                            workbook.Sheets[sheetName],
                            { defval: "" }
                        );

                        if (rows.length === 0) {
                            status.textContent = "ÌååÏùºÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.";
                            uploadBtn.disabled = true;
                            return;
                        }

                        // Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù
                        let validRows = 0,
                            invalidRows = 0;
                        const sampleData = [];

                        for (let i = 0; i < Math.min(rows.length, 5); i++) {
                            const row = rows[i];
                            const orderNumber = String(
                                row["Ï£ºÎ¨∏Î≤àÌò∏"] || ""
                            ).trim();
                            const courier = String(row["ÌÉùÎ∞∞ÏÇ¨"] || "").trim();
                            const invoice = String(
                                row["ÏÜ°Ïû•Î≤àÌò∏"] || ""
                            ).trim();

                            if (orderNumber && courier && invoice) {
                                validRows++;
                                if (sampleData.length < 3) {
                                    sampleData.push({
                                        orderNumber: orderNumber,
                                        courier: courier,
                                        invoice: invoice,
                                    });
                                }
                            } else {
                                invalidRows++;
                            }
                        }

                        // ÎØ∏Î¶¨Î≥¥Í∏∞ ÌëúÏãú
                        let previewHTML = `
                        <div style="margin-bottom:10px;">
                            <strong>üìÅ ÌååÏùº Î∂ÑÏÑù Í≤∞Í≥º</strong>
                        </div>
                        <div style="font-size:12px; margin-bottom:8px;">
                            üìä Ï¥ù ${rows.length}Ìñâ, Ïú†Ìö® ${validRows}Ìñâ, Ïò§Î•ò ${invalidRows}Ìñâ
                        </div>
                    `;

                        if (sampleData.length > 0) {
                            previewHTML += `
                            <div style="font-size:12px; margin-bottom:8px;">
                                <strong>üìã ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ (Ï≤òÏùå 3Í±¥):</strong>
                            </div>
                            <div style="font-size:11px; color:#666;">
                        `;

                            sampleData.forEach((item, index) => {
                                previewHTML += `
                                ${index + 1}. ${item.orderNumber} | ${
                                    item.courier
                                } | ${item.invoice}<br>
                            `;
                            });

                            previewHTML += `</div>`;
                        }

                        if (invalidRows > 0) {
                            previewHTML += `
                            <div style="font-size:12px; color:#dc3545; margin-top:8px;">
                                ‚ö†Ô∏è ${invalidRows}ÌñâÏóê ÌïÑÏàò Îç∞Ïù¥ÌÑ∞Í∞Ä ÎàÑÎùΩÎêòÏñ¥ ÏûàÏäµÎãàÎã§.
                            </div>
                        `;
                        }

                        preview.innerHTML = previewHTML;
                        preview.style.display = "block";

                        // ÏóÖÎ°úÎìú Î≤ÑÌäº ÌôúÏÑ±Ìôî
                        uploadBtn.disabled = false;
                        status.textContent = `ÌååÏùº Ï§ÄÎπÑ ÏôÑÎ£å: ${rows.length}Ìñâ (${validRows}Í±¥ Ïú†Ìö®)`;
                    } catch (error) {
                        console.error("ÌååÏùº Î∂ÑÏÑù Ïò§Î•ò:", error);
                        status.textContent =
                            "ÌååÏùº Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.";
                        preview.style.display = "none";
                        uploadBtn.disabled = true;
                    }
                };

                // ÏÜ°Ïû• ÏóÖÎ°úÎìú Ï≤òÎ¶¨
                window.startInvoiceImport = async function () {
                    const input = document.getElementById("invoiceFileInput");
                    const status = document.getElementById(
                        "invoiceImportStatus"
                    );
                    if (!input || !input.files || input.files.length === 0) {
                        alert("ÏóÖÎ°úÎìúÌï† ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.");
                        return;
                    }
                    try {
                        status.textContent = "Ï≤òÎ¶¨ Ï§ë...";
                        const file = input.files[0];
                        const data = await file.arrayBuffer();
                        const workbook = XLSX.read(data);
                        const sheetName = workbook.SheetNames[0];
                        const rows = XLSX.utils.sheet_to_json(
                            workbook.Sheets[sheetName],
                            { defval: "" }
                        );

                        // rows: [{ Ï£ºÎ¨∏Î≤àÌò∏, ÌÉùÎ∞∞ÏÇ¨, ÏÜ°Ïû•Î≤àÌò∏ }]
                        let updated = 0,
                            notFound = 0,
                            errors = 0,
                            claimWarnings = 0;
                        const claimWarningOrders = [];
                        const allSnap = await get(ref(database, "orders"));
                        const all = allSnap.val() || {};

                        // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                        const allOrders = collectAllOrders(all);

                        const orderNumberToId = new Map();
                        allOrders.forEach(([id, o]) => {
                            if (o && o.orderNumber)
                                orderNumberToId.set(o.orderNumber, id);
                        });

                        for (const row of rows) {
                            const orderNumber = String(
                                row["Ï£ºÎ¨∏Î≤àÌò∏"] || ""
                            ).trim();
                            const courier = String(row["ÌÉùÎ∞∞ÏÇ¨"] || "").trim();
                            const invoice = String(
                                row["ÏÜ°Ïû•Î≤àÌò∏"] || ""
                            ).trim();
                            if (!orderNumber || !courier || !invoice) {
                                errors++;
                                continue;
                            }

                            const orderId = orderNumberToId.get(orderNumber);
                            if (!orderId) {
                                notFound++;
                                continue;
                            }

                            try {
                                const order = all[orderId];
                                if (!order) {
                                    notFound++;
                                    continue;
                                }

                                // ÌÅ¥Î†àÏûÑ Ï≤¥ÌÅ¨: Ìï¥Îãπ Ï£ºÎ¨∏Ïóê ÎåÄÌïú ÍµêÌôò/Î∞òÌíà/Ï∑®ÏÜåÍ∞Ä Ï†ëÏàò/Î∞∞ÏÜ°Ï§ëÏù∏ÏßÄ ÌôïÏù∏ (ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞)
                                const relatedClaims = allOrders
                                    .filter(
                                        ([id, o]) =>
                                            o &&
                                            o.existingOrderNumber ===
                                                order.orderNumber &&
                                            (o.orderType === "ÍµêÌôò" ||
                                                o.orderType === "Î∞òÌíà" ||
                                                o.orderType === "Ï∑®ÏÜå") &&
                                            (o.status === "Ï†ëÏàò" ||
                                                o.status === "Î∞∞ÏÜ°Ï§ë")
                                    )
                                    .map(([id, o]) => o);

                                // ÏÜ°Ïû• Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ (ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞)
                                const orderPath = await findOrderPath(orderId);
                                if (orderPath) {
                                    await set(
                                        ref(database, `${orderPath}/courier`),
                                        courier
                                    );
                                    await set(
                                        ref(
                                            database,
                                            `${orderPath}/invoiceNumber`
                                        ),
                                        invoice
                                    );
                                }

                                // ÌÅ¥Î†àÏûÑÏù¥ ÏóÜÏúºÎ©¥ Î∞∞ÏÜ°Ï§ëÏúºÎ°ú ÏûêÎèô Ï†ÑÌôò (ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞)
                                if (relatedClaims.length === 0 && orderPath) {
                                    await set(
                                        ref(database, `${orderPath}/status`),
                                        "Î∞∞ÏÜ°Ï§ë"
                                    );
                                    // Î∞∞ÏÜ° ÏãúÏûë ÏãúÍ∞Ñ Í∏∞Î°ù (3Ïùº ÌõÑ ÏûêÎèô ÏôÑÎ£åÏö©)
                                    await set(
                                        ref(
                                            database,
                                            `${orderPath}/shippingStartTime`
                                        ),
                                        Date.now()
                                    );
                                } else {
                                    // ÌÅ¥Î†àÏûÑÏù¥ ÏûàÏúºÎ©¥ Í≤ΩÍ≥† ÎàÑÏ†Å (ÏÜ°Ïû• Ï†ïÎ≥¥Îäî Ï†ÄÏû•ÎêòÏßÄÎßå ÏÉÅÌÉúÎäî Í∑∏ÎåÄÎ°ú)
                                    claimWarnings++;
                                    claimWarningOrders.push(order.orderNumber);
                                    console.warn(
                                        `ÌÅ¥Î†àÏûÑ ÏßÑÌñâ Ï§ë: ${order.orderNumber} (${relatedClaims.length}Í±¥)`
                                    );
                                }

                                updated++;
                            } catch (e) {
                                errors++;
                            }
                        }

                        let message = `ÏôÑÎ£å: ${updated}Í±¥ ÏóÖÎç∞Ïù¥Ìä∏, ${notFound}Í±¥ ÎØ∏Îß§Ïπ≠, ${errors}Í±¥ Ïò§Î•ò`;

                        // ÌÅ¥Î†àÏûÑ Í≤ΩÍ≥†Í∞Ä ÏûàÏúºÎ©¥ ÏïåÎüøÏóê Ìè¨Ìï®
                        if (claimWarnings > 0) {
                            message += `\n\n‚ö†Ô∏è ÌÅ¥Î†àÏûÑ ÏßÑÌñâ Ï§ëÏù∏ Ï£ºÎ¨∏ ${claimWarnings}Í±¥ÏùÄ ÏÜ°Ïû•Îßå Îì±Î°ùÎêòÍ≥† Î∞∞ÏÜ°Ï§ë Ï≤òÎ¶¨ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.`;
                            const sample = claimWarningOrders
                                .slice(0, 5)
                                .join(", ");
                            if (sample)
                                message += `\nÏòà: ${sample}${
                                    claimWarningOrders.length > 5 ? " Ïô∏" : ""
                                }`;
                            message += `\nÌï¥Îãπ Ï£ºÎ¨∏Ïùò ÍµêÌôò/Î∞òÌíà/Ï∑®ÏÜå ÏöîÏ≤≠ÏùÑ Î®ºÏ†Ä Ï≤òÎ¶¨Ìï¥Ï£ºÏÑ∏Ïöî.`;
                        } else {
                            message += `\n\n‚úÖ Ï†ïÏÉÅ Ï£ºÎ¨∏ ${updated}Í±¥ÏùÄ ÏÜ°Ïû• Îì±Î°ù ÌõÑ 3ÏòÅÏóÖÏùº ÌõÑ ÏûêÎèô Î∞∞ÏÜ°ÏôÑÎ£å Ï≤òÎ¶¨Îê©ÎãàÎã§.`;
                        }

                        status.textContent = message.split("\n")[0]; // Ï≤´ Ï§ÑÎßå statusÏóê ÌëúÏãú
                        alert(message);
                        // ÏóÖÎ°úÎìú ÏôÑÎ£å ÌõÑ ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®
                        try {
                            if (typeof window.refreshOrders === "function")
                                window.refreshOrders();
                        } catch (_) {}

                        // ÏÜ°Ïû• ÏóÖÎ°úÎìú ÌõÑ ÌòÑÏû¨ ÌïÑÌÑ∞ ÏÉÅÌÉú Ïú†ÏßÄ
                        // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑàÍ∞Ä ÏûêÎèôÏúºÎ°ú ÌïÑÌÑ∞Î•º Ï†ÅÏö©Ìï®
                    } catch (e) {
                        console.error(e);
                        alert("ÏóÖÎ°úÎìú Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
                    }
                };

                // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ìï®ÏàòÎì§
                function updatePagination() {
                    const totalPages = Math.ceil(
                        allFilteredData.length / itemsPerPage
                    );
                    const startIndex = (currentPage - 1) * itemsPerPage;
                    const endIndex = startIndex + itemsPerPage;

                    // ÌòÑÏû¨ ÌéòÏù¥ÏßÄ Îç∞Ïù¥ÌÑ∞Îßå ÌëúÏãú
                    const currentPageData = allFilteredData.slice(
                        startIndex,
                        endIndex
                    );

                    // ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
                    ordersTableBody.innerHTML = "";

                    if (currentPageData.length === 0) {
                        ordersTableBody.innerHTML =
                            '<tr><td colspan="14" style="text-align: center; padding: 20px;">ÌëúÏãúÌï† Ï£ºÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
                        return;
                    }

                    currentPageData.forEach(([id, order]) => {
                        const row = createOrderRow(id, order);
                        ordersTableBody.appendChild(row);
                    });

                    // ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥ ÌëúÏãú
                    updatePageInfo(totalPages);
                }

                function updatePageInfo(totalPages) {
                    const pageInfo = document.getElementById("pageInfo");
                    const pageNumbers = document.getElementById("pageNumbers");

                    if (pageInfo) {
                        pageInfo.innerHTML = `
                        <span>Ï¥ù ${allFilteredData.length}Í±¥ Ï§ë ${
                            (currentPage - 1) * itemsPerPage + 1
                        }-${Math.min(
                            currentPage * itemsPerPage,
                            allFilteredData.length
                        )}Í±¥ ÌëúÏãú</span>
                        <span style="margin-left: 20px;">ÌéòÏù¥ÏßÄ ${currentPage} / ${totalPages}</span>
                    `;
                    }

                    // ÌéòÏù¥ÏßÄ Î≤àÌò∏ Î≤ÑÌäº ÏÉùÏÑ±
                    if (pageNumbers && totalPages > 1) {
                        let pageButtons = "";
                        const startPage = Math.max(1, currentPage - 2);
                        const endPage = Math.min(totalPages, currentPage + 2);

                        for (let i = startPage; i <= endPage; i++) {
                            if (i === currentPage) {
                                pageButtons += `<button class="btn btn-primary btn-sm" style="margin: 0 2px;">${i}</button>`;
                            } else {
                                pageButtons += `<button class="btn btn-outline-primary btn-sm" style="margin: 0 2px;" onclick="changePage(${i})">${i}</button>`;
                            }
                        }
                        pageNumbers.innerHTML = pageButtons;
                    } else if (pageNumbers) {
                        pageNumbers.innerHTML = "";
                    }

                    // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Î≤ÑÌäº ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî
                    updatePaginationButtons(totalPages);
                }

                function updatePaginationButtons(totalPages) {
                    const firstPage = document.getElementById("firstPage");
                    const prevPage = document.getElementById("prevPage");
                    const nextPage = document.getElementById("nextPage");
                    const lastPage = document.getElementById("lastPage");

                    if (firstPage) firstPage.disabled = currentPage === 1;
                    if (prevPage) prevPage.disabled = currentPage === 1;
                    if (nextPage)
                        nextPage.disabled = currentPage === totalPages;
                    if (lastPage)
                        lastPage.disabled = currentPage === totalPages;
                }

                function changePage(page) {
                    const totalPages = Math.ceil(
                        allFilteredData.length / itemsPerPage
                    );
                    if (page >= 1 && page <= totalPages) {
                        currentPage = page;
                        updatePagination();
                    }
                }

                function changeItemsPerPage(newItemsPerPage) {
                    itemsPerPage = parseInt(newItemsPerPage);
                    currentPage = 1; // Ï≤´ ÌéòÏù¥ÏßÄÎ°ú Î¶¨ÏÖã
                    updatePagination();
                }

                // Ï£ºÎ¨∏ ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏ (ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞ ÏßÄÏõê)
                function updateOrdersTable(data) {
                    console.log("updateOrdersTable Ìò∏Ï∂úÎê®, Îç∞Ïù¥ÌÑ∞:", data);

                    if (!data) {
                        console.log("Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùå");
                        allFilteredData = [];
                        updatePagination();
                        return;
                    }

                    // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                    const allEntries = collectAllOrders(data);

                    console.log("Ï†ÑÏ≤¥ ÏàòÏßëÎêú Ï£ºÎ¨∏Îì§:", allEntries);

                    allFilteredData = filterOrdersData(allEntries).sort(
                        (a, b) => {
                            const aTime = a[1]?.createdAt || 0;
                            const bTime = b[1]?.createdAt || 0;
                            return bTime - aTime; // ÏµúÏã†Ïàú
                        }
                    );

                    // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò ÏóÖÎç∞Ïù¥Ìä∏
                    currentPage = 1; // Ï≤´ ÌéòÏù¥ÏßÄÎ°ú Î¶¨ÏÖã
                    updatePagination();
                }

                // Ï£ºÎ¨∏ Ìñâ ÏÉùÏÑ±
                function createOrderRow(id, order) {
                    const row = document.createElement("tr");
                    const orderDate = new Date(order.createdAt);

                    row.innerHTML = `
                <td>
                    <input type="checkbox" class="order-checkbox" value="${id}" data-status="${
                        order.status
                    }">
                </td>
                <td><strong>${order.orderNumber}</strong></td>
                <td>${orderDate.toLocaleString("ko-KR")}</td>
                <td>${order.customerName}</td>
                <td>${order.phone}</td>
                <td><span class="order-type-badge">${
                    order.orderType || "Ïã†Í∑úÏ£ºÎ¨∏"
                }</span></td>
                                 <td>
                     ${
                         order.existingOrderNumber
                             ? `<span class="existing-order-link" onclick="showRelatedOrdersModal('${order.existingOrderNumber}')" style="color: #007bff; cursor: pointer; text-decoration: underline;">${order.existingOrderNumber}</span>`
                             : "-"
                     }
                 </td>
                <td>${order.product} (${order.quantity}Í∞ú)</td>
                <td style="max-width: 150px; word-break: break-all;">${
                    order.address || ""
                }</td>
                <td style="max-width: 150px; word-break: break-all;">${
                    order.detailAddress || ""
                }</td>
                <td style="max-width: 150px; word-break: break-all;">${
                    order.memo || ""
                }${
                        order.refundAccount
                            ? `<br><br><strong>ÌôòÎ∂à Í≥ÑÏ¢åÏ†ïÎ≥¥:</strong><br>${order.refundAccount}`
                            : ""
                    }</td>
                <td>
                    <span class="status-badge status-${order.status}">${
                        order.status
                    }</span>
                </td>
                <td style="max-width: 120px; word-break: break-all;">${
                    order.courier || ""
                }</td>
                <td style="max-width: 140px; word-break: break-all;">${
                    order.invoiceNumber || ""
                }</td>
                <td>
                    <select class="status-select" onchange="updateOrderStatus('${id}', this.value)">
                        <option value="Ï†ëÏàò" ${
                            order.status === "Ï†ëÏàò" ? "selected" : ""
                        }>Ï†ëÏàò</option>
                        <option value="Î∞∞ÏÜ°Ï§ë" ${
                            order.status === "Î∞∞ÏÜ°Ï§ë" ? "selected" : ""
                        }>Î∞∞ÏÜ°Ï§ë</option>
                        <option value="Î∞∞ÏÜ°ÏôÑÎ£å" ${
                            order.status === "Î∞∞ÏÜ°ÏôÑÎ£å" ? "selected" : ""
                        }>Î∞∞ÏÜ°ÏôÑÎ£å</option>
                        <option value="Ï∑®ÏÜå" ${
                            order.status === "Ï∑®ÏÜå" ? "selected" : ""
                        }>Ï∑®ÏÜå</option>
                    </select>
                </td>
            `;

                    return row;
                }

                // Ï£ºÎ¨∏ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ (ÌÅ¥Î†àÏûÑ ÏÇ¨Ï†Ñ ÌôïÏù∏ Ìè¨Ìï®)
                window.updateOrderStatus = async function (orderId, newStatus) {
                    try {
                        console.log("ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë:", orderId, newStatus);

                        // ÎåÄÏÉÅ Ï£ºÎ¨∏ Ï°∞Ìöå (ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞)
                        const orderPath = await findOrderPath(orderId);
                        console.log("Ï∞æÏùÄ Ï£ºÎ¨∏ Í≤ΩÎ°ú:", orderPath);

                        if (!orderPath) {
                            console.error(
                                "Ï£ºÎ¨∏ Í≤ΩÎ°úÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:",
                                orderId
                            );
                            alert(
                                "Ï£ºÎ¨∏ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî."
                            );
                            return;
                        }

                        const orderSnap = await get(ref(database, orderPath));
                        const order = orderSnap.val();
                        if (!order) return;

                        // Î∞∞ÏÜ°Ï§ë/Î∞∞ÏÜ°ÏôÑÎ£åÎ°ú Î≥ÄÍ≤ΩÌïòÎäî Í≤ΩÏö∞, Ïó∞Í≥Ñ ÌÅ¥Î†àÏûÑ(ÍµêÌôò/Î∞òÌíà/Ï∑®ÏÜå) ÏßÑÌñâ Ïó¨Î∂Ä ÌôïÏù∏
                        if (
                            newStatus === "Î∞∞ÏÜ°Ï§ë" ||
                            newStatus === "Î∞∞ÏÜ°ÏôÑÎ£å"
                        ) {
                            // ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞ÏóêÏÑú Í¥ÄÎ†® ÌÅ¥Î†àÏûÑ Í≤ÄÏÉâ
                            const allSnap = await get(ref(database, `orders`));
                            const all = allSnap.val() || {};

                            const allOrders = collectAllOrders(all);

                            const relatedClaims = allOrders
                                .filter(
                                    ([id, o]) =>
                                        o &&
                                        o.existingOrderNumber ===
                                            order.orderNumber &&
                                        (o.orderType === "ÍµêÌôò" ||
                                            o.orderType === "Î∞òÌíà" ||
                                            o.orderType === "Ï∑®ÏÜå") &&
                                        (o.status === "Ï†ëÏàò" ||
                                            o.status === "Î∞∞ÏÜ°Ï§ë")
                                )
                                .map(([id, o]) => o);

                            if (relatedClaims.length > 0) {
                                const proceed = confirm(
                                    "ÏÉàÎ°úÏö¥ ÌÅ¥Î†àÏûÑÏù¥ Ï°¥Ïû¨Ìï©ÎãàÎã§.\n" +
                                        "Ìï¥Îãπ Ï£ºÎ¨∏Ïóê ÎåÄÌï¥ ÍµêÌôò/Î∞òÌíà/Ï∑®ÏÜå ÏöîÏ≤≠Ïù¥ Ï†ëÏàò/ÏßÑÌñâ Ï§ëÏùº Ïàò ÏûàÏñ¥Ïöî.\n" +
                                        `Í∑∏ÎûòÎèÑ '${newStatus}'Î°ú ÏÉÅÌÉúÎ•º Î≥ÄÍ≤ΩÌï†ÍπåÏöî?`
                                );
                                if (!proceed) return;
                            }
                        }

                        // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìñâ (ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞)
                        if (orderPath) {
                            const statusRef = ref(
                                database,
                                `${orderPath}/status`
                            );
                            await set(statusRef, newStatus);
                        }

                        // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÌõÑ ÌòÑÏû¨ ÌïÑÌÑ∞ ÏÉÅÌÉú Ïú†ÏßÄ
                        // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑàÍ∞Ä ÏûêÎèôÏúºÎ°ú ÌïÑÌÑ∞Î•º Ï†ÅÏö©Ìï®
                    } catch (err) {
                        console.error("ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:", err);
                        alert("ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
                    }
                };

                // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏ - Ìï≠ÏÉÅ Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î•º Í∏∞Ï§ÄÏúºÎ°ú Í≥ÑÏÇ∞
                function updateStats(data) {
                    if (!data) {
                        document.getElementById("todayNewOrders").textContent =
                            "0";
                        document.getElementById(
                            "todayExchangeRequests"
                        ).textContent = "0";
                        document.getElementById(
                            "todayReturnRequests"
                        ).textContent = "0";
                        document.getElementById(
                            "todayCancelRequests"
                        ).textContent = "0";
                        return;
                    }

                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const tomorrow = new Date(today);
                    tomorrow.setDate(tomorrow.getDate() + 1);

                    // Ìï≠ÏÉÅ Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î•º Í∏∞Ï§ÄÏúºÎ°ú ÌÜµÍ≥Ñ Í≥ÑÏÇ∞ (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                    const entries = collectAllOrders(data);

                    // Ïò§Îäò Ïã†Í∑úÏ£ºÎ¨∏Îßå ÎÇ†Ïßú ÌïÑÌÑ∞ Ï†ÅÏö©
                    const todayOrders = entries.filter(([id, order]) => {
                        const orderDate = new Date(order.createdAt);
                        return orderDate >= today && orderDate < tomorrow;
                    });

                    // Ï£ºÎ¨∏ Ïú†ÌòïÎ≥Ñ ÌÜµÍ≥Ñ
                    const newOrders = todayOrders.filter(
                        ([id, order]) => order.orderType === "Ïã†Í∑úÏ£ºÎ¨∏"
                    );

                    // Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ÏóêÏÑú ÍµêÌôò/Î∞òÌíà/Ï∑®ÏÜå ÏßÑÌñâÏ§ëÏù∏ Ï£ºÎ¨∏ Ïπ¥Ïö¥Ìä∏ (Ï†ëÏàò/Î∞∞ÏÜ°Ï§ë ÏÉÅÌÉú)
                    // Ïù¥ Î∂ÄÎ∂ÑÏùÄ Ìï≠ÏÉÅ Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î•º Í∏∞Ï§ÄÏúºÎ°ú Í≥ÑÏÇ∞ÌïòÏó¨ ÎØ∏Ï≤òÎ¶¨ Ï≤¥ÌÅ¨ Í∞úÎÖê Ïú†ÏßÄ
                    const exchangeRequests = entries.filter(
                        ([id, order]) =>
                            order.orderType === "ÍµêÌôò" &&
                            (order.status === "Ï†ëÏàò" ||
                                order.status === "Î∞∞ÏÜ°Ï§ë")
                    );
                    const returnRequests = entries.filter(
                        ([id, order]) =>
                            order.orderType === "Î∞òÌíà" &&
                            (order.status === "Ï†ëÏàò" ||
                                order.status === "Î∞∞ÏÜ°Ï§ë")
                    );
                    const cancelRequests = entries.filter(
                        ([id, order]) =>
                            order.orderType === "Ï∑®ÏÜå" &&
                            (order.status === "Ï†ëÏàò" ||
                                order.status === "Î∞∞ÏÜ°Ï§ë")
                    );

                    document.getElementById("todayNewOrders").textContent =
                        newOrders.length;
                    document.getElementById(
                        "todayExchangeRequests"
                    ).textContent = exchangeRequests.length;
                    document.getElementById("todayReturnRequests").textContent =
                        returnRequests.length;
                    document.getElementById("todayCancelRequests").textContent =
                        cancelRequests.length;
                }

                // ÏµúÍ∑º Ï£ºÎ¨∏ ÏóÖÎç∞Ïù¥Ìä∏
                // ÏµúÍ∑ºÏ£ºÎ¨∏ ÏÑπÏÖò Ï†úÍ±∞Î°ú ÎçîÎØ∏ Ìï®Ïàò Ïú†ÏßÄ
                function updateRecentOrders(data) {
                    /* no-op */
                }

                // Ï£ºÎ¨∏ ÌïÑÌÑ∞ÎßÅ
                function filterOrdersData(entries) {
                    const statusFilter =
                        document.getElementById("statusFilter").value;
                    const orderTypeFilter =
                        document.getElementById("orderTypeFilter").value;
                    const dateFilter =
                        document.getElementById("dateFilter").value;
                    const phoneSearch = document
                        .getElementById("phoneSearch")
                        .value.toLowerCase();
                    const orderNumberSearch = document
                        .getElementById("orderNumberSearch")
                        .value.toLowerCase();

                    return entries.filter(([id, order]) => {
                        // Ìú¥ÎåÄÌè∞Î≤àÌò∏ Í≤ÄÏÉâ
                        if (
                            phoneSearch &&
                            !order.phone.toLowerCase().includes(phoneSearch)
                        ) {
                            return false;
                        }

                        // Ï£ºÎ¨∏Î≤àÌò∏ Í≤ÄÏÉâ
                        if (
                            orderNumberSearch &&
                            !order.orderNumber
                                .toLowerCase()
                                .includes(orderNumberSearch)
                        ) {
                            return false;
                        }

                        // Î∞∞ÏÜ°ÏÉÅÌÉú ÌïÑÌÑ∞
                        if (statusFilter && order.status !== statusFilter) {
                            return false;
                        }

                        // Ï£ºÎ¨∏Ïú†Ìòï ÌïÑÌÑ∞
                        if (
                            orderTypeFilter &&
                            order.orderType !== orderTypeFilter
                        ) {
                            return false;
                        }

                        // ÎÇ†Ïßú ÌïÑÌÑ∞
                        if (dateFilter) {
                            const orderDate = new Date(order.createdAt);
                            const now = new Date();

                            switch (dateFilter) {
                                case "recent3days":
                                    const threeDaysAgo = new Date(now);
                                    threeDaysAgo.setDate(
                                        threeDaysAgo.getDate() - 3
                                    );
                                    return orderDate >= threeDaysAgo;

                                case "today":
                                    const today = new Date(now);
                                    today.setHours(0, 0, 0, 0);
                                    const tomorrow = new Date(today);
                                    tomorrow.setDate(tomorrow.getDate() + 1);
                                    return (
                                        orderDate >= today &&
                                        orderDate < tomorrow
                                    );

                                case "week":
                                    const weekAgo = new Date(now);
                                    weekAgo.setDate(weekAgo.getDate() - 7);
                                    return orderDate >= weekAgo;
                            }
                        }

                        return true;
                    });
                }

                // ÌïÑÌÑ∞ Ï†ÅÏö©
                window.filterOrders = function () {
                    const ordersRef = ref(database, "orders");
                    onValue(
                        ordersRef,
                        (snapshot) => {
                            const data = snapshot.val();
                            updateOrdersTable(data);
                            updateStats(data);
                            updateRecentOrders(data);
                        },
                        { onlyOnce: true }
                    );
                };

                // ÏÉàÎ°úÍ≥†Ïπ®
                window.refreshOrders = function () {
                    // Î™®Îì† ÌïÑÌÑ∞Î•º Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÑ§Ï†ï
                    document.getElementById("orderTypeFilter").value = ""; // Ï†ÑÏ≤¥ Ï£ºÎ¨∏Ïú†Ìòï
                    document.getElementById("statusFilter").value = ""; // Ï†ÑÏ≤¥ Î∞∞ÏÜ°ÏÉÅÌÉú
                    document.getElementById("dateFilter").value = "recent3days"; // ÏµúÍ∑º 3Ïùº
                    document.getElementById("phoneSearch").value = ""; // Í≤ÄÏÉâÏñ¥ Ï¥àÍ∏∞Ìôî
                    document.getElementById("orderNumberSearch").value = ""; // Í≤ÄÏÉâÏñ¥ Ï¥àÍ∏∞Ìôî

                    // Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
                    const ordersRef = ref(database, "orders");
                    onValue(
                        ordersRef,
                        (snapshot) => {
                            const data = snapshot.val();
                            updateOrdersTable(data);
                            updateStats(data);
                            updateRecentOrders(data);
                        },
                        { onlyOnce: true }
                    );

                    // ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶º
                    alert("ÏµúÍ∑º 3Ïùº ÌïÑÌÑ∞Í∞Ä Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§.");
                };

                // Ïã†Í∑úÏ£ºÎ¨∏ ÏßÑÌñâÏ§ë ÌïÑÌÑ∞ÎßÅ
                window.filterNewOrdersInProgress = function () {
                    // ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
                    document.getElementById("orderTypeFilter").value = "";
                    document.getElementById("statusFilter").value = "";
                    document.getElementById("dateFilter").value = ""; // Ï†ÑÏ≤¥ Í∏∞Í∞ÑÏúºÎ°ú ÏÑ§Ï†ï
                    document.getElementById("phoneSearch").value = "";
                    document.getElementById("orderNumberSearch").value = "";

                    // ÌïÑÌÑ∞ ÏÉÅÌÉú Ï†ÄÏû•
                    currentFilterState = {
                        type: "newOrders",
                        filters: {
                            orderType: "Ïã†Í∑úÏ£ºÎ¨∏",
                            status: ["Ï†ëÏàò", "Î∞∞ÏÜ°Ï§ë"],
                        },
                        searchTerms: {},
                    };

                    // JavaScriptÏóêÏÑú ÏßÅÏ†ë ÌïÑÌÑ∞ÎßÅ
                    filterNewOrdersInProgressCustom();

                    // ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶º
                    alert("Ïã†Í∑úÏ£ºÎ¨∏ Ï§ë Ï†ëÏàò/Î∞∞ÏÜ°Ï§ë ÏÉÅÌÉúÏù∏ Ï£ºÎ¨∏Îßå ÌëúÏãúÎê©ÎãàÎã§.");
                };

                // ÍµêÌôòÏ†ëÏàò ÏßÑÌñâÏ§ë ÌïÑÌÑ∞ÎßÅ
                window.filterExchangeInProgress = function () {
                    // ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
                    document.getElementById("dateFilter").value = ""; // Ï†ÑÏ≤¥ Í∏∞Í∞ÑÏúºÎ°ú ÏÑ§Ï†ï
                    document.getElementById("orderTypeFilter").value = "";
                    document.getElementById("statusFilter").value = "";
                    document.getElementById("phoneSearch").value = "";
                    document.getElementById("orderNumberSearch").value = "";

                    // ÌïÑÌÑ∞ ÏÉÅÌÉú Ï†ÄÏû•
                    currentFilterState = {
                        type: "exchange",
                        filters: {
                            orderType: ["ÍµêÌôò"],
                            status: ["Ï†ëÏàò", "Î∞∞ÏÜ°Ï§ë"],
                        },
                        searchTerms: {},
                    };

                    // JavaScriptÏóêÏÑú ÏßÅÏ†ë ÌïÑÌÑ∞ÎßÅ
                    filterExchangeInProgressCustom();

                    // ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶º
                    alert("ÍµêÌôòÏ†ëÏàò Ï§ë Ï†ëÏàò/Î∞∞ÏÜ°Ï§ë ÏÉÅÌÉúÏù∏ Ï£ºÎ¨∏Îßå ÌëúÏãúÎê©ÎãàÎã§.");
                };

                // Î∞òÌíàÏ†ëÏàò ÏßÑÌñâÏ§ë ÌïÑÌÑ∞ÎßÅ
                window.filterReturnInProgress = function () {
                    // ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
                    document.getElementById("dateFilter").value = ""; // Ï†ÑÏ≤¥ Í∏∞Í∞ÑÏúºÎ°ú ÏÑ§Ï†ï
                    document.getElementById("orderTypeFilter").value = "";
                    document.getElementById("statusFilter").value = "";
                    document.getElementById("phoneSearch").value = "";
                    document.getElementById("orderNumberSearch").value = "";

                    // ÌïÑÌÑ∞ ÏÉÅÌÉú Ï†ÄÏû•
                    currentFilterState = {
                        type: "return",
                        filters: {
                            orderType: ["Î∞òÌíà"],
                            status: ["Ï†ëÏàò", "Î∞∞ÏÜ°Ï§ë"],
                        },
                        searchTerms: {},
                    };

                    // JavaScriptÏóêÏÑú ÏßÅÏ†ë ÌïÑÌÑ∞ÎßÅ
                    filterReturnInProgressCustom();

                    // ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶º
                    alert("Î∞òÌíàÏ†ëÏàò Ï§ë Ï†ëÏàò/Î∞∞ÏÜ°Ï§ë ÏÉÅÌÉúÏù∏ Ï£ºÎ¨∏Îßå ÌëúÏãúÎê©ÎãàÎã§.");
                };

                // Ï∑®ÏÜåÏöîÏ≤≠ ÏßÑÌñâÏ§ë ÌïÑÌÑ∞ÎßÅ
                window.filterCancelInProgress = function () {
                    // ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
                    document.getElementById("dateFilter").value = ""; // Ï†ÑÏ≤¥ Í∏∞Í∞ÑÏúºÎ°ú ÏÑ§Ï†ï
                    document.getElementById("orderTypeFilter").value = "";
                    document.getElementById("statusFilter").value = "";
                    document.getElementById("phoneSearch").value = "";
                    document.getElementById("orderNumberSearch").value = "";

                    // ÌïÑÌÑ∞ ÏÉÅÌÉú Ï†ÄÏû•
                    currentFilterState = {
                        type: "cancel",
                        filters: {
                            orderType: ["Ï∑®ÏÜå"],
                            status: ["Ï†ëÏàò", "Î∞∞ÏÜ°Ï§ë"],
                        },
                        searchTerms: {},
                    };

                    // JavaScriptÏóêÏÑú ÏßÅÏ†ë ÌïÑÌÑ∞ÎßÅ
                    filterCancelInProgressCustom();

                    // ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶º
                    alert("Ï∑®ÏÜåÏöîÏ≤≠ Ï§ë Ï†ëÏàò/Î∞∞ÏÜ°Ï§ë ÏÉÅÌÉúÏù∏ Ï£ºÎ¨∏Îßå ÌëúÏãúÎê©ÎãàÎã§.");
                };

                // Ï†ÑÏ≤¥ Î≥¥Í∏∞ (Î™®Îì† Ï£ºÎ¨∏ ÌëúÏãú)
                window.showAllOrders = function () {
                    // Î™®Îì† ÌïÑÌÑ∞ ÏôÑÏ†Ñ Ï¥àÍ∏∞Ìôî
                    document.getElementById("orderTypeFilter").value = "";
                    document.getElementById("statusFilter").value = "";
                    document.getElementById("dateFilter").value = ""; // Ï†ÑÏ≤¥ Í∏∞Í∞ÑÏúºÎ°ú ÏÑ§Ï†ï
                    document.getElementById("phoneSearch").value = "";
                    document.getElementById("orderNumberSearch").value = "";

                    // ÌïÑÌÑ∞ ÏÉÅÌÉú ÏôÑÏ†Ñ Ï¥àÍ∏∞Ìôî
                    currentFilterState = {
                        type: "all",
                        filters: {},
                        searchTerms: {},
                    };

                    // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ï¥àÍ∏∞Ìôî
                    currentPage = 1;
                    allFilteredData = [];

                    // Ï†ÑÏ≤¥ Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞ Îã§Ïãú Î°úÎìú
                    const ordersRef = ref(database, "orders");
                    onValue(
                        ordersRef,
                        (snapshot) => {
                            const data = snapshot.val();
                            updateOrdersTable(data);
                            updateStats(data);
                            updateRecentOrders(data);

                            // ÌïÑÌÑ∞ ÏÉÅÌÉú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                            updateFilterStatusDisplay();
                        },
                        { onlyOnce: true }
                    );

                    // ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶º
                    alert(
                        "Ï†ÑÏ≤¥ Ï£ºÎ¨∏Ïù¥ ÌëúÏãúÎê©ÎãàÎã§. (Î™®Îì† Í∏∞Í∞Ñ, Î™®Îì† ÌïÑÌÑ∞ Ìï¥Ï†ú)"
                    );
                };

                // Ï†ÑÏ≤¥ ÏÑ†ÌÉù/Ìï¥Ï†ú
                window.toggleSelectAll = function () {
                    const selectAll = document.getElementById("selectAll");
                    const checkboxes =
                        document.querySelectorAll(".order-checkbox");

                    checkboxes.forEach((checkbox) => {
                        checkbox.checked = selectAll.checked;
                    });

                    updateBulkActions();
                };

                // Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÑ†ÌÉù ÏÉÅÌÉú Î≥ÄÍ≤Ω Ïãú ÏùºÍ¥Ñ Ï≤òÎ¶¨ ÎèÑÍµ¨ ÌëúÏãú/Ïà®ÍπÄ
                document.addEventListener("change", function (e) {
                    if (e.target.classList.contains("order-checkbox")) {
                        updateBulkActions();
                    }
                });

                // ÏùºÍ¥Ñ Ï≤òÎ¶¨ ÎèÑÍµ¨ ÏóÖÎç∞Ïù¥Ìä∏
                function updateBulkActions() {
                    const checkboxes = document.querySelectorAll(
                        ".order-checkbox:checked"
                    );
                    const bulkActions = document.querySelector(".bulk-actions");
                    const selectedCount =
                        document.getElementById("selectedCount");

                    if (checkboxes.length > 0) {
                        bulkActions.style.display = "block";
                        selectedCount.textContent = `${checkboxes.length}Í∞ú ÏÑ†ÌÉùÎê®`;
                    } else {
                        bulkActions.style.display = "none";
                        selectAll.checked = false;
                    }
                }

                // Ïã†Í∑úÏ£ºÎ¨∏ ÏßÑÌñâÏ§ë Ïª§Ïä§ÌÖÄ ÌïÑÌÑ∞ÎßÅ
                function filterNewOrdersInProgressCustom() {
                    const ordersRef = ref(database, "orders");
                    onValue(
                        ordersRef,
                        (snapshot) => {
                            const data = snapshot.val();
                            if (!data) {
                                updateOrdersTable({});
                                return;
                            }

                            // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                            const allEntries = collectAllOrders(data);
                            const entries = allEntries;
                            console.log(
                                "Ï†ÑÏ≤¥ Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞:",
                                entries.length,
                                "Í±¥"
                            );

                            const filteredEntries = entries.filter(
                                ([id, order]) => {
                                    // Ï£ºÎ¨∏Ïú†Ìòï ÌïÑÌÑ∞ (Ïã†Í∑úÏ£ºÎ¨∏Îßå)
                                    if (order.orderType !== "Ïã†Í∑úÏ£ºÎ¨∏") {
                                        return false;
                                    }

                                    // ÏÉÅÌÉú ÌïÑÌÑ∞ (Ï†ëÏàò ÎòêÎäî Î∞∞ÏÜ°Ï§ëÎßå)
                                    if (
                                        order.status !== "Ï†ëÏàò" &&
                                        order.status !== "Î∞∞ÏÜ°Ï§ë"
                                    ) {
                                        return false;
                                    }

                                    console.log(
                                        "Ïã†Í∑úÏ£ºÎ¨∏ ÏßÑÌñâÏ§ë ÌÜµÍ≥º:",
                                        order.orderType,
                                        order.status,
                                        order.orderNumber
                                    );
                                    return true;
                                }
                            );

                            console.log(
                                "Ïã†Í∑úÏ£ºÎ¨∏ ÏßÑÌñâÏ§ë ÌïÑÌÑ∞ÎßÅ Í≤∞Í≥º:",
                                filteredEntries.length,
                                "Í±¥"
                            );

                            // ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞Î°ú ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏ (ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ï†ÅÏö©)
                            const filteredData = {};
                            filteredEntries.forEach(([id, order]) => {
                                filteredData[id] = order;
                            });

                            // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïú†ÏßÄ Î∞è ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
                            allFilteredData = Object.entries(filteredData);
                            updatePagination();
                            // ÌÜµÍ≥ÑÎäî Ìï≠ÏÉÅ Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏ (ÎØ∏Ï≤òÎ¶¨ Ï≤¥ÌÅ¨ Í∞úÎÖê Ïú†ÏßÄ)
                            updateStats(data);
                            updateRecentOrders(filteredData);

                            // ÌïÑÌÑ∞ ÏÉÅÌÉú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                            updateFilterStatusDisplay();
                        },
                        { onlyOnce: true }
                    );
                }

                // ÍµêÌôòÏ†ëÏàò ÏßÑÌñâÏ§ë Ïª§Ïä§ÌÖÄ ÌïÑÌÑ∞ÎßÅ
                function filterExchangeInProgressCustom() {
                    const ordersRef = ref(database, "orders");
                    onValue(
                        ordersRef,
                        (snapshot) => {
                            const data = snapshot.val();
                            if (!data) {
                                updateOrdersTable({});
                                return;
                            }

                            // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                            const allEntries = collectAllOrders(data);
                            const entries = allEntries;
                            console.log(
                                "Ï†ÑÏ≤¥ Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞:",
                                entries.length,
                                "Í±¥"
                            );

                            const filteredEntries = entries.filter(
                                ([id, order]) => {
                                    // Ï£ºÎ¨∏Ïú†Ìòï ÌïÑÌÑ∞ (ÍµêÌôòÎßå)
                                    if (order.orderType !== "ÍµêÌôò") {
                                        return false;
                                    }

                                    // ÏÉÅÌÉú ÌïÑÌÑ∞ (Ï†ëÏàò ÎòêÎäî Î∞∞ÏÜ°Ï§ëÎßå)
                                    if (
                                        order.status !== "Ï†ëÏàò" &&
                                        order.status !== "Î∞∞ÏÜ°Ï§ë"
                                    ) {
                                        return false;
                                    }

                                    console.log(
                                        "ÍµêÌôòÏ†ëÏàò ÏßÑÌñâÏ§ë ÌÜµÍ≥º:",
                                        order.orderType,
                                        order.status
                                    );
                                    return true;
                                }
                            );

                            console.log(
                                "ÍµêÌôòÏ†ëÏàò ÏßÑÌñâÏ§ë ÌïÑÌÑ∞ÎßÅ Í≤∞Í≥º:",
                                filteredEntries.length,
                                "Í±¥"
                            );

                            // ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞Î°ú ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
                            const filteredData = {};
                            filteredEntries.forEach(([id, order]) => {
                                filteredData[id] = order;
                            });

                            updateOrdersTable(filteredData);
                            // ÌÜµÍ≥ÑÎäî Ìï≠ÏÉÅ Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏ (ÎØ∏Ï≤òÎ¶¨ Ï≤¥ÌÅ¨ Í∞úÎÖê Ïú†ÏßÄ)
                            updateStats(data);
                            updateRecentOrders(filteredData);

                            // ÌïÑÌÑ∞ ÏÉÅÌÉú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                            updateFilterStatusDisplay();
                        },
                        { onlyOnce: true }
                    );
                }

                // Î∞òÌíàÏ†ëÏàò ÏßÑÌñâÏ§ë Ïª§Ïä§ÌÖÄ ÌïÑÌÑ∞ÎßÅ
                function filterReturnInProgressCustom() {
                    const ordersRef = ref(database, "orders");
                    onValue(
                        ordersRef,
                        (snapshot) => {
                            const data = snapshot.val();
                            if (!data) {
                                updateOrdersTable({});
                                return;
                            }

                            // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                            const allEntries = collectAllOrders(data);
                            const entries = allEntries;
                            console.log(
                                "Ï†ÑÏ≤¥ Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞:",
                                entries.length,
                                "Í±¥"
                            );

                            const filteredEntries = entries.filter(
                                ([id, order]) => {
                                    // Ï£ºÎ¨∏Ïú†Ìòï ÌïÑÌÑ∞ (Î∞òÌíàÎßå)
                                    if (order.orderType !== "Î∞òÌíà") {
                                        return false;
                                    }

                                    // ÏÉÅÌÉú ÌïÑÌÑ∞ (Ï†ëÏàò ÎòêÎäî Î∞∞ÏÜ°Ï§ëÎßå)
                                    if (
                                        order.status !== "Ï†ëÏàò" &&
                                        order.status !== "Î∞∞ÏÜ°Ï§ë"
                                    ) {
                                        return false;
                                    }

                                    console.log(
                                        "Î∞òÌíàÏ†ëÏàò ÏßÑÌñâÏ§ë ÌÜµÍ≥º:",
                                        order.orderType,
                                        order.status
                                    );
                                    return true;
                                }
                            );

                            console.log(
                                "Î∞òÌíàÏ†ëÏàò ÏßÑÌñâÏ§ë ÌïÑÌÑ∞ÎßÅ Í≤∞Í≥º:",
                                filteredEntries.length,
                                "Í±¥"
                            );

                            // ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞Î°ú ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
                            const filteredData = {};
                            filteredEntries.forEach(([id, order]) => {
                                filteredData[id] = order;
                            });

                            updateOrdersTable(filteredData);
                            // ÌÜµÍ≥ÑÎäî Ìï≠ÏÉÅ Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏ (ÎØ∏Ï≤òÎ¶¨ Ï≤¥ÌÅ¨ Í∞úÎÖê Ïú†ÏßÄ)
                            updateStats(data);
                            updateRecentOrders(filteredData);

                            // ÌïÑÌÑ∞ ÏÉÅÌÉú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                            updateFilterStatusDisplay();
                        },
                        { onlyOnce: true }
                    );
                }

                // Ï∑®ÏÜåÏöîÏ≤≠ ÏßÑÌñâÏ§ë Ïª§Ïä§ÌÖÄ ÌïÑÌÑ∞ÎßÅ
                function filterCancelInProgressCustom() {
                    const ordersRef = ref(database, "orders");
                    onValue(
                        ordersRef,
                        (snapshot) => {
                            const data = snapshot.val();
                            if (!data) {
                                updateOrdersTable({});
                                return;
                            }

                            // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                            const allEntries = collectAllOrders(data);
                            const entries = allEntries;
                            console.log(
                                "Ï†ÑÏ≤¥ Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞:",
                                entries.length,
                                "Í±¥"
                            );

                            const filteredEntries = entries.filter(
                                ([id, order]) => {
                                    // Ï£ºÎ¨∏Ïú†Ìòï ÌïÑÌÑ∞ (Ï∑®ÏÜåÎßå)
                                    if (order.orderType !== "Ï∑®ÏÜå") {
                                        return false;
                                    }

                                    // ÏÉÅÌÉú ÌïÑÌÑ∞ (Ï†ëÏàò ÎòêÎäî Î∞∞ÏÜ°Ï§ëÎßå)
                                    if (
                                        order.status !== "Ï†ëÏàò" &&
                                        order.status !== "Î∞∞ÏÜ°Ï§ë"
                                    ) {
                                        return false;
                                    }

                                    console.log(
                                        "Ï∑®ÏÜåÏöîÏ≤≠ ÏßÑÌñâÏ§ë ÌÜµÍ≥º:",
                                        order.orderType,
                                        order.status
                                    );
                                    return true;
                                }
                            );

                            console.log(
                                "Ï∑®ÏÜåÏöîÏ≤≠ ÏßÑÌñâÏ§ë ÌïÑÌÑ∞ÎßÅ Í≤∞Í≥º:",
                                filteredEntries.length,
                                "Í±¥"
                            );

                            // ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞Î°ú ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
                            const filteredData = {};
                            filteredEntries.forEach(([id, order]) => {
                                filteredData[id] = order;
                            });

                            updateOrdersTable(filteredData);
                            // ÌÜµÍ≥ÑÎäî Ìï≠ÏÉÅ Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏ (ÎØ∏Ï≤òÎ¶¨ Ï≤¥ÌÅ¨ Í∞úÎÖê Ïú†ÏßÄ)
                            updateStats(data);
                            updateRecentOrders(filteredData);

                            // ÌïÑÌÑ∞ ÏÉÅÌÉú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                            updateFilterStatusDisplay();
                        },
                        { onlyOnce: true }
                    );
                }

                // ÍµêÌôò/Î∞òÌíà/Ï∑®ÏÜå ÏßÑÌñâÏ§ë Ïª§Ïä§ÌÖÄ ÌïÑÌÑ∞ÎßÅ (Í∏∞Ï°¥ Ìï®Ïàò Ïú†ÏßÄ)
                function filterExchangeReturnInProgressCustom() {
                    const ordersRef = ref(database, "orders");
                    onValue(
                        ordersRef,
                        (snapshot) => {
                            const data = snapshot.val();
                            if (!data) {
                                updateOrdersTable({});
                                return;
                            }

                            // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                            const allEntries = collectAllOrders(data);
                            const entries = allEntries;
                            console.log(
                                "Ï†ÑÏ≤¥ Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞:",
                                entries.length,
                                "Í±¥"
                            );

                            const filteredEntries = entries.filter(
                                ([id, order]) => {
                                    // Ï£ºÎ¨∏Ïú†Ìòï ÌïÑÌÑ∞ (ÍµêÌôò, Î∞òÌíà, Ï∑®ÏÜåÎßå)
                                    if (
                                        order.orderType !== "ÍµêÌôò" &&
                                        order.orderType !== "Î∞òÌíà" &&
                                        order.orderType !== "Ï∑®ÏÜå"
                                    ) {
                                        return false;
                                    }

                                    // ÏÉÅÌÉú ÌïÑÌÑ∞ (Ï†ëÏàò ÎòêÎäî Î∞∞ÏÜ°Ï§ëÎßå)
                                    if (
                                        order.status !== "Ï†ëÏàò" &&
                                        order.status !== "Î∞∞ÏÜ°Ï§ë"
                                    ) {
                                        return false;
                                    }

                                    console.log(
                                        "ÍµêÌôò/Î∞òÌíà/Ï∑®ÏÜå ÏßÑÌñâÏ§ë ÌÜµÍ≥º:",
                                        order.orderType,
                                        order.status,
                                        order.orderNumber
                                    );
                                    return true;
                                }
                            );

                            console.log(
                                "ÍµêÌôò/Î∞òÌíà/Ï∑®ÏÜå ÏßÑÌñâÏ§ë ÌïÑÌÑ∞ÎßÅ Í≤∞Í≥º:",
                                filteredEntries.length,
                                "Í±¥"
                            );

                            // ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞Î°ú ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏ (ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ï†ÅÏö©)
                            const filteredData = {};
                            filteredEntries.forEach(([id, order]) => {
                                filteredData[id] = order;
                            });

                            // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïú†ÏßÄ Î∞è ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
                            allFilteredData = Object.entries(filteredData);
                            updatePagination();
                            // ÌÜµÍ≥ÑÎäî Ìï≠ÏÉÅ Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏ (ÎØ∏Ï≤òÎ¶¨ Ï≤¥ÌÅ¨ Í∞úÎÖê Ïú†ÏßÄ)
                            updateStats(data);
                            updateRecentOrders(filteredData);

                            // ÌïÑÌÑ∞ ÏÉÅÌÉú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                            updateFilterStatusDisplay();
                        },
                        { onlyOnce: true }
                    );
                }

                // Ïª§Ïä§ÌÖÄ ÏÉÅÌÉú ÌïÑÌÑ∞ÎßÅ (Ïó¨Îü¨ ÏÉÅÌÉú ÎèôÏãú ÏßÄÏõê)
                function filterOrdersWithCustomStatus(allowedStatuses) {
                    const ordersRef = ref(database, "orders");
                    onValue(
                        ordersRef,
                        (snapshot) => {
                            const data = snapshot.val();
                            if (!data) {
                                updateOrdersTable({});
                                return;
                            }

                            // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                            const allEntries = collectAllOrders(data);
                            const entries = allEntries;
                            const filteredEntries = entries.filter(
                                ([id, order]) => {
                                    // Ï£ºÎ¨∏Ïú†Ìòï ÌïÑÌÑ∞ (Ïã†Í∑úÏ£ºÎ¨∏)
                                    if (order.orderType !== "Ïã†Í∑úÏ£ºÎ¨∏") {
                                        return false;
                                    }

                                    // ÏÉÅÌÉú ÌïÑÌÑ∞ (Ï†ëÏàò ÎòêÎäî Î∞∞ÏÜ°Ï§ë)
                                    if (
                                        !allowedStatuses.includes(order.status)
                                    ) {
                                        return false;
                                    }

                                    return true;
                                }
                            );

                            // ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞Î°ú ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
                            const filteredData = {};
                            filteredEntries.forEach(([id, order]) => {
                                filteredData[id] = order;
                            });

                            updateOrdersTable(filteredData);
                            // ÌÜµÍ≥ÑÎäî Ìï≠ÏÉÅ Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏ (ÎØ∏Ï≤òÎ¶¨ Ï≤¥ÌÅ¨ Í∞úÎÖê Ïú†ÏßÄ)
                            updateStats(data);
                            updateRecentOrders(filteredData);
                        },
                        { onlyOnce: true }
                    );
                }

                // Ïª§Ïä§ÌÖÄ Ï£ºÎ¨∏Ïú†ÌòïÍ≥º ÏÉÅÌÉú ÌïÑÌÑ∞ÎßÅ
                function filterOrdersWithCustomTypeAndStatus(
                    allowedTypes,
                    allowedStatuses
                ) {
                    const ordersRef = ref(database, "orders");
                    onValue(
                        ordersRef,
                        (snapshot) => {
                            const data = snapshot.val();
                            if (!data) {
                                updateOrdersTable({});
                                return;
                            }

                            // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                            const allEntries = collectAllOrders(data);
                            const entries = allEntries;
                            console.log(
                                "Ï†ÑÏ≤¥ Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞:",
                                entries.length,
                                "Í±¥"
                            );
                            console.log("ÌóàÏö©Îêú Ï£ºÎ¨∏Ïú†Ìòï:", allowedTypes);
                            console.log("ÌóàÏö©Îêú ÏÉÅÌÉú:", allowedStatuses);

                            const filteredEntries = entries.filter(
                                ([id, order]) => {
                                    // Ï£ºÎ¨∏Ïú†Ìòï ÌïÑÌÑ∞ (ÍµêÌôò, Î∞òÌíà, Ï∑®ÏÜå)
                                    if (
                                        !allowedTypes.includes(order.orderType)
                                    ) {
                                        console.log(
                                            "Ï£ºÎ¨∏Ïú†Ìòï ÌïÑÌÑ∞ÎßÅ Ï†úÏô∏:",
                                            order.orderType,
                                            order.orderNumber
                                        );
                                        return false;
                                    }

                                    // ÏÉÅÌÉú ÌïÑÌÑ∞ (Ï†ëÏàò ÎòêÎäî Î∞∞ÏÜ°Ï§ë)
                                    if (
                                        !allowedStatuses.includes(order.status)
                                    ) {
                                        console.log(
                                            "ÏÉÅÌÉú ÌïÑÌÑ∞ÎßÅ Ï†úÏô∏:",
                                            order.status,
                                            order.orderNumber
                                        );
                                        return false;
                                    }

                                    console.log(
                                        "ÌïÑÌÑ∞ÎßÅ ÌÜµÍ≥º:",
                                        order.orderType,
                                        order.status,
                                        order.orderNumber
                                    );
                                    return true;
                                }
                            );

                            console.log(
                                "ÌïÑÌÑ∞ÎßÅ Í≤∞Í≥º:",
                                filteredEntries.length,
                                "Í±¥"
                            );

                            // ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞Î°ú ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
                            const filteredData = {};
                            filteredEntries.forEach(([id, order]) => {
                                filteredData[id] = order;
                            });

                            updateOrdersTable(filteredData);
                            // ÌÜµÍ≥ÑÎäî Ìï≠ÏÉÅ Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏ (ÎØ∏Ï≤òÎ¶¨ Ï≤¥ÌÅ¨ Í∞úÎÖê Ïú†ÏßÄ)
                            updateStats(data);
                            updateRecentOrders(filteredData);
                        },
                        { onlyOnce: true }
                    );
                }

                // ÏùºÍ¥Ñ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                window.bulkUpdateStatus = async function (newStatus) {
                    const checkboxes = document.querySelectorAll(
                        ".order-checkbox:checked"
                    );

                    if (checkboxes.length === 0) {
                        alert("ÏÑ†ÌÉùÎêú Ï£ºÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§.");
                        return;
                    }

                    const confirmMessage = `ÏÑ†ÌÉùÎêú ${checkboxes.length}Í∞ú Ï£ºÎ¨∏Ïùò ÏÉÅÌÉúÎ•º '${newStatus}'Î°ú Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
                    if (!confirm(confirmMessage)) {
                        return;
                    }

                    // Î™®Îì† Ï£ºÎ¨∏ÏùÑ Ìïú Î≤àÎßå Î°úÎìú (ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞)
                    const allSnap = await get(ref(database, `orders`));
                    const all = allSnap.val() || {};

                    // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                    const allOrders = collectAllOrders(all);

                    // ÏÑ†ÌÉùÎêú Ï£ºÎ¨∏Îì§Ïùò ÏÉÅÏÑ∏ ÏàòÏßë
                    const selectedOrders = [];
                    for (const checkbox of checkboxes) {
                        const orderId = checkbox.value;
                        const orderEntry = allOrders.find(
                            ([id, order]) => id === orderId
                        );
                        if (orderEntry) {
                            const [id, order] = orderEntry;
                            selectedOrders.push({ orderId: id, order });
                        }
                    }

                    // ÌÅ¥Î†àÏûÑ Í∞êÏßÄ (Î∞∞ÏÜ°Ï§ë/Î∞∞ÏÜ°ÏôÑÎ£å Ï≤òÎ¶¨ ÏãúÎßå ÏùòÎØ∏ ÏûàÏùå)
                    let claimAffected = [];
                    if (newStatus === "Î∞∞ÏÜ°Ï§ë" || newStatus === "Î∞∞ÏÜ°ÏôÑÎ£å") {
                        claimAffected = selectedOrders.filter(({ order }) => {
                            return allOrders.some(
                                ([id, o]) =>
                                    o &&
                                    o.existingOrderNumber ===
                                        order.orderNumber &&
                                    (o.orderType === "ÍµêÌôò" ||
                                        o.orderType === "Î∞òÌíà" ||
                                        o.orderType === "Ï∑®ÏÜå") &&
                                    (o.status === "Ï†ëÏàò" ||
                                        o.status === "Î∞∞ÏÜ°Ï§ë")
                            );
                        });
                    }

                    if (claimAffected.length > 0) {
                        const sample = claimAffected
                            .slice(0, 5)
                            .map((v) => v.order.orderNumber)
                            .join(", ");
                        const proceed = confirm(
                            "ÏÉàÎ°úÏö¥ ÌÅ¥Î†àÏûÑÏù¥ Ï°¥Ïû¨Ìï©ÎãàÎã§.\n" +
                                "ÏÑ†ÌÉùÎêú Ï£ºÎ¨∏ Ï§ë ÏùºÎ∂ÄÎäî ÍµêÌôò/Î∞òÌíà/Ï∑®ÏÜå ÏöîÏ≤≠Ïù¥ Ï†ëÏàò/ÏßÑÌñâ Ï§ëÏù¥ÏóêÏöî.\n" +
                                `Ìï¥Îãπ Ï£ºÎ¨∏ÏùÄ Ïä§ÌÇµÌïòÍ≥† ÎÇòÎ®∏ÏßÄÎßå '${newStatus}'Î°ú Î≥ÄÍ≤ΩÌï†ÍπåÏöî?` +
                                (sample
                                    ? `\nÏòà: ${sample}${
                                          claimAffected.length > 5 ? " Ïô∏" : ""
                                      }`
                                    : "")
                        );
                        if (!proceed) return;
                    }

                    let successCount = 0;
                    let skippedCount = 0;
                    let errorCount = 0;

                    for (const { orderId, order } of selectedOrders) {
                        // ÌÅ¥Î†àÏûÑ ÏòÅÌñ• Ï£ºÎ¨∏ÏùÄ Ïä§ÌÇµ
                        const isClaimed = claimAffected.some(
                            (v) => v.orderId === orderId
                        );
                        if (isClaimed) {
                            skippedCount++;
                            continue;
                        }
                        try {
                            const orderPath = await findOrderPath(orderId);
                            if (orderPath) {
                                const statusRef = ref(
                                    database,
                                    `${orderPath}/status`
                                );
                                await set(statusRef, newStatus);
                                successCount++;
                            }
                        } catch (error) {
                            console.error("ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:", error);
                            errorCount++;
                        }
                    }

                    // Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÑ†ÌÉù Ìï¥Ï†ú
                    checkboxes.forEach(
                        (checkbox) => (checkbox.checked = false)
                    );
                    const selectAll = document.getElementById("selectAll");
                    if (selectAll) selectAll.checked = false;
                    updateBulkActions();

                    // Í≤∞Í≥º ÏïåÎ¶º
                    let message = `${successCount}Í∞ú ÏÉÅÌÉú Î≥ÄÍ≤Ω ÏôÑÎ£å`;
                    if (skippedCount > 0)
                        message += `\n${skippedCount}Í∞úÎäî ÌÅ¥Î†àÏûÑ ÏßÑÌñâ Ï§ëÏúºÎ°ú Ïä§ÌÇµÎê®`;
                    if (errorCount > 0) message += `\n${errorCount}Í∞ú Ïã§Ìå®`;
                    alert(message);

                    // ÏùºÍ¥Ñ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÌõÑ ÌòÑÏû¨ ÌïÑÌÑ∞ ÏÉÅÌÉú Ïú†ÏßÄ
                    // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑàÍ∞Ä ÏûêÎèôÏúºÎ°ú ÌïÑÌÑ∞Î•º Ï†ÅÏö©Ìï®
                };

                // ÏòÅÏóÖÏùº Í≥ÑÏÇ∞ Ìï®Ïàò (Ï£ºÎßêÍ≥º Í≥µÌú¥Ïùº Ï†úÏô∏)
                function isBusinessDay(date) {
                    const day = date.getDay();
                    // Ï£ºÎßê Ï†úÏô∏ (0: ÏùºÏöîÏùº, 6: ÌÜ†ÏöîÏùº)
                    if (day === 0 || day === 6) return false;

                    // ÌïúÍµ≠ Í≥µÌú¥Ïùº Ï≤¥ÌÅ¨ (Ï£ºÏöî Í≥µÌú¥ÏùºÎßå)
                    const month = date.getMonth() + 1;
                    const dayOfMonth = date.getDate();

                    // Ïã†Ï†ï, ÏÑ§ÎÇ†, ÏÇºÏùºÏ†à, Ïñ¥Î¶∞Ïù¥ÎÇ†, Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†, ÌòÑÏ∂©Ïùº, Í¥ëÎ≥µÏ†à, Í∞úÏ≤úÏ†à, ÌïúÍ∏ÄÎÇ†, ÏÑ±ÌÉÑÏ†à
                    const holidays = [
                        { month: 1, day: 1 }, // Ïã†Ï†ï
                        { month: 3, day: 1 }, // ÏÇºÏùºÏ†à
                        { month: 5, day: 5 }, // Ïñ¥Î¶∞Ïù¥ÎÇ†
                        { month: 6, day: 6 }, // ÌòÑÏ∂©Ïùº
                        { month: 8, day: 15 }, // Í¥ëÎ≥µÏ†à
                        { month: 10, day: 3 }, // Í∞úÏ≤úÏ†à
                        { month: 10, day: 9 }, // ÌïúÍ∏ÄÎÇ†
                        { month: 12, day: 25 }, // ÏÑ±ÌÉÑÏ†à
                    ];

                    // ÏÑ§ÎÇ†Í≥º Ï∂îÏÑùÏùÄ ÏùåÎ†•Ïù¥Îùº Î≥µÏû°ÌïòÎØÄÎ°ú Í∞ÑÎã®Ìûà Ï≤òÎ¶¨ (Ï∂îÌõÑ Í∞úÏÑ† Í∞ÄÎä•)
                    // Ïó¨Í∏∞ÏÑúÎäî Ï£ºÏöî ÏñëÎ†• Í≥µÌú¥ÏùºÎßå Ï≤¥ÌÅ¨

                    return !holidays.some(
                        (holiday) =>
                            holiday.month === month &&
                            holiday.day === dayOfMonth
                    );
                }

                // ÏòÅÏóÖÏùº Í∏∞Ï§ÄÏúºÎ°ú ÎÇ†Ïßú Í≥ÑÏÇ∞
                function addBusinessDays(startDate, businessDays) {
                    let currentDate = new Date(startDate);
                    let addedDays = 0;

                    while (addedDays < businessDays) {
                        currentDate.setDate(currentDate.getDate() + 1);
                        if (isBusinessDay(currentDate)) {
                            addedDays++;
                        }
                    }

                    return currentDate;
                }

                // 3ÏòÅÏóÖÏùºÏù¥ ÏßÄÎÇú Î∞∞ÏÜ°Ï§ë Ï£ºÎ¨∏ ÏûêÎèô ÏôÑÎ£å Ï≤òÎ¶¨
                async function autoCompleteShippedOrders(data) {
                    if (!data) return;

                    const now = new Date();
                    let completedCount = 0;

                    // Î™®Îì† Íµ¨Ï°∞ÏóêÏÑú Ï£ºÎ¨∏ ÏàòÏßë (Í≥µÌÜµ Ìï®Ïàò ÏÇ¨Ïö©)
                    const allEntries = collectAllOrders(data);

                    for (const [id, order] of allEntries) {
                        // Î∞∞ÏÜ°Ï§ë ÏÉÅÌÉúÏù¥Í≥† Î∞∞ÏÜ° ÏãúÏûë ÏãúÍ∞ÑÏù¥ ÏûàÎäî Ï£ºÎ¨∏
                        if (
                            order.status === "Î∞∞ÏÜ°Ï§ë" &&
                            order.shippingStartTime
                        ) {
                            const shippingStartDate = new Date(
                                order.shippingStartTime
                            );
                            const expectedCompletionDate = addBusinessDays(
                                shippingStartDate,
                                3
                            );

                            // 3ÏòÅÏóÖÏùºÏù¥ ÏßÄÎÇ¨ÎäîÏßÄ ÌôïÏù∏
                            if (now >= expectedCompletionDate) {
                                try {
                                    // Î∞∞ÏÜ°ÏôÑÎ£åÎ°ú ÏÉÅÌÉú Î≥ÄÍ≤Ω (ÏõîÎ≥Ñ Ìè¥Îçî Íµ¨Ï°∞)
                                    const orderPath = await findOrderPath(id);
                                    if (orderPath) {
                                        await set(
                                            ref(
                                                database,
                                                `${orderPath}/status`
                                            ),
                                            "Î∞∞ÏÜ°ÏôÑÎ£å"
                                        );
                                        // ÏûêÎèô ÏôÑÎ£å ÏãúÍ∞Ñ Í∏∞Î°ù
                                        await set(
                                            ref(
                                                database,
                                                `${orderPath}/autoCompletedTime`
                                            ),
                                            Date.now()
                                        );
                                        completedCount++;
                                    }

                                    console.log(
                                        `Ï£ºÎ¨∏ ${order.orderNumber}Ïù¥(Í∞Ä) 3ÏòÅÏóÖÏùº ÌõÑ ÏûêÎèôÏúºÎ°ú Î∞∞ÏÜ°ÏôÑÎ£å Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.`
                                    );
                                } catch (error) {
                                    console.error(
                                        `ÏûêÎèô Î∞∞ÏÜ°ÏôÑÎ£å Ï≤òÎ¶¨ Ïò§Î•ò (${id}):`,
                                        error
                                    );
                                }
                            }
                        }
                    }

                    if (completedCount > 0) {
                        console.log(
                            `${completedCount}Í∞úÏùò Î∞∞ÏÜ°Ï§ë Ï£ºÎ¨∏Ïù¥ 3ÏòÅÏóÖÏùº ÌõÑ ÏûêÎèôÏúºÎ°ú Î∞∞ÏÜ°ÏôÑÎ£å Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.`
                        );
                    }
                }

                // Î™®Îì† Ï†ïÎ≥¥ Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞ (ÌÉùÎ∞∞ÏÇ¨/ÏÜ°Ïû•Î≤àÌò∏/ÏûëÏóÖÍπåÏßÄ Î™®Îëê)
                window.exportToExcelFull = function () {
                    // Î°úÎî© ÌëúÏãú
                    const exportBtn = document.querySelector(
                        'button[onclick="exportToExcelFull()"]'
                    );
                    const originalText = exportBtn.innerHTML;
                    exportBtn.disabled = true;
                    exportBtn.innerHTML =
                        '<svg class="inline-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg> Ï≤òÎ¶¨Ï§ë...';

                    try {
                        // ÌïÑÌÑ∞ÎßÅÎêú Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© (ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Î¨¥Í¥Ä)
                        if (!allFilteredData || allFilteredData.length === 0) {
                            alert("ÎÇ¥Î≥¥ÎÇº Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.");
                            return;
                        }

                        // ÌïÑÌÑ∞ÎßÅÎêú Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë (Ï†ÑÏ≤¥ Ï†ïÎ≥¥)
                        const filteredData = [];
                        let processedCount = 0;
                        const totalCount = allFilteredData.length;

                        allFilteredData.forEach(([id, order]) => {
                            processedCount++;

                            // 1000Í±¥ÎßàÎã§ ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
                            if (processedCount % 1000 === 0) {
                                const progress = Math.round(
                                    (processedCount / totalCount) * 100
                                );
                                exportBtn.innerHTML = `<svg class="inline-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg> ${progress}%`;
                            }

                            // Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞Î•º Excel ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò (Ï†ÑÏ≤¥ Ï†ïÎ≥¥)
                            filteredData.push({
                                Ï£ºÎ¨∏Î≤àÌò∏: order.orderNumber || "",
                                Ï£ºÎ¨∏ÏãúÍ∞Ñ: order.createdAt
                                    ? new Date(order.createdAt).toLocaleString(
                                          "ko-KR"
                                      )
                                    : "",
                                ÏûÖÍ∏àÏûêÎ™Ö: order.customerName || "",
                                Ïó∞ÎùΩÏ≤ò: order.phone || "",
                                Ï£ºÎ¨∏Ïú†Ìòï: order.orderType || "Ïã†Í∑úÏ£ºÎ¨∏",
                                Í∏∞Ï°¥Ï£ºÎ¨∏Î≤àÌò∏: order.existingOrderNumber || "-",
                                Íµ¨Îß§Ï†úÌíà: `${order.product || ""} (${
                                    order.quantity || 0
                                }Í∞ú)`,
                                Ï£ºÏÜå: order.address || "",
                                ÏÉÅÏÑ∏Ï£ºÏÜå: order.detailAddress || "",
                                Î∞∞ÏÜ°Î©îÏÑ∏ÏßÄ: `${order.memo || ""}${
                                    order.refundAccount
                                        ? `\n\nÌôòÎ∂à Í≥ÑÏ¢åÏ†ïÎ≥¥:\n${order.refundAccount}`
                                        : ""
                                }`,
                                Î∞∞ÏÜ°ÏÉÅÌÉú: order.status || "",
                                ÌÉùÎ∞∞ÏÇ¨: order.courier || "-",
                                ÏÜ°Ïû•Î≤àÌò∏: order.invoiceNumber || "-",
                            });
                        });

                        // Îç∞Ïù¥ÌÑ∞ Í∞úÏàò ÌôïÏù∏
                        if (filteredData.length > 10000) {
                            const confirm = window.confirm(
                                `Ï¥ù ${filteredData.length.toLocaleString()}Í±¥Ïùò Îç∞Ïù¥ÌÑ∞Î•º ÎÇ¥Î≥¥ÎÉÖÎãàÎã§.\n` +
                                    `Ï≤òÎ¶¨ ÏãúÍ∞ÑÏù¥ Ïò§Îûò Í±∏Î¶¥ Ïàò ÏûàÏäµÎãàÎã§.\nÍ≥ÑÏÜçÌïòÏãúÍ≤†ÏäµÎãàÍπå?`
                            );
                            if (!confirm) {
                                return;
                            }
                        }

                        // Excel ÌååÏùº ÏÉùÏÑ±
                        const ws = XLSX.utils.json_to_sheet(filteredData);
                        const wb = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(wb, ws, "Ï£ºÎ¨∏Î™©Î°ù_Ï†ÑÏ≤¥");

                        const fileName = `Ï£ºÎ¨∏Î™©Î°ù_Ï†ÑÏ≤¥_${
                            new Date().toISOString().split("T")[0]
                        }_${filteredData.length}Í±¥.xlsx`;
                        XLSX.writeFile(wb, fileName);

                        // ÏôÑÎ£å Î©îÏãúÏßÄ
                        alert(
                            `Ï†ÑÏ≤¥ Excel ÌååÏùºÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.\nÏ¥ù ${filteredData.length.toLocaleString()}Í±¥Ïùò Îç∞Ïù¥ÌÑ∞Í∞Ä Ìè¨Ìï®ÎêòÏóàÏäµÎãàÎã§.`
                        );
                    } catch (error) {
                        console.error("Ï†ÑÏ≤¥ Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ïò§Î•ò:", error);
                        alert("Ï†ÑÏ≤¥ Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
                    } finally {
                        // Î≤ÑÌäº Î≥µÏõê
                        exportBtn.disabled = false;
                        exportBtn.innerHTML = originalText;
                    }
                };
            </script>
        </div>
        <!-- mainContent Îã´Í∏∞ -->
    </body>
</html>
