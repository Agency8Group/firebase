<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, viewport-fit=cover"
        />
        <title>0000ÏÖÄÎü¨ Ï£ºÎ¨∏ ÏàòÏßë ÌéòÏù¥ÏßÄ</title>
        <style>
            *,
            *::before,
            *::after {
                box-sizing: border-box;
            }

            body {
                font-family: Arial, sans-serif;
                margin: 24px;
                line-height: 1.45;
                -webkit-text-size-adjust: 100%;
                background-color: #f8f9fa;
            }

            .wrap {
                max-width: 520px;
                margin: 0 auto;
                background: white;
                padding: 24px;
                border-radius: 12px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            h1 {
                font-size: 20px;
                margin-bottom: 24px;
                text-align: center;
                color: #333;
            }

            .title-row {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 12px;
                margin-bottom: 20px;
            }

            .icon-btn {
                background: #f0f0f0;
                color: #222;
                border: 1px solid #ddd;
                border-radius: 8px;
                padding: 8px 10px;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .icon-btn:hover {
                background: #e8e8e8;
            }

            .field {
                margin: 16px 0;
            }

            label {
                display: block;
                margin-bottom: 6px;
                font-weight: bold;
                color: #333;
            }

            input[type="text"],
            input[type="tel"],
            select {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 16px;
                min-height: 44px;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                transition: border-color 0.2s ease;
            }

            input::placeholder {
                color: #999;
                font-size: 14px;
                line-height: 1.4;
                opacity: 1;
            }

            #product::placeholder {
                font-size: 12px;
                line-height: 1.2;
                word-break: keep-all;
                white-space: normal;
            }

            input[type="text"]:focus,
            input[type="tel"]:focus,
            select:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
            }

            button {
                padding: 12px 16px;
                border: 0;
                background: #007bff;
                color: #fff;
                border-radius: 6px;
                cursor: pointer;
                font-size: 16px;
                min-height: 44px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
                transition: background-color 0.2s ease;
            }

            button:hover {
                background: #0056b3;
            }

            button:active {
                background: #004085;
            }

            button[disabled] {
                opacity: 0.6;
                cursor: not-allowed;
            }

            #btnSubmit {
                width: 100%;
                background: #28a745;
                margin-top: 20px;
            }

            #btnSubmit:hover {
                background: #1e7e34;
            }

            #btnFindAddr {
                background: #e0e0e0;
                color: #666;
            }

            #btnFindAddr:hover {
                background: #d0d0d0;
            }

            .msg {
                margin-top: 12px;
                font-size: 14px;
                padding: 10px;
                border-radius: 4px;
            }

            .msg.error {
                color: #721c24;
                background-color: #f8d7da;
                border: 1px solid #f5c6cb;
            }

            .msg.success {
                color: #155724;
                background-color: #d4edda;
                border: 1px solid #c3e6cb;
            }

            .addr-row {
                display: flex;
                gap: 8px;
            }

            .addr-row input {
                flex: 1;
            }

            .status-indicator {
                text-align: center;
                padding: 8px;
                border-radius: 4px;
                margin-bottom: 16px;
                font-size: 14px;
            }

            .status.connected {
                background-color: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }

            .status.disconnected {
                background-color: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }

            @media (max-width: 768px) {
                body {
                    margin: 12px;
                }

                .wrap {
                    padding: 16px;
                }

                .addr-row {
                    flex-direction: column;
                }
            }
        </style>
    </head>
    <body>
        <div class="wrap">
            <h1>üì¶ 0000ÏÖÄÎü¨ Ï£ºÎ¨∏ ÏàòÏßë</h1>

            <div id="status" class="status-indicator disconnected">
                üî¥ Firebase Ïó∞Í≤∞ Ï§ë...
            </div>

            <form id="orderForm">
                <div class="field">
                    <label for="customerName">Í≥†Í∞ùÎ™Ö *</label>
                    <input
                        type="text"
                        id="customerName"
                        name="customerName"
                        placeholder="ÏûÖÍ∏àÏûêÎ™Ö Í≥º ÎèôÏùºÌïú ÏÑ±Ìï®ÏùÑ ÎÑ£Ïñ¥Ï£ºÏÑ∏Ïöî"
                        required
                    />
                </div>

                <div class="field">
                    <label for="phone">Ïó∞ÎùΩÏ≤ò *</label>
                    <input
                        type="tel"
                        id="phone"
                        name="phone"
                        placeholder="010-0000-0000"
                        required
                    />
                </div>

                <div class="field">
                    <label for="product">ÏÉÅÌíàÎ™Ö *</label>
                    <input
                        type="text"
                        id="product"
                        name="product"
                        placeholder="Ï£ºÎ¨∏ÌïòÏã§ ÏÉÅÌíàÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî"
                        required
                    />
                </div>

                <div class="field">
                    <label for="zipcode">Ïö∞Ìé∏Î≤àÌò∏</label>
                    <div class="addr-row">
                        <input
                            type="text"
                            id="zipcode"
                            name="zipcode"
                            placeholder="Ïö∞Ìé∏Î≤àÌò∏"
                            readonly
                        />
                        <button type="button" id="btnFindAddr" class="icon-btn">
                            Ï£ºÏÜåÏ∞æÍ∏∞
                        </button>
                    </div>
                </div>

                <div class="field">
                    <label for="address">Ï£ºÏÜå</label>
                    <input
                        type="text"
                        id="address"
                        name="address"
                        placeholder="Ï£ºÏÜåÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî"
                    />
                </div>

                <div class="field">
                    <label for="detailAddress">ÏÉÅÏÑ∏Ï£ºÏÜå</label>
                    <input
                        type="text"
                        id="detailAddress"
                        name="detailAddress"
                        placeholder="ÏÉÅÏÑ∏Ï£ºÏÜåÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî"
                    />
                </div>

                <div class="field">
                    <label for="memo">Î©îÎ™®</label>
                    <input
                        type="text"
                        id="memo"
                        name="memo"
                        placeholder="Ï∂îÍ∞Ä ÏöîÏ≤≠ÏÇ¨Ìï≠Ïù¥ ÏûàÏúºÏãúÎ©¥ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî"
                    />
                </div>

                <button type="submit" id="btnSubmit">üì¶ Ï£ºÎ¨∏ Ï†ëÏàòÌïòÍ∏∞</button>
            </form>

            <div id="message" class="msg" style="display: none"></div>

            <div style="text-align: center; margin-top: 20px">
                <button type="button" id="btnAdmin" class="icon-btn">
                    üîß Í¥ÄÎ¶¨Ïûê
                </button>
            </div>
        </div>

        <!-- Firebase SDK -->
        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
            import {
                getDatabase,
                ref,
                push,
                onValue,
            } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

            // Your web app's Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyA3og6X2bk2Tb2cvs9wiTm_HqdqdlIuTt8",
                authDomain: "main-project-5d624.firebaseapp.com",
                projectId: "main-project-5d624",
                storageBucket: "main-project-5d624.firebasestorage.app",
                messagingSenderId: "232188977313",
                appId: "1:232188977313:web:247a5557753a2ead6750e0",
                measurementId: "G-BWVCXZMY53",
                databaseURL:
                    "https://main-project-5d624-default-rtdb.asia-southeast1.firebasedatabase.app",
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);

            // DOM ÏöîÏÜåÎì§
            const statusDiv = document.getElementById("status");
            const orderForm = document.getElementById("orderForm");
            const messageDiv = document.getElementById("message");
            const btnAdmin = document.getElementById("btnAdmin");

            // Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏
            const connectedRef = ref(database, ".info/connected");
            onValue(connectedRef, (snap) => {
                if (snap.val() === true) {
                    statusDiv.textContent =
                        "üü¢ Firebase Ïó∞Í≤∞Îê® - Ïã§ÏãúÍ∞Ñ Ï£ºÎ¨∏ Ï†ëÏàò Ï§ÄÎπÑ ÏôÑÎ£å!";
                    statusDiv.className = "status-indicator connected";
                } else {
                    statusDiv.textContent = "üî¥ Firebase Ïó∞Í≤∞ ÎÅäÍπÄ";
                    statusDiv.className = "status-indicator disconnected";
                }
            });

            // Ï£ºÎ¨∏ Ï†ëÏàò Ï≤òÎ¶¨
            orderForm.addEventListener("submit", async (e) => {
                e.preventDefault();

                const submitBtn = document.getElementById("btnSubmit");
                submitBtn.disabled = true;
                submitBtn.textContent = "üì§ Ï£ºÎ¨∏ Ï†ëÏàò Ï§ë...";

                try {
                    const formData = new FormData(orderForm);
                    const orderData = {
                        customerName: formData.get("customerName"),
                        phone: formData.get("phone"),
                        product: formData.get("product"),
                        quantity: 1, // Í∏∞Î≥∏Í∞í 1Í∞úÎ°ú ÏÑ§Ï†ï
                        zipcode: formData.get("zipcode"),
                        address: formData.get("address"),
                        detailAddress: formData.get("detailAddress"),
                        memo: formData.get("memo"),
                        status: "Ï†ëÏàò",
                        createdAt: Date.now(),
                        orderNumber: generateOrderNumber(),
                    };

                    // FirebaseÏóê Ï£ºÎ¨∏ Ï†ÄÏû•
                    const ordersRef = ref(database, "orders");
                    await push(ordersRef, orderData);

                    // ÏÑ±Í≥µ Î©îÏãúÏßÄ
                    showMessage(
                        "‚úÖ Ï£ºÎ¨∏Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§!",
                        "success"
                    );
                    orderForm.reset();
                } catch (error) {
                    console.error("Ï£ºÎ¨∏ Ï†ëÏàò Ïò§Î•ò:", error);
                    showMessage(
                        "‚ùå Ï£ºÎ¨∏ Ï†ëÏàò Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.",
                        "error"
                    );
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = "üì¶ Ï£ºÎ¨∏ Ï†ëÏàòÌïòÍ∏∞";
                }
            });

            // Ï£ºÎ¨∏Î≤àÌò∏ ÏÉùÏÑ±
            function generateOrderNumber() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, "0");
                const day = String(now.getDate()).padStart(2, "0");
                const hours = String(now.getHours()).padStart(2, "0");
                const minutes = String(now.getMinutes()).padStart(2, "0");
                const seconds = String(now.getSeconds()).padStart(2, "0");

                return `ORD${year}${month}${day}${hours}${minutes}${seconds}`;
            }

            // Î©îÏãúÏßÄ ÌëúÏãú
            function showMessage(text, type) {
                messageDiv.textContent = text;
                messageDiv.className = `msg ${type}`;
                messageDiv.style.display = "block";

                setTimeout(() => {
                    messageDiv.style.display = "none";
                }, 5000);
            }

            // Ïó∞ÎùΩÏ≤ò ÏûêÎèô Ìè¨Îß∑ÌåÖ
            const phoneInput = document.getElementById("phone");
            phoneInput.addEventListener("input", function (e) {
                let value = e.target.value.replace(/[^0-9]/g, ""); // Ïà´ÏûêÎßå Ï∂îÏ∂ú

                if (value.length <= 3) {
                    e.target.value = value;
                } else if (value.length <= 7) {
                    e.target.value = value.slice(0, 3) + "-" + value.slice(3);
                } else {
                    e.target.value =
                        value.slice(0, 3) +
                        "-" +
                        value.slice(3, 7) +
                        "-" +
                        value.slice(7, 11);
                }
            });

            // Ï£ºÏÜå Ï∞æÍ∏∞ Í∏∞Îä• (Daum Ïö∞Ìé∏Î≤àÌò∏ API)
            document
                .getElementById("btnFindAddr")
                .addEventListener("click", function () {
                    new daum.Postcode({
                        oncomplete: function (data) {
                            document.getElementById("zipcode").value =
                                data.zonecode;
                            document.getElementById("address").value =
                                data.address;
                            document.getElementById("detailAddress").focus();
                        },
                    }).open();
                });

            // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ Ïó¥Í∏∞
            btnAdmin.addEventListener("click", function () {
                const pin = prompt("Í¥ÄÎ¶¨Ïûê PINÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:");
                if (pin === "yhjk99") {
                    window.open("admin.html", "_blank");
                } else if (pin !== null) {
                    alert("ÏûòÎ™ªÎêú PINÏûÖÎãàÎã§.");
                }
            });

            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï£ºÏÜå API Î°úÎìú
            window.addEventListener("load", function () {
                if (typeof daum === "undefined") {
                    const script = document.createElement("script");
                    script.src =
                        "//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js";
                    document.head.appendChild(script);
                }
            });
        </script>
    </body>
</html>
