<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
        />
        <title>CTB ì…€ëŸ¬ ì£¼ë¬¸ ìˆ˜ì§‘ í˜ì´ì§€</title>

        <!-- Firebase Authentication SDK -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
            import {
                getAuth,
                signInWithEmailAndPassword,
                onAuthStateChanged,
                signInAnonymously,
            } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

            // Firebase ì„¤ì • (config.jsì—ì„œ ë¡œë“œ)
            const firebaseConfig = window.firebaseConfig;

            // Firebase ì´ˆê¸°í™”
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);

            // ì „ì—­ ë³€ìˆ˜ë¡œ authì™€ app ê°ì²´ ì„¤ì •
            window.auth = auth;
            window.app = app;

            // ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€ (indexì—ì„œëŠ” ìë™ ì´ë™í•˜ì§€ ì•ŠìŒ)
            onAuthStateChanged(auth, (user) => {
                // ê³ ê° í™”ë©´ì—ì„œëŠ” ìë™ ì´ë™ ì—†ìŒ. ë¹„ë¡œê·¸ì¸ ì‹œ ìµëª… ë¡œê·¸ì¸ ì‹œë„
                if (!user) {
                    try {
                        signInAnonymously(auth).catch(() => {
                            /* ê¶Œí•œ ì •ì±…ì— ë”°ë¼ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ */
                        });
                    } catch (_) {}
                }
            });

            // ë¡œê·¸ì¸ í•¨ìˆ˜
            window.login = async function () {
                const email = document.getElementById("loginEmail").value;
                const password = document.getElementById("loginPassword").value;

                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    document.getElementById("loginError").textContent = "";
                    // ê´€ë¦¬ì ë²„íŠ¼ì—ì„œ ì‹œì‘í•œ ê²½ìš°ì—ë§Œ adminìœ¼ë¡œ ì´ë™
                    if (window.isAdminLoginFlow) {
                        window.open("admin.html", "_blank");
                        window.isAdminLoginFlow = false;
                        document.getElementById("loginModal").style.display =
                            "none";
                    }
                } catch (error) {
                    document.getElementById("loginError").textContent =
                        "ì´ë©”ì¼ ì£¼ì†Œ ë° ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                }
            };
        </script>

        <style>
            *,
            *::before,
            *::after {
                box-sizing: border-box;
            }

            body {
                font-family: Arial, sans-serif;
                margin: 24px;
                line-height: 1.45;
                -webkit-text-size-adjust: 100%;
                background-color: #f8f9fa;
            }

            .wrap {
                max-width: 520px;
                margin: 0 auto;
                background: white;
                padding: 24px;
                border-radius: 12px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            h1 {
                font-size: 20px;
                margin-bottom: 24px;
                text-align: center;
                color: #333;
            }

            .title-row {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 12px;
                margin-bottom: 20px;
            }

            .icon-btn {
                background: #f0f0f0;
                color: #222;
                border: 1px solid #ddd;
                border-radius: 8px;
                padding: 8px 10px;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .icon-btn:hover {
                background: #e8e8e8;
            }

            .field {
                margin: 16px 0;
            }

            label {
                display: block;
                margin-bottom: 6px;
                font-weight: bold;
                color: #333;
            }

            input[type="text"],
            input[type="tel"],
            select {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 16px;
                min-height: 44px;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                transition: border-color 0.2s ease;
            }

            input::placeholder {
                color: #999;
                font-size: 14px;
                line-height: 1.4;
                opacity: 1;
            }

            select option[disabled] {
                color: #999;
                font-style: italic;
            }

            select:invalid {
                color: #999;
            }

            select:valid {
                color: #333;
            }

            #product::placeholder {
                font-size: 12px;
                line-height: 1.2;
                word-break: keep-all;
                white-space: normal;
            }

            input[type="text"]:focus,
            input[type="tel"]:focus,
            select:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
            }

            button {
                padding: 12px 16px;
                border: 0;
                background: #007bff;
                color: #fff;
                border-radius: 6px;
                cursor: pointer;
                font-size: 16px;
                min-height: 48px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
                transition: background-color 0.2s ease;
                -webkit-user-select: none;
                user-select: none;
            }

            button:hover {
                background: #0056b3;
                transform: translateY(-1px);
            }

            button:active {
                background: #004085;
                transform: translateY(0);
            }

            button[disabled] {
                opacity: 0.6;
                cursor: not-allowed;
            }

            #btnSubmit {
                width: 100%;
                background: #28a745;
                margin-top: 20px;
            }

            #btnSubmit:hover {
                background: #1e7e34;
            }

            #btnFindAddr {
                background: #e0e0e0;
                color: #666;
            }

            #btnFindAddr:hover {
                background: #d0d0d0;
            }

            .msg {
                margin-top: 12px;
                font-size: 14px;
                padding: 10px;
                border-radius: 4px;
                white-space: pre-line; /* ì¤„ë°”ê¿ˆ ì§€ì› */
                word-wrap: break-word; /* ê¸´ ë‹¨ì–´ ì¤„ë°”ê¿ˆ */
                max-width: 100%;
                overflow-wrap: break-word;
            }

            .msg.error {
                color: #721c24;
                background-color: #f8d7da;
                border: 1px solid #f5c6cb;
            }

            .msg.success {
                color: #155724;
                background-color: #d4edda;
                border: 1px solid #c3e6cb;
            }

            .msg.info {
                color: #0c5460;
                background-color: #d1ecf1;
                border: 1px solid #bee5eb;
            }

            /* ëª¨ë°”ì¼ ìµœì í™” */
            @media (max-width: 768px) {
                .msg {
                    margin-top: 16px;
                    padding: 16px;
                    font-size: 15px;
                    line-height: 1.6;
                    border-radius: 8px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                }
            }

            .addr-row {
                display: flex;
                gap: 8px;
            }

            .addr-row input {
                flex: 1;
            }

            /* Radio Button Styles */
            .radio-group {
                display: flex;
                flex-direction: column;
                gap: 8px;
                flex-wrap: nowrap;
            }

            .radio-row {
                display: flex;
                gap: 12px;
                justify-content: center;
            }

            .radio-item {
                display: flex;
                align-items: center;
                gap: 8px;
                cursor: pointer;
                padding: 8px 12px;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                background: white;
                transition: all 0.2s ease;
                width: 100%;
                justify-content: flex-start;
                min-height: 36px;
            }

            .radio-item:hover {
                border-color: #007bff;
                background: #f8f9ff;
            }

            .radio-item input[type="radio"] {
                display: none;
            }

            .radio-custom {
                width: 14px;
                height: 14px;
                border: 2px solid #ddd;
                border-radius: 50%;
                position: relative;
                transition: all 0.2s ease;
                flex-shrink: 0;
            }

            .radio-item input[type="radio"]:checked + .radio-custom {
                border-color: #007bff;
                background: #007bff;
            }

            .radio-item input[type="radio"]:checked + .radio-custom::after {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 5px;
                height: 5px;
                background: white;
                border-radius: 50%;
            }

            .radio-item input[type="radio"]:checked ~ .radio-label {
                color: #007bff;
                font-weight: 600;
            }

            .radio-label {
                font-size: 13px;
                color: #495057;
                transition: all 0.2s ease;
                font-weight: 500;
            }

            /* SVG Icon Styles */
            .inline-icon {
                width: 18px;
                height: 18px;
                vertical-align: middle;
                margin-right: 6px;
            }

            .status-indicator {
                display: inline-block;
                width: 16px;
                height: 16px;
                border-radius: 50%;
                margin-left: 12px;
                vertical-align: middle;
                border: 2px solid #ddd;
                animation: pulse 2s infinite;
            }

            .status-indicator.connected {
                background-color: #28a745;
                border-color: #28a745;
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
                animation: pulse 2s infinite;
            }

            .status-indicator.disconnected {
                background-color: #dc3545;
                border-color: #dc3545;
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
                }
            }

            .status-indicator.disconnected {
                animation: pulse-disconnected 2s infinite;
            }

            @keyframes pulse-disconnected {
                0% {
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
                }
            }

            @media (max-width: 768px),
                (max-device-width: 768px),
                (orientation: portrait) and (max-width: 1024px) {
                body {
                    margin: 4px;
                    font-size: 15px;
                    -webkit-text-size-adjust: 100%;
                    -webkit-tap-highlight-color: transparent;
                }

                .wrap {
                    padding: 20px 16px;
                    border-radius: 12px;
                    max-width: 100%;
                    box-sizing: border-box;
                    overflow-x: hidden;
                    margin: 8px;
                }

                h1 {
                    font-size: 20px;
                    margin-bottom: 24px;
                    line-height: 1.3;
                }

                .field {
                    margin: 20px 0;
                }

                label {
                    font-size: 15px;
                    margin-bottom: 8px;
                    font-weight: 600;
                    color: #2c3e50;
                }

                input[type="text"],
                input[type="tel"],
                select {
                    font-size: 16px;
                    padding: 16px 14px;
                    min-height: 52px;
                    border-radius: 8px;
                    border: 2px solid #e9ecef;
                    background-color: #fafafa;
                }

                input[type="text"]:focus,
                input[type="tel"]:focus,
                select:focus {
                    border-color: #007bff;
                    background-color: white;
                    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
                }

                .addr-row {
                    flex-direction: column;
                    gap: 12px;
                }

                .radio-group {
                    gap: 8px;
                    flex-wrap: nowrap;
                    width: 100%;
                    overflow: hidden;
                }

                .radio-row {
                    gap: 10px;
                    flex-wrap: wrap;
                    justify-content: center;
                }

                .radio-item {
                    flex: 1;
                    padding: 12px 14px;
                    flex-shrink: 0;
                    border-radius: 8px;
                    min-height: 48px;
                    max-width: calc(50% - 5px);
                    border: 2px solid #e9ecef;
                    background: white;
                    transition: all 0.2s ease;
                }

                .radio-item:hover,
                .radio-item:active {
                    border-color: #007bff;
                    background: #f8f9ff;
                    transform: translateY(-1px);
                }

                .radio-label {
                    font-size: 13px;
                    font-weight: 500;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }

                #btnAdmin {
                    display: none !important;
                }

                .simple-footer {
                    margin-top: 32px;
                    padding: 20px 0;
                }

                /* ëª¨ë°”ì¼ ì „ìš© ì¶”ê°€ ìµœì í™” */
                button {
                    min-height: 56px;
                    font-size: 16px;
                    padding: 16px 20px;
                    border-radius: 8px;
                    font-weight: 600;
                    letter-spacing: 0.5px;
                }

                #btnSubmit {
                    min-height: 60px;
                    font-size: 18px;
                    font-weight: 700;
                    background: linear-gradient(135deg, #28a745, #20c997);
                    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
                    margin-top: 24px;
                }

                #btnSubmit:hover,
                #btnSubmit:active {
                    background: linear-gradient(135deg, #1e7e34, #1a9f7a);
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
                }

                .modal-content {
                    padding: 24px 20px;
                    margin: 20px;
                    width: calc(100% - 40px);
                    max-width: none;
                    border-radius: 16px;
                }

                .modal-buttons {
                    flex-direction: column;
                    gap: 16px;
                }

                .btn-confirm,
                .btn-cancel {
                    min-height: 56px;
                    font-size: 16px;
                    font-weight: 600;
                }

                .order-summary {
                    font-size: 14px;
                    padding: 16px;
                    border-radius: 8px;
                }

                .order-summary-item {
                    margin-bottom: 8px;
                    padding: 4px 0;
                }

                /* ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜í•˜ê¸° ì‰½ê²Œ ê°„ê²© ì¡°ì • */
                .field {
                    margin: 20px 0;
                }

                input[type="text"],
                input[type="tel"],
                select {
                    margin-bottom: 6px;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ë¼ë””ì˜¤ ë²„íŠ¼ í„°ì¹˜ ì˜ì—­ í™•ëŒ€ */
                .radio-item {
                    min-height: 48px;
                    padding: 12px 14px;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ì£¼ì†Œì°¾ê¸° ë²„íŠ¼ ìµœì í™” */
                #btnFindAddr {
                    min-height: 52px;
                    font-size: 15px;
                    padding: 14px 18px;
                    background: linear-gradient(135deg, #6c757d, #5a6268);
                    color: white;
                    border: none;
                    font-weight: 600;
                }

                #btnFindAddr:hover,
                #btnFindAddr:active {
                    background: linear-gradient(135deg, #5a6268, #495057);
                    transform: translateY(-1px);
                }

                /* ëª¨ë°”ì¼ì—ì„œ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ ê°œì„  */
                .msg {
                    margin-top: 16px;
                    padding: 14px 16px;
                    border-radius: 8px;
                    font-size: 15px;
                    font-weight: 500;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ì²˜ë¦¬ ì œí•œ ì•ˆë‚´ ê°œì„  */
                #processingLimits {
                    margin-top: 12px;
                    padding: 12px 16px;
                    background: #fff3cd;
                    border: 1px solid #ffeaa7;
                    border-radius: 8px;
                    font-size: 13px;
                    line-height: 1.5;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ì¸ë¼ì¸ ì•„ì´ì½˜ í¬ê¸° ì¡°ì • */
                .inline-icon {
                    width: 20px;
                    height: 20px;
                    margin-right: 8px;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ìƒíƒœ í‘œì‹œê¸° ê°œì„  */
                .status-indicator {
                    width: 18px;
                    height: 18px;
                    margin-left: 16px;
                }
            }

            /* ëª¨ë°”ì¼ í„°ì¹˜ ìµœì í™” ì¶”ê°€ ìŠ¤íƒ€ì¼ */
            @media (max-width: 768px) {
                /* í„°ì¹˜ ìŠ¤í¬ë¡¤ ìµœì í™” */
                * {
                    -webkit-overflow-scrolling: touch;
                    scroll-behavior: smooth;
                }

                /* ëª¨ë°”ì¼ì—ì„œ í¬ì»¤ìŠ¤ ë§ ì œê±° */
                *:focus {
                    outline: none;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ì„ íƒ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
                ::selection {
                    background: rgba(0, 123, 255, 0.2);
                    color: #2c3e50;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ì…ë ¥ í•„ë“œ ìë™ í™•ëŒ€ ë°©ì§€ */
                input[type="text"],
                input[type="tel"],
                select {
                    font-size: 16px !important;
                    transform: none !important;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ í„°ì¹˜ í”¼ë“œë°± */
                button:active {
                    transform: scale(0.98);
                    transition: transform 0.1s ease;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ë¼ë””ì˜¤ ë²„íŠ¼ í„°ì¹˜ í”¼ë“œë°± */
                .radio-item:active {
                    transform: scale(0.95);
                    transition: transform 0.1s ease;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
                ::-webkit-scrollbar {
                    display: none;
                }

                /* ëª¨ë°”ì¼ì—ì„œ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ (ë²„íŠ¼ ì œì™¸) */
                .wrap {
                    -webkit-user-select: none;
                    -moz-user-select: none;
                    -ms-user-select: none;
                    user-select: none;
                }

                input,
                textarea,
                select {
                    -webkit-user-select: text;
                    -moz-user-select: text;
                    -ms-user-select: text;
                    user-select: text;
                }
            }

            /* Simple Footer */
            .simple-footer {
                margin-top: 40px;
                padding: 20px 0;
                text-align: center;
                border-top: 1px solid #e9ecef;
            }

            .simple-footer a {
                color: #6c757d;
                text-decoration: none;
                font-size: 12px;
                transition: color 0.2s ease;
            }

            .simple-footer a:hover {
                color: #495057;
            }

            /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
            .modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            }

            .modal-content {
                background: white;
                padding: 24px;
                border-radius: 12px;
                max-width: 90%;
                width: 400px;
                max-height: 80vh;
                overflow-y: auto;
            }

            .modal-content h3 {
                margin: 0 0 16px 0;
                color: #212529;
                font-size: 18px;
                text-align: center;
            }

            .order-summary {
                background: #f8f9fa;
                padding: 16px;
                border-radius: 8px;
                margin-bottom: 20px;
                font-size: 14px;
                line-height: 1.5;
            }

            .order-summary-item {
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
            }

            .order-summary-item:last-child {
                margin-bottom: 0;
            }

            .modal-buttons {
                display: flex;
                gap: 12px;
                justify-content: center;
            }

            .btn-confirm {
                background: #28a745;
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
                min-height: 44px;
                flex: 1;
            }

            .btn-confirm:hover {
                background: #1e7e34;
            }

            .btn-cancel {
                background: #6c757d;
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
                min-height: 44px;
                flex: 1;
            }

            .btn-cancel:hover {
                background: #545b62;
            }

            @media (max-width: 768px) {
                .modal-content {
                    padding: 20px;
                    margin: 16px;
                }

                .modal-buttons {
                    flex-direction: column;
                }
            }

            /* ë¡œê·¸ì¸ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
            .login-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            }

            .login-container {
                background: white;
                padding: 32px;
                border-radius: 12px;
                max-width: 90%;
                width: 400px;
                text-align: center;
            }

            .login-container h2 {
                margin: 0 0 24px 0;
                color: #333;
                font-size: 20px;
            }

            .login-input {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 16px;
                margin-bottom: 16px;
                box-sizing: border-box;
            }

            .login-input:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
            }

            .login-btn {
                width: 100%;
                background: #007bff;
                color: white;
                border: none;
                padding: 12px;
                border-radius: 6px;
                font-size: 16px;
                cursor: pointer;
                transition: background-color 0.2s ease;
            }

            .login-btn:hover {
                background: #0056b3;
            }

            .login-error {
                color: #dc3545;
                font-size: 14px;
                margin-top: 12px;
                min-height: 20px;
            }

            .close-btn {
                position: absolute;
                top: 24px;
                right: 24px;
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                color: #666;
                padding: 0;
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .close-btn:hover {
                color: #333;
            }
        </style>
    </head>
    <body>
        <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
        <div id="loginModal" class="login-modal">
            <div class="login-container">
                <button class="close-btn" onclick="closeLoginModal()">
                    &times;
                </button>
                <h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
                <input
                    type="email"
                    id="loginEmail"
                    class="login-input"
                    placeholder="ì´ë©”ì¼ ì£¼ì†Œ"
                    required
                />
                <input
                    type="password"
                    id="loginPassword"
                    class="login-input"
                    placeholder="ë¹„ë°€ë²ˆí˜¸"
                    required
                />
                <button onclick="login()" class="login-btn">ë¡œê·¸ì¸</button>
                <div id="loginError" class="login-error"></div>
            </div>
        </div>

        <div class="wrap">
            <h1>
                <svg
                    class="inline-icon"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                >
                    <path
                        d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h4c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"
                    />
                </svg>
                0000ì…€ëŸ¬ ì£¼ë¬¸ ìˆ˜ì§‘<span
                    id="status"
                    class="status-indicator disconnected"
                ></span>
            </h1>

            <form id="orderForm">
                <div class="field">
                    <label>ì£¼ë¬¸ ìœ í˜• *</label>
                    <div class="radio-group">
                        <div class="radio-row">
                            <label class="radio-item">
                                <input
                                    type="radio"
                                    name="orderType"
                                    value="ì‹ ê·œì£¼ë¬¸"
                                    checked
                                />
                                <span class="radio-custom"></span>
                                <span class="radio-label">ì‹ ê·œì£¼ë¬¸</span>
                            </label>
                            <label class="radio-item">
                                <input
                                    type="radio"
                                    name="orderType"
                                    value="ë°°ì†¡ì¡°íšŒ"
                                />
                                <span class="radio-custom"></span>
                                <span class="radio-label">ë°°ì†¡ì¡°íšŒ</span>
                            </label>
                        </div>
                    </div>
                    <div
                        id="processingLimits"
                        style="
                            margin-top: 8px;
                            font-size: 12px;
                            color: #666;
                            line-height: 1.4;
                            display: none;
                        "
                    >
                        <strong>ì•ˆë‚´:</strong><br />
                        â€¢ ì‹ ê·œì£¼ë¬¸: ìƒˆë¡œìš´ ì£¼ë¬¸ì„ ì ‘ìˆ˜í•©ë‹ˆë‹¤<br />
                        â€¢ ë°°ì†¡ì¡°íšŒ: ì…ê¸ˆìëª…ê³¼ ì „í™”ë²ˆí˜¸ë¡œ ë°°ì†¡ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤
                    </div>
                </div>

                <div
                    class="field"
                    id="existingOrderField"
                    style="display: none"
                >
                    <label for="searchCustomerName">ë°°ì†¡ì¡°íšŒ *</label>
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">
                        ì…ê¸ˆìëª…ê³¼ ì „í™”ë²ˆí˜¸ë¡œ ì¡°íšŒí•˜ì„¸ìš”:
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input
                            type="text"
                            id="searchCustomerName"
                            name="searchCustomerName"
                            placeholder="ì…ê¸ˆìëª…"
                            style="flex: 1;"
                        />
                        <input
                            type="tel"
                            id="searchPhone"
                            name="searchPhone"
                            placeholder="ì „í™”ë²ˆí˜¸"
                            style="flex: 1;"
                        />
                        <button type="button" id="btnSearchByNamePhone" class="icon-btn" style="white-space: nowrap; min-width: 88px;">ì¡°íšŒ</button>
                    </div>
                    <div style="font-size: 11px; color: #888; margin-top: 4px;">
                        â€¢ ë™ì¼í•œ ì…ê¸ˆìëª…ê³¼ ì „í™”ë²ˆí˜¸ë¡œ ì—¬ëŸ¬ ì£¼ë¬¸ì´ ìˆì„ ê²½ìš° ëª¨ë‘ í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                </div>

                <div class="field">
                    <label for="customerName">ê³ ê°ëª… *</label>
                    <input
                        type="text"
                        id="customerName"
                        name="customerName"
                        placeholder="ì…ê¸ˆìëª… ê³¼ ë™ì¼í•œ ì„±í•¨ì„ ë„£ì–´ì£¼ì„¸ìš”"
                        required
                    />
                </div>

                <div class="field">
                    <label for="phone">ì—°ë½ì²˜ *</label>
                    <input
                        type="tel"
                        id="phone"
                        name="phone"
                        placeholder="010-0000-0000"
                        required
                    />
                </div>

                <div class="field">
                    <label for="product">ìƒí’ˆëª… *</label>
                    <input
                        type="text"
                        id="product"
                        name="product"
                        placeholder="ìƒí’ˆëª…/ì‚¬ì´ì¦ˆ/ìƒ‰ìƒ ìˆœ
 ë¸Œëœë“œ í‹°ì…”ì¸  sì‚¬ì´ì¦ˆ ë¸”ë™"
                        required
                    />
                </div>

                <div class="field">
                    <label for="quantity">ìˆ˜ëŸ‰ *</label>
                    <select id="quantity" name="quantity" required>
                        <option value="" disabled selected>
                            ìˆ˜ëŸ‰ì„ ì„ íƒí•˜ì„¸ìš”
                        </option>
                        <option value="1">1ê°œ</option>
                        <option value="2">2ê°œ</option>
                        <option value="3">3ê°œ</option>
                        <option value="4">4ê°œ</option>
                        <option value="5">5ê°œ</option>
                        <option value="6">6ê°œ</option>
                        <option value="7">7ê°œ</option>
                        <option value="8">8ê°œ</option>
                        <option value="9">9ê°œ</option>
                        <option value="10">10ê°œ</option>
                    </select>
                </div>

                <div class="field">
                    <label for="zipcode">ìš°í¸ë²ˆí˜¸</label>
                    <div class="addr-row">
                        <input
                            type="text"
                            id="zipcode"
                            name="zipcode"
                            placeholder="ìš°í¸ë²ˆí˜¸"
                            readonly
                        />
                        <button type="button" id="btnFindAddr" class="icon-btn">
                            ì£¼ì†Œì°¾ê¸°
                        </button>
                    </div>
                </div>

                <div class="field">
                    <label for="address">ì£¼ì†Œ</label>
                    <input
                        type="text"
                        id="address"
                        name="address"
                        placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                    />
                </div>

                <div class="field">
                    <label for="detailAddress">ìƒì„¸ì£¼ì†Œ</label>
                    <input
                        type="text"
                        id="detailAddress"
                        name="detailAddress"
                        placeholder="ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                    />
                </div>

                <div class="field">
                    <label for="memo">ë°°ì†¡ë©”ì„¸ì§€</label>
                    <input
                        type="text"
                        id="memo"
                        name="memo"
                        placeholder="ë°°ì†¡ ê´€ë ¨ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                    />
                </div>

                <!-- í™˜ë¶ˆ ê³„ì¢Œì •ë³´ í•„ë“œëŠ” 1ì°¨ ë²„ì „ì—ì„œ ì œì™¸ë¨ -->

                <button type="submit" id="btnSubmit">
                    <svg
                        class="inline-icon"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                    >
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>
                    ì£¼ë¬¸ ì ‘ìˆ˜í•˜ê¸°
                </button>
            </form>

            <div id="message" class="msg" style="display: none"></div>

            <!-- ì£¼ë¬¸ ì™„ë£Œ í™•ì¸ ëª¨ë‹¬ -->
            <div id="orderConfirmModal" class="modal" style="display: none">
                <div class="modal-content">
                    <h3>ğŸ“‹ ì£¼ë¬¸ ë‚´ì—­ í™•ì¸</h3>
                    <div id="orderSummary" class="order-summary"></div>
                    <div class="modal-buttons">
                        <button
                            type="button"
                            id="confirmOrder"
                            class="btn-confirm"
                        >
                            ë„¤, ë§ìŠµë‹ˆë‹¤
                        </button>
                        <button
                            type="button"
                            id="cancelOrder"
                            class="btn-cancel"
                        >
                            ìˆ˜ì •í•˜ê¸°
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì£¼ë¬¸ë‚´ì—­ ì €ì¥ í™•ì¸ ëª¨ë‹¬ -->
            <div id="saveOrderModal" class="modal" style="display: none">
                <div class="modal-content">
                    <h3>ğŸ’¾ ì£¼ë¬¸ë‚´ì—­ ì €ì¥</h3>
                    <p>ì£¼ë¬¸ë‚´ì—­ì„ ì•¨ë²”ì— ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                    <div class="modal-buttons">
                        <button
                            type="button"
                            id="saveToAlbum"
                            class="btn-confirm"
                        >
                            ì €ì¥í•˜ê¸°
                        </button>
                        <button type="button" id="skipSave" class="btn-cancel">
                            ê±´ë„ˆë›°ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê´€ë¦¬ì ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨) -->
        <button
            type="button"
            id="btnAdmin"
            class="icon-btn"
            style="
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                width: 40px;
                height: 40px;
            "
        >
            <svg
                class="inline-icon"
                viewBox="0 0 24 24"
                fill="currentColor"
                style="margin: 0"
            >
                <path
                    d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                />
            </svg>
        </button>

        <!-- Simple Footer -->
        <footer class="simple-footer">
            <a href="https://cx-tech-builder.netlify.app/" target="_blank">
                Powered by CX Tech Builder
            </a>
        </footer>

        <!-- ì„¤ì • íŒŒì¼ (Firebase ì„¤ì • ë¡œë“œ) -->
        <script src="config.js"></script>

        <!-- Firebase SDK -->
        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
            import {
                getDatabase,
                ref,
                push,
                onValue,
                get,
            } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

            // Firebase ì„¤ì •ì€ ì´ë¯¸ headì—ì„œ ì´ˆê¸°í™”ë¨
            const database = getDatabase(window.app);

            // DOM ìš”ì†Œë“¤
            const statusDiv = document.getElementById("status");
            const orderForm = document.getElementById("orderForm");
            const messageDiv = document.getElementById("message");
            const btnAdmin = document.getElementById("btnAdmin");

            // ì—°ê²° ìƒíƒœ í™•ì¸
            const connectedRef = ref(database, ".info/connected");
            onValue(connectedRef, (snap) => {
                if (snap.val() === true) {
                    statusDiv.className = "status-indicator connected";
                } else {
                    statusDiv.className = "status-indicator disconnected";
                }
            });

            // ì£¼ë¬¸ ì ‘ìˆ˜ ì²˜ë¦¬
            orderForm.addEventListener("submit", async (e) => {
                e.preventDefault();

                const submitBtn = document.getElementById("btnSubmit");
                submitBtn.disabled = true;
                submitBtn.textContent = "ğŸ“¤ ì£¼ë¬¸ ì ‘ìˆ˜ ì¤‘...";

                try {
                    const formData = new FormData(orderForm);
                    const orderType = formData.get("orderType");
                    // ì£¼ë¬¸ë²ˆí˜¸ ì…ë ¥ í•„ë“œëŠ” ì œê±°ë¨
                    const phone = formData.get("phone");

                    // ë°°ì†¡ì¡°íšŒì¸ ê²½ìš° ì…ê¸ˆìëª…+ì „í™”ë²ˆí˜¸ë¡œ ì¡°íšŒ
                    if (orderType === "ë°°ì†¡ì¡°íšŒ") {
                        const customerName = formData.get("searchCustomerName");
                        const phone = formData.get("searchPhone");
                        
                        if (!customerName || !phone) {
                            showMessage(
                                "âŒ ì…ê¸ˆìëª…ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.",
                                "error"
                            );
                            return;
                        }

                        try {
                            const matchingOrders = await searchOrderByNameAndPhone(customerName, phone);
                            
                            if (matchingOrders && matchingOrders.length > 0) {
                                if (matchingOrders.length === 1) {
                                    // ë‹¨ì¼ ì£¼ë¬¸ì¸ ê²½ìš° ë°”ë¡œ í‘œì‹œ
                                    const [id, order] = matchingOrders[0];
                                    displayOrderInfo(order);
                                } else {
                                    // ì—¬ëŸ¬ ì£¼ë¬¸ì¸ ê²½ìš° ëª©ë¡ í‘œì‹œ
                                    showMultipleOrdersModal(matchingOrders);
                                }
                            } else {
                                showMessage("âŒ í•´ë‹¹ ì •ë³´ë¡œ ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
                            }
                        } catch (error) {
                            console.error("ì¡°íšŒ ì˜¤ë¥˜:", error);
                            showMessage("âŒ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
                        }
                        return; // ë°°ì†¡ì¡°íšŒëŠ” ì—¬ê¸°ì„œ ì¢…ë£Œ
                    }

                    // ì£¼ë¬¸ ë‚´ì—­ ìƒì„±
                    const orderData = {
                        customerName: formData.get("customerName"),
                        phone: formData.get("phone"),
                        product: formData.get("product"),
                        quantity: parseInt(formData.get("quantity")),
                        orderType: orderType,
                        // ì£¼ë¬¸ë²ˆí˜¸ ì…ë ¥ í•„ë“œëŠ” ì œê±°ë¨
                        zipcode: formData.get("zipcode"),
                        address: formData.get("address"),
                        detailAddress: formData.get("detailAddress"),
                        memo: formData.get("memo"),
                        refundAccount: null, // 1ì°¨ ë²„ì „ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
                        status: getStatusByOrderType(orderType),
                        createdAt: Date.now(),
                        orderNumber: generateOrderNumber(),
                    };

                    // ì£¼ë¬¸ ë‚´ì—­ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
                    showOrderConfirmModal(orderData);
                } catch (error) {
                    console.error("ì£¼ë¬¸ ì ‘ìˆ˜ ì˜¤ë¥˜:", error);
                    showMessage(
                        "âŒ ì£¼ë¬¸ ì ‘ìˆ˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                        "error"
                    );
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = "ğŸ“¦ ì£¼ë¬¸ ì ‘ìˆ˜í•˜ê¸°";
                }
            });

            // ê¸°ì¡´ ì£¼ë¬¸ ê²€ìƒ‰ (ì›”ë³„ í´ë” êµ¬ì¡°ì—ì„œ ê²€ìƒ‰)
            function normalizeOrderNumber(input) {
                try {
                    if (!input) return "";
                    // ì œë¡œí­/ë¹„ê°€ì‹œ ê³µë°± ì œê±° + ëª¨ë“  ê³µë°±/í•˜ì´í”ˆ ì œê±° + ëŒ€ë¬¸ìí™”
                    const cleaned = String(input)
                        .replace(/[\u200B-\u200D\uFEFF]/g, "")
                        .replace(/\s+/g, "")
                        .replace(/-/g, "");
                    return cleaned.toUpperCase();
                } catch (_) {
                    return String(input || "");
                }
            }

            function normalizePhone(input) {
                try {
                    if (!input) return "";
                    return String(input).replace(/[^0-9]/g, "");
                } catch (_) {
                    return String(input || "");
                }
            }

            async function findExistingOrder(orderNumber, phone = "") {
                try {
                    // ì½ê¸° ì „ì— ìµëª… ì¸ì¦ ë³´ì¥ ì‹œë„ (ì‹¤ê¸°ê¸° ê¶Œí•œ ì´ìŠˆ ëŒ€ë¹„)
                    try {
                        if (!auth.currentUser) {
                            await signInAnonymously(auth);
                        }
                    } catch (_) {}

                    const ordersRef = ref(database, "orders");
                    const snapshot = await get(ordersRef);
                    const data = snapshot.val();

                    if (!data) return null;

                    // ëª¨ë“  ì›”ë³„ í´ë”ì—ì„œ ì£¼ë¬¸ ê²€ìƒ‰
                    let allOrders = [];
                    for (const [yearMonth, monthOrders] of Object.entries(
                        data
                    )) {
                        if (monthOrders && typeof monthOrders === "object") {
                            const monthOrderEntries =
                                Object.entries(monthOrders);
                            allOrders = allOrders.concat(monthOrderEntries);
                        }
                    }
                    let existingOrder;

                    const targetOrder = normalizeOrderNumber(orderNumber);
                    const targetPhone = normalizePhone(phone);

                    if (phone) {
                        // íœ´ëŒ€í°ë²ˆí˜¸ì™€ ì£¼ë¬¸ë²ˆí˜¸ ëª¨ë‘ë¡œ ê²€ìƒ‰ (ì •ê·œí™” ì¼ì¹˜)
                        existingOrder = allOrders.find(([id, order]) => {
                            const oNum = normalizeOrderNumber(order.orderNumber);
                            const oPhone = normalizePhone(order.phone);
                            return oNum === targetOrder && oPhone === targetPhone;
                        });
                    } else {
                        // ì£¼ë¬¸ë²ˆí˜¸ë§Œìœ¼ë¡œ ê²€ìƒ‰ - ì •í™•í•œ ì¼ì¹˜ì™€ ì •ê·œí™” ì¼ì¹˜ ëª¨ë‘ ì‹œë„
                        existingOrder = allOrders.find(([id, order]) => {
                            // 1. ì •í™•í•œ ì¼ì¹˜ ë¨¼ì € ì‹œë„
                            if (order.orderNumber === orderNumber) {
                                return true;
                            }
                            // 2. ì •ê·œí™”ëœ ì¼ì¹˜ ì‹œë„
                            const oNum = normalizeOrderNumber(order.orderNumber);
                            return oNum === targetOrder;
                        });
                    }

                    return existingOrder ? existingOrder[1] : null;
                } catch (error) {
                    console.error("ê¸°ì¡´ ì£¼ë¬¸ ê²€ìƒ‰ ì˜¤ë¥˜:", error);
                    return null;
                }
            }

            // ì£¼ë¬¸ ìœ í˜•ì— ë”°ë¥¸ ìƒíƒœ ì„¤ì •
            function getStatusByOrderType(orderType) {
                // ëª¨ë“  ì ‘ìˆ˜ëŠ” "ì ‘ìˆ˜"ë¡œ í†µì¼ (ì£¼ë¬¸ìœ í˜•ìœ¼ë¡œ êµ¬ë¶„)
                return "ì ‘ìˆ˜";
            }

            // ì£¼ë¬¸ë²ˆí˜¸ ìƒì„±
            function generateOrderNumber() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, "0");
                const day = String(now.getDate()).padStart(2, "0");
                const hours = String(now.getHours()).padStart(2, "0");
                const minutes = String(now.getMinutes()).padStart(2, "0");
                const seconds = String(now.getSeconds()).padStart(2, "0");

                return `ORD${year}${month}${day}${hours}${minutes}${seconds}`;
            }

            // ì£¼ë¬¸ ë‚´ì—­ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
            function showOrderConfirmModal(orderData) {
                const modal = document.getElementById("orderConfirmModal");
                const summary = document.getElementById("orderSummary");

                summary.innerHTML = `
                    <div class="order-summary-item">
                        <span>ê³ ê°ëª…:</span>
                        <span>${orderData.customerName}</span>
                    </div>
                    <div class="order-summary-item">
                        <span>ì—°ë½ì²˜:</span>
                        <span>${orderData.phone}</span>
                    </div>
                    <div class="order-summary-item">
                        <span>ìƒí’ˆëª…:</span>
                        <span>${orderData.product}</span>
                    </div>
                    <div class="order-summary-item">
                        <span>ìˆ˜ëŸ‰:</span>
                        <span>${orderData.quantity}ê°œ</span>
                    </div>
                    <div class="order-summary-item">
                        <span>ì£¼ë¬¸ ìœ í˜•:</span>
                        <span>${orderData.orderType}</span>
                    </div>
                    ${
                        orderData.address
                            ? `
                    <div class="order-summary-item">
                        <span>ì£¼ì†Œ:</span>
                        <span>${orderData.address} ${
                                  orderData.detailAddress || ""
                              }</span>
                    </div>
                    `
                            : ""
                    }
                    ${
                        orderData.memo
                            ? `
                    <div class="order-summary-item">
                        <span>ë©”ëª¨:</span>
                        <span>${orderData.memo}</span>
                    </div>
                    `
                            : ""
                    }
                    <!-- í™˜ë¶ˆ ê³„ì¢Œì •ë³´ëŠ” 1ì°¨ ë²„ì „ì—ì„œ ì œì™¸ë¨ -->
                    <div class="order-summary-item">
                        <span>ì…ê¸ˆê³„ì¢Œ:</span>
                        <span>0000-0000-0000-0000 (0000ì…€ëŸ¬)</span>
                    </div>
                `;

                modal.style.display = "flex";

                // ëª¨ë‹¬ì— ì£¼ë¬¸ ë°ì´í„° ì €ì¥
                modal.orderData = orderData;
            }

            // ì£¼ë¬¸ë‚´ì—­ ì €ì¥ ëª¨ë‹¬ í‘œì‹œ
            function showSaveOrderModal(orderData) {
                const modal = document.getElementById("saveOrderModal");
                modal.style.display = "flex";
                modal.orderData = orderData;
            }

            // ì£¼ë¬¸ë‚´ì—­ì„ ì´ë¯¸ì§€ë¡œ ìƒì„±
            function generateOrderImage(orderData) {
                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");

                canvas.width = 400;
                canvas.height = 600;

                // ë°°ê²½
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(0, 0, 400, 600);

                // ì œëª©
                ctx.fillStyle = "#333333";
                ctx.font = "bold 24px Arial";
                ctx.textAlign = "center";
                ctx.fillText("ì£¼ë¬¸ ë‚´ì—­", 200, 40);

                // ì£¼ë¬¸ ì •ë³´
                ctx.font = "16px Arial";
                ctx.textAlign = "left";
                let y = 80;

                const items = [
                    `ì£¼ë¬¸ë²ˆí˜¸: ${orderData.orderNumber}`,
                    `ê³ ê°ëª…: ${orderData.customerName}`,
                    `ì—°ë½ì²˜: ${orderData.phone}`,
                    `ìƒí’ˆëª…: ${orderData.product}`,
                    `ìˆ˜ëŸ‰: ${orderData.quantity}ê°œ`,
                    `ì£¼ë¬¸ ìœ í˜•: ${orderData.orderType}`,
                    `ì£¼ë¬¸ ì‹œê°„: ${new Date(orderData.createdAt).toLocaleString(
                        "ko-KR"
                    )}`,
                    `ì…ê¸ˆê³„ì¢Œ: 0000-0000-0000-0000 (0000ì…€ëŸ¬)`,
                ];

                if (orderData.address) {
                    items.push(
                        `ì£¼ì†Œ: ${orderData.address} ${
                            orderData.detailAddress || ""
                        }`
                    );
                }
                if (orderData.memo) {
                    items.push(`ë©”ëª¨: ${orderData.memo}`);
                }
                // í™˜ë¶ˆ ê³„ì¢Œì •ë³´ëŠ” 1ì°¨ ë²„ì „ì—ì„œ ì œì™¸ë¨

                items.forEach((item) => {
                    ctx.fillText(item, 20, y);
                    y += 30;
                });

                return canvas.toDataURL("image/png");
            }

            // ë©”ì‹œì§€ í‘œì‹œ
            function showMessage(text, type) {
                // ê¸°ì¡´ íƒ€ì´ë¨¸ ëª¨ë‘ ì·¨ì†Œ
                if (window.messageTimeout) {
                    clearTimeout(window.messageTimeout);
                    window.messageTimeout = null;
                }
                
                // ì£¼ë¬¸ ì •ë³´ì˜ ê²½ìš° ë‹«ê¸° ë²„íŠ¼ì´ ìˆëŠ” HTMLë¡œ í‘œì‹œ
                if (type === "success" && text.includes("ğŸ“‹ ì£¼ë¬¸ ì •ë³´")) {
                    messageDiv.innerHTML = `
                        <div style="position: relative;">
                            <div style="white-space: pre-line; padding-right: 40px;">${text}</div>
                            <button onclick="closeMessage()" style="
                                position: absolute;
                                top: 8px;
                                right: 8px;
                                background: rgba(0,0,0,0.1);
                                border: none;
                                font-size: 16px;
                                color: #666;
                                cursor: pointer;
                                border-radius: 6px;
                                width: 32px;
                                height: 32px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                transition: all 0.2s;
                                min-width: 32px;
                                min-height: 32px;
                                z-index: 10;
                            " 
                            onmouseover="this.style.background='rgba(0,0,0,0.2)'"
                            onmouseout="this.style.background='rgba(0,0,0,0.1)'"
                            title="ë‹«ê¸°">âœ•</button>
                        </div>
                    `;
                } else {
                    messageDiv.textContent = text;
                }
                
                messageDiv.className = `msg ${type}`;
                messageDiv.style.display = "block";

                // ì£¼ë¬¸ ì •ë³´ì˜ ê²½ìš° ìë™ ë‹«í˜ ì—†ìŒ (X ë²„íŠ¼ìœ¼ë¡œë§Œ ë‹«ê¸°), ì¼ë°˜ ë©”ì‹œì§€ëŠ” 8ì´ˆ
                const isOrderInfo = type === "success" && (text.includes("ğŸ“‹ ì£¼ë¬¸ ì •ë³´") || text.includes("ì£¼ë¬¸ë²ˆí˜¸:"));
                console.log("ë©”ì‹œì§€ íƒ€ì…:", type, "ì£¼ë¬¸ ì •ë³´ ì—¬ë¶€:", isOrderInfo, "í…ìŠ¤íŠ¸:", text.substring(0, 50));
                
                if (!isOrderInfo) {
                    console.log("ì¼ë°˜ ë©”ì‹œì§€ - 8ì´ˆ í›„ ìë™ ë‹«í˜");
                    window.messageTimeout = setTimeout(() => {
                        messageDiv.style.display = "none";
                        window.messageTimeout = null;
                    }, 8000);
                } else {
                    console.log("ì£¼ë¬¸ ì •ë³´ ë©”ì‹œì§€ - ìë™ ë‹«í˜ ì—†ìŒ");
                }
            }

            // ë©”ì‹œì§€ ë‹«ê¸° í•¨ìˆ˜ (ì „ì—­)
            window.closeMessage = function() {
                // íƒ€ì´ë¨¸ ì·¨ì†Œ
                if (window.messageTimeout) {
                    clearTimeout(window.messageTimeout);
                    window.messageTimeout = null;
                }
                messageDiv.style.display = "none";
            };

            // ì—°ë½ì²˜ ìë™ í¬ë§·íŒ…
            const phoneInput = document.getElementById("phone");
            phoneInput.addEventListener("input", function (e) {
                let value = e.target.value.replace(/[^0-9]/g, ""); // ìˆ«ìë§Œ ì¶”ì¶œ

                if (value.length <= 3) {
                    e.target.value = value;
                } else if (value.length <= 7) {
                    e.target.value = value.slice(0, 3) + "-" + value.slice(3);
                } else {
                    e.target.value =
                        value.slice(0, 3) +
                        "-" +
                        value.slice(3, 7) +
                        "-" +
                        value.slice(7, 11);
                }
            });

            // ë°°ì†¡ì¡°íšŒìš© ì „í™”ë²ˆí˜¸ ìë™ í¬ë§·íŒ…
            const searchPhoneInput = document.getElementById("searchPhone");
            if (searchPhoneInput) {
                searchPhoneInput.addEventListener("input", function (e) {
                    let value = e.target.value.replace(/[^0-9]/g, ""); // ìˆ«ìë§Œ ì¶”ì¶œ

                    if (value.length <= 3) {
                        e.target.value = value;
                    } else if (value.length <= 7) {
                        e.target.value = value.slice(0, 3) + "-" + value.slice(3);
                    } else {
                        e.target.value =
                            value.slice(0, 3) +
                            "-" +
                            value.slice(3, 7) +
                            "-" +
                            value.slice(7, 11);
                    }
                });
            }

            // ì£¼ë¬¸ ìœ í˜• ë³€ê²½ ì‹œ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€ (ì„±ëŠ¥ ìµœì í™”)
            const orderTypeRadios = document.querySelectorAll(
                'input[name="orderType"]'
            );
            const existingOrderField =
                document.getElementById("existingOrderField");
            // ì£¼ë¬¸ë²ˆí˜¸ ì…ë ¥ í•„ë“œëŠ” ì œê±°ë¨ - ì…ê¸ˆìëª…+ì „í™”ë²ˆí˜¸ë¡œë§Œ ì¡°íšŒ

            // ========================================
            // 1ì°¨ ë²„ì „ ê¸°ëŠ¥ ì œí•œ
            // ========================================
            // - êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ê¸°ëŠ¥ ì œì™¸
            // - ì‹ ê·œì£¼ë¬¸, ë°°ì†¡ì¡°íšŒë§Œ ì§€ì›
            // - checkOrderStatusForClaim í•¨ìˆ˜ ì œê±°ë¨

            // í•„ë“œ DOM ì°¸ì¡°
            const customerNameField = document.querySelector(
                ".field:nth-child(3)"
            ); // ê³ ê°ëª…
            const phoneField = document.querySelector(".field:nth-child(4)"); // ì—°ë½ì²˜
            const zipcodeField = document.querySelector(".field:nth-child(7)"); // ìš°í¸ë²ˆí˜¸
            const addressField = document.querySelector(".field:nth-child(8)"); // ì£¼ì†Œ
            const detailAddressField = document.querySelector(
                ".field:nth-child(9)"
            ); // ìƒì„¸ì£¼ì†Œ
            const memoField = document.querySelector(".field:nth-child(10)"); // ìš”ì²­ì‚¬í•­
            // í™˜ë¶ˆ ê³„ì¢Œì •ë³´ í•„ë“œëŠ” 1ì°¨ ë²„ì „ì—ì„œ ì œì™¸ë¨

            // ìƒí’ˆ/ìˆ˜ëŸ‰ í•„ë“œ DOM
            const productField = document
                .getElementById("product")
                ?.closest(".field");
            const quantityField = document
                .getElementById("quantity")
                ?.closest(".field");

            // ë¼ë””ì˜¤ ì „í™˜ ì‹œ ê³µí†µ ì…ë ¥ê°’ ì´ˆê¸°í™” (ì´ë¯¸ ê¸°ì…ëœ ê°’ìœ¼ë¡œ ì¸í•´ í¼ì´ ì•ˆ ë°”ë€ŒëŠ” í˜„ìƒ ë°©ì§€)
            function resetFormValuesOnOrderTypeChange() {
                try {
                    const fieldsToClearOnChange = [
                        "customerName",
                        "phone",
                        "zipcode",
                        "address",
                        "detailAddress",
                        "memo",
                        // "refundAccount", // 1ì°¨ ë²„ì „ì—ì„œ ì œì™¸ë¨
                        "product",
                        "quantity",
                        "searchCustomerName",
                        "searchPhone"
                    ];
                    fieldsToClearOnChange.forEach((fieldId) => {
                        const el = document.getElementById(fieldId);
                        if (el && typeof el.value === "string") el.value = "";
                    });
                } catch (_) {
                    // no-op
                }
            }

            // ìƒë‹¨ í† ìŠ¤íŠ¸ ì•ˆë‚´
            function showInlineNotice(message, durationMs = 2200) {
                let toast = document.getElementById("inlineToastNotice");
                if (!toast) {
                    toast = document.createElement("div");
                    toast.id = "inlineToastNotice";
                    toast.style.position = "fixed";
                    toast.style.top = "12px";
                    toast.style.left = "50%";
                    toast.style.transform = "translateX(-50%)";
                    toast.style.zIndex = "9999";
                    toast.style.maxWidth = "95%";
                    toast.style.minWidth = "280px";
                    toast.style.background = "#212529";
                    toast.style.color = "#fff";
                    toast.style.padding = "12px 16px";
                    toast.style.borderRadius = "8px";
                    toast.style.boxShadow = "0 4px 12px rgba(0,0,0,0.2)";
                    toast.style.fontSize = "14px";
                    toast.style.lineHeight = "1.5";
                    toast.style.whiteSpace = "pre-line";
                    toast.style.opacity = "0";
                    toast.style.transition = "opacity .2s ease";
                    document.body.appendChild(toast);
                }
                toast.textContent = message;
                requestAnimationFrame(() => {
                    toast.style.opacity = "1";
                });
                clearTimeout(window.__inlineToastTimer);
                window.__inlineToastTimer = setTimeout(() => {
                    toast.style.opacity = "0";
                }, durationMs);
            }

            orderTypeRadios.forEach((radio) => {
                radio.addEventListener("change", async function () {
                    // ì „í™˜ ì‹œì ì— ì…ë ¥ê°’ ì´ˆê¸°í™” (ê¸°ì…ëœ ê°’ìœ¼ë¡œ ì¸í•´ í¼ì´ ì•ˆ ë°”ë€ŒëŠ” ê²½ìš° ë°©ì§€)
                    resetFormValuesOnOrderTypeChange();
                    const memoLabel =
                        document.querySelector('label[for="memo"]');
                    const memoInput = document.getElementById("memo");
                    const customerNameInput =
                        document.getElementById("customerName");
                    const phoneInputEl = document.getElementById("phone");
                    const productInput = document.getElementById("product");
                    const quantityInput = document.getElementById("quantity");
                    const submitBtn = document.getElementById("btnSubmit");

                    // ì²˜ë¦¬ ì œí•œ ì•ˆë‚´ ìˆ¨ê¹€
                    const processingLimits =
                        document.getElementById("processingLimits");


                    if (this.value === "ë°°ì†¡ì¡°íšŒ") {
                        // ë°°ì†¡ì¡°íšŒ ëª¨ë“œ
                        existingOrderField.style.display = "block";

                        // ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ ìˆ¨ê¹€
                        try {
                            const loadBtn = document.getElementById("btnLoadExistingOrder");
                            if (loadBtn) loadBtn.style.display = "none";
                        } catch (_) {}

                        // ë‹¤ë¥¸ í•„ë“œë“¤ ìˆ¨ê¹€
                        customerNameField.style.display = "none";
                        phoneField.style.display = "none";
                        zipcodeField.style.display = "none";
                        addressField.style.display = "none";
                        detailAddressField.style.display = "none";
                        memoField.style.display = "none";
                        // refundAccountFieldëŠ” 1ì°¨ ë²„ì „ì—ì„œ ì œì™¸ë¨
                        if (productField) productField.style.display = "none";
                        if (quantityField) quantityField.style.display = "none";

                        // í•„ìˆ˜ í•´ì œ
                        if (customerNameInput) customerNameInput.required = false;
                        if (phoneInputEl) phoneInputEl.required = false;
                        if (productInput) productInput.required = false;
                        if (quantityInput) quantityInput.required = false;

                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.textContent = "ğŸ” ë°°ì†¡ì¡°íšŒí•˜ê¸°";
                        }
                        showInlineNotice("ë°°ì†¡ì¡°íšŒ ëª¨ë“œì…ë‹ˆë‹¤.\nì…ê¸ˆìëª…ê³¼ ì „í™”ë²ˆí˜¸ë¡œ ì¡°íšŒí•˜ì„¸ìš”.", 4000);
                    } else {
                        // ì‹ ê·œì£¼ë¬¸ ì‹œ
                        existingOrderField.style.display = "none";

                        // ì²˜ë¦¬ ì œí•œ ì•ˆë‚´ ìˆ¨ê¹€
                        processingLimits.style.display = "none";

                        // ëª¨ë“  í•„ë“œ í‘œì‹œ
                        customerNameField.style.display = "block";
                        phoneField.style.display = "block";
                        zipcodeField.style.display = "block";
                        addressField.style.display = "block";
                        detailAddressField.style.display = "block";
                        memoField.style.display = "block";

                        // í™˜ë¶ˆ ê³„ì¢Œì •ë³´ í•„ë“œëŠ” 1ì°¨ ë²„ì „ì—ì„œ ì œì™¸ë¨

                        if (productField) productField.style.display = "block";
                        if (quantityField)
                            quantityField.style.display = "block";
                        // í•„ìˆ˜ ë³µì›
                        if (customerNameInput)
                            customerNameInput.required = true;
                        if (phoneInputEl) phoneInputEl.required = true;
                        if (productInput) productInput.required = true;
                        if (quantityInput) quantityInput.required = true;

                        // ë¼ë²¨ê³¼ í”Œë ˆì´ìŠ¤í™€ë” ë³€ê²½
                        memoLabel.textContent = "ë°°ì†¡ë©”ì„¸ì§€";
                        memoInput.placeholder =
                            "ë°°ì†¡ ê´€ë ¨ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”";
                        showInlineNotice("ì‹ ê·œì£¼ë¬¸ ëª¨ë“œì…ë‹ˆë‹¤. \nê³ ê° ì •ë³´ì™€ ìƒí’ˆ ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.textContent = "ğŸ“¦ ì£¼ë¬¸ ì ‘ìˆ˜í•˜ê¸°";
                        }
                    }
                });
            });

            // ì£¼ë¬¸ë²ˆí˜¸ ì¡°íšŒ ê¸°ëŠ¥ì€ ì œê±°ë¨ - ì…ê¸ˆìëª…+ì „í™”ë²ˆí˜¸ë¡œë§Œ ì¡°íšŒ

            // ì£¼ë¬¸ë²ˆí˜¸ ì…ë ¥ í•„ë“œëŠ” ì œê±°ë¨ - ì…ê¸ˆìëª…+ì „í™”ë²ˆí˜¸ë¡œë§Œ ì¡°íšŒ

            // ì…ê¸ˆìëª…+ì „í™”ë²ˆí˜¸ë¡œ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜
            async function searchOrderByNameAndPhone(customerName, phone) {
                try {
                    // ì½ê¸° ì „ì— ìµëª… ì¸ì¦ ë³´ì¥ ì‹œë„
                    try {
                        if (!auth.currentUser) {
                            await signInAnonymously(auth);
                        }
                    } catch (_) {}

                    const ordersRef = ref(database, "orders");
                    const snapshot = await get(ordersRef);
                    const data = snapshot.val();

                    if (!data) return null;

                    // ëª¨ë“  ì›”ë³„ í´ë”ì—ì„œ ì£¼ë¬¸ ê²€ìƒ‰
                    let allOrders = [];
                    for (const [yearMonth, monthOrders] of Object.entries(data)) {
                        if (monthOrders && typeof monthOrders === "object") {
                            const monthOrderEntries = Object.entries(monthOrders);
                            allOrders = allOrders.concat(monthOrderEntries);
                        }
                    }

                    // ì…ê¸ˆìëª…ê³¼ ì „í™”ë²ˆí˜¸ë¡œ ê²€ìƒ‰
                    const normalizedName = customerName.trim().toLowerCase();
                    const normalizedPhone = normalizePhone(phone);

                    const matchingOrders = allOrders.filter(([id, order]) => {
                        const orderName = (order.customerName || "").trim().toLowerCase();
                        const orderPhone = normalizePhone(order.phone || "");
                        
                        return orderName === normalizedName && orderPhone === normalizedPhone;
                    });

                    return matchingOrders.length > 0 ? matchingOrders : null;
                    } catch (error) {
                    console.error("ì…ê¸ˆìëª…+ì „í™”ë²ˆí˜¸ ì¡°íšŒ ì˜¤ë¥˜:", error);
                    return null;
                }
            }

            // ì…ê¸ˆìëª…+ì „í™”ë²ˆí˜¸ ì¡°íšŒ ë²„íŠ¼ ì´ë²¤íŠ¸
            const btnSearchByNamePhone = document.getElementById("btnSearchByNamePhone");
            if (btnSearchByNamePhone) {
                btnSearchByNamePhone.addEventListener("click", async function () {
                    const customerName = document.getElementById("searchCustomerName").value.trim();
                    const phone = document.getElementById("searchPhone").value.trim();

                    if (!customerName || !phone) {
                        showMessage("âŒ ì…ê¸ˆìëª…ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
                        return;
                    }

                    try {
                        const matchingOrders = await searchOrderByNameAndPhone(customerName, phone);
                        
                        if (matchingOrders && matchingOrders.length > 0) {
                            if (matchingOrders.length === 1) {
                                // ë‹¨ì¼ ì£¼ë¬¸ì¸ ê²½ìš° ë°”ë¡œ í‘œì‹œ
                                const [id, order] = matchingOrders[0];
                                displayOrderInfo(order);
                            } else {
                                // ì—¬ëŸ¬ ì£¼ë¬¸ì¸ ê²½ìš° ëª©ë¡ í‘œì‹œ
                                showMultipleOrdersModal(matchingOrders);
                            }
                        } else {
                            showMessage("âŒ í•´ë‹¹ ì •ë³´ë¡œ ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
                        }
                    } catch (error) {
                        console.error("ì¡°íšŒ ì˜¤ë¥˜:", error);
                        showMessage("âŒ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
                    }
                });
            }

            // ì£¼ë¬¸ ì •ë³´ í‘œì‹œ í•¨ìˆ˜ (ëª¨ë°”ì¼ ìµœì í™”)
            function displayOrderInfo(order) {
                console.log("í‘œì‹œí•  ì£¼ë¬¸ ë°ì´í„°:", order); // ë””ë²„ê¹…ìš©
                
                const statusText = order.status === "ë°°ì†¡ì™„ë£Œ" ? "âœ… ë°°ì†¡ì™„ë£Œ" : 
                                 order.status === "ë°°ì†¡ì¤‘" ? "ğŸšš ë°°ì†¡ì¤‘" : 
                                 order.status === "êµí™˜ìš”ì²­" ? "ğŸ”„ êµí™˜ìš”ì²­" :
                                 order.status === "ë°˜í’ˆìš”ì²­" ? "â†©ï¸ ë°˜í’ˆìš”ì²­" :
                                 "ğŸ“¦ ì ‘ìˆ˜ë¨";
                
                // ëª¨ë°”ì¼ì—ì„œ ê°€ë…ì„±ì„ ìœ„í•´ êµ¬ì¡°í™”ëœ ì •ë³´ ìƒì„±
                let infoText = `ğŸ“‹ ì£¼ë¬¸ ì •ë³´\n`;
                infoText += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
                infoText += `${statusText}\n\n`;
                
                infoText += `ğŸ“ ê¸°ë³¸ ì •ë³´\n`;
                infoText += `ì£¼ë¬¸ë²ˆí˜¸: ${order.orderNumber}\n`;
                infoText += `ê³ ê°ëª…: ${order.customerName}\n`;
                infoText += `ì—°ë½ì²˜: ${order.phone}\n\n`;
                
                // ìƒí’ˆ ì •ë³´ ì¶”ê°€
                if (order.product) {
                    infoText += `ğŸ›ï¸ ìƒí’ˆ ì •ë³´\n`;
                    infoText += `ìƒí’ˆëª…: ${order.product}`;
                    if (order.quantity) {
                        infoText += `\nìˆ˜ëŸ‰: ${order.quantity}ê°œ`;
                    }
                    infoText += `\n\n`;
                }
                
                // ì£¼ì†Œ ì •ë³´ ì¶”ê°€
                if (order.address) {
                    infoText += `ğŸ“ ë°°ì†¡ ì£¼ì†Œ\n`;
                    infoText += `${order.address}\n\n`;
                }
                
                // íƒë°°ì‚¬ì™€ ì†¡ì¥ë²ˆí˜¸ ì •ë³´ ì¶”ê°€
                infoText += `ğŸšš ë°°ì†¡ ì •ë³´\n`;
                if (order.courier || order.invoiceNumber) {
                    infoText += `íƒë°°ì‚¬: ${order.courier || "ë¯¸ë“±ë¡"}\n`;
                    infoText += `ì†¡ì¥ë²ˆí˜¸: ${order.invoiceNumber || "ë¯¸ë“±ë¡"}`;
                } else {
                    infoText += `íƒë°°ì‚¬: ë¯¸ë“±ë¡\n`;
                    infoText += `ì†¡ì¥ë²ˆí˜¸: ë¯¸ë“±ë¡`;
                }
                infoText += `\n\n`;
                
                // ì£¼ë¬¸ì¼ì‹œ ì¶”ê°€
                if (order.createdAt) {
                    const orderDate = new Date(order.createdAt);
                    infoText += `ğŸ“… ì£¼ë¬¸ì¼ì‹œ\n`;
                    infoText += `${orderDate.toLocaleString()}`;
                }
                
                showMessage(infoText, "success");
            }

            // ì „ì—­ ë³€ìˆ˜ë¡œ í˜„ì¬ ëª¨ë‹¬ì˜ ì£¼ë¬¸ ë°ì´í„° ì €ì¥
            let currentModalOrders = null;

            // ì—¬ëŸ¬ ì£¼ë¬¸ì´ ìˆì„ ë•Œ ëª¨ë‹¬ í‘œì‹œ
            function showMultipleOrdersModal(orders) {
                // ì „ì—­ ë³€ìˆ˜ì— ì£¼ë¬¸ ë°ì´í„° ì €ì¥
                currentModalOrders = orders;
                // ì—¬ëŸ¬ ì£¼ë¬¸ ëª©ë¡ì„ í‘œì‹œí•˜ëŠ” ëª¨ë‹¬ ìƒì„±
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    padding: 16px;
                    box-sizing: border-box;
                `;
                
                modal.innerHTML = `
                    <div style="
                        background: white;
                        padding: 20px;
                        border-radius: 12px;
                        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
                        max-width: 500px;
                        width: 100%;
                        max-height: 80vh;
                        overflow-y: auto;
                        font-size: 14px;
                        line-height: 1.5;
                    ">
                        <h3 style="margin: 0 0 16px 0;">ğŸ” ${orders.length}ê°œì˜ ì£¼ë¬¸ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤</h3>
                        <div style="margin-bottom: 16px; font-size: 14px; color: #666;">
                            ì•„ë˜ ì£¼ë¬¸ ì¤‘ì—ì„œ í™•ì¸í•˜ê³  ì‹¶ì€ ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”:
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${orders.map(([id, order], index) => `
                                <div style="
                                    border: 1px solid #ddd;
                                    border-radius: 8px;
                                    padding: 16px;
                                    margin-bottom: 12px;
                                    cursor: pointer;
                                    transition: all 0.2s;
                                    background: white;
                                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                " 
                                onmouseover="this.style.backgroundColor='#f8f9fa'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'"
                                onmouseout="this.style.backgroundColor='white'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'"
                                onclick="selectOrderFromModal('${id}', '${order.orderNumber}')">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div style="flex: 1; min-width: 0;">
                                            <div style="font-weight: 600; font-size: 15px; color: #333; margin-bottom: 6px;">
                                                ${order.orderNumber}
                                            </div>
                                            <div style="font-size: 13px; color: #666; margin-bottom: 4px; line-height: 1.4;">
                                                ${order.product} (${order.quantity}ê°œ)
                                            </div>
                                            <div style="font-size: 12px; color: #888; line-height: 1.3;">
                                                ${order.customerName} | ${order.phone}
                                            </div>
                                        </div>
                                        <div style="text-align: right; flex-shrink: 0; margin-left: 12px;">
                                            <div style="
                                                padding: 6px 10px;
                                                border-radius: 16px;
                                                font-size: 12px;
                                                font-weight: 600;
                                                color: white;
                                                background-color: ${getStatusColor(order.status)};
                                                display: inline-block;
                                                margin-bottom: 6px;
                                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                            ">
                                                ${order.status}
                                            </div>
                                            <div style="font-size: 11px; color: #888; line-height: 1.2;">
                                                ${new Date(order.createdAt).toLocaleDateString()}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="text-align: right; margin-top: 16px;">
                            <button onclick="closeMultipleOrdersModal()" style="
                                padding: 10px 20px;
                                border: 1px solid #ddd;
                                border-radius: 6px;
                                background: #f8f9fa;
                                color: #333;
                                font-size: 14px;
                                font-weight: 500;
                                cursor: pointer;
                                transition: all 0.2s;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                            " 
                            onmouseover="this.style.background='#e9ecef'; this.style.borderColor='#adb5bd'"
                            onmouseout="this.style.background='#f8f9fa'; this.style.borderColor='#ddd'"
                            >ë‹«ê¸°</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeMultipleOrdersModal();
                    }
                });
            }

            // ìƒíƒœë³„ ìƒ‰ìƒ ë°˜í™˜
            function getStatusColor(status) {
                const colors = {
                    'ì ‘ìˆ˜': '#ffc107',
                    'ë°°ì†¡ì¤‘': '#17a2b8',
                    'ë°°ì†¡ì™„ë£Œ': '#28a745',
                    'êµí™˜ìš”ì²­': '#fd7e14',
                    'ë°˜í’ˆìš”ì²­': '#dc3545',
                    'ì·¨ì†Œ': '#6c757d'
                };
                return colors[status] || '#6c757d';
            }

            // ëª¨ë‹¬ì—ì„œ ì£¼ë¬¸ ì„ íƒ (ì „ì—­ í•¨ìˆ˜)
            window.selectOrderFromModal = function(orderId, orderNumber) {
                // ì„ íƒëœ ì£¼ë¬¸ì˜ ìƒì„¸ ì •ë³´ë¥¼ í‘œì‹œ
                try {
                    console.log("ì„ íƒëœ ì£¼ë¬¸ ID:", orderId, "ì£¼ë¬¸ë²ˆí˜¸:", orderNumber);
                    console.log("í˜„ì¬ ëª¨ë‹¬ì˜ ì£¼ë¬¸ ë°ì´í„°:", currentModalOrders);
                    
                    // ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ
                    showMessage("ğŸ”„ ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...", "info");
                    
                    // ì „ì—­ ë³€ìˆ˜ì—ì„œ ì£¼ë¬¸ ì°¾ê¸°
                    if (currentModalOrders) {
                        const foundOrder = currentModalOrders.find(([id, order]) => id === orderId);
                        if (foundOrder) {
                            const [id, order] = foundOrder;
                            console.log("ì°¾ì€ ì£¼ë¬¸ ë°ì´í„°:", order);
                            displayOrderInfo(order);
                            closeMultipleOrdersModal();
                            return;
                        }
                    }
                    
                    // ì „ì—­ ë³€ìˆ˜ì—ì„œ ì°¾ì§€ ëª»í•œ ê²½ìš° Firebaseì—ì„œ ê²€ìƒ‰
                    console.log("ì „ì—­ ë³€ìˆ˜ì—ì„œ ì°¾ì§€ ëª»í•¨. Firebaseì—ì„œ ê²€ìƒ‰...");
                    const ordersRef = ref(database, "orders");
                    get(ordersRef).then((snapshot) => {
                        const allOrders = snapshot.val();
                        if (!allOrders) {
                            showMessage("âŒ ì£¼ë¬¸ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
                            closeMultipleOrdersModal();
                            return;
                        }
                        
                        console.log("ì „ì²´ ì£¼ë¬¸ ë°ì´í„° êµ¬ì¡°:", allOrders);
                        
                        // ëª¨ë“  ì£¼ë¬¸ì„ í‰ë©´í™”í•˜ì—¬ ê²€ìƒ‰
                        const allOrdersList = [];
                        Object.keys(allOrders).forEach(year => {
                            if (allOrders[year] && typeof allOrders[year] === 'object') {
                                Object.keys(allOrders[year]).forEach(month => {
                                    if (allOrders[year][month] && typeof allOrders[year][month] === 'object') {
                                        Object.keys(allOrders[year][month]).forEach(id => {
                                            if (allOrders[year][month][id] && allOrders[year][month][id].orderNumber) {
                                                allOrdersList.push([id, allOrders[year][month][id]]);
                                            }
                                        });
                                    }
                                });
                            }
                        });
                        
                        console.log("í‰ë©´í™”ëœ ì£¼ë¬¸ ëª©ë¡:", allOrdersList);
                        console.log("ì°¾ê³  ìˆëŠ” ID:", orderId);
                        
                        // í•´ë‹¹ IDì˜ ì£¼ë¬¸ ì°¾ê¸°
                        const foundOrder = allOrdersList.find(([id, order]) => id === orderId);
                        if (foundOrder) {
                            const [id, order] = foundOrder;
                            console.log("ì°¾ì€ ì£¼ë¬¸ ë°ì´í„°:", order);
                            displayOrderInfo(order);
                            closeMultipleOrdersModal();
                        } else {
                            console.log("ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ. ì‚¬ìš© ê°€ëŠ¥í•œ IDë“¤:", allOrdersList.map(([id, order]) => id));
                            showMessage("âŒ ì„ íƒëœ ì£¼ë¬¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
                            closeMultipleOrdersModal();
                        }
                    }).catch((error) => {
                        console.error("ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ ì˜¤ë¥˜:", error);
                        showMessage("âŒ ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
                        closeMultipleOrdersModal();
                    });
                } catch (error) {
                    console.error("ì£¼ë¬¸ ì„ íƒ ì˜¤ë¥˜:", error);
                    showMessage("âŒ ì£¼ë¬¸ ì„ íƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
                    closeMultipleOrdersModal();
                }
            };

            // ì—¬ëŸ¬ ì£¼ë¬¸ ëª¨ë‹¬ ë‹«ê¸° (ì „ì—­ í•¨ìˆ˜)
            window.closeMultipleOrdersModal = function() {
                const modal = document.querySelector('[style*="z-index: 10000"]');
                if (modal) {
                    modal.remove();
                }
                // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
                currentModalOrders = null;
            };

            // ì£¼ì†Œ ì°¾ê¸° ê¸°ëŠ¥ (Daum ìš°í¸ë²ˆí˜¸ API)
            document
                .getElementById("btnFindAddr")
                .addEventListener("click", function () {
                    new daum.Postcode({
                        oncomplete: function (data) {
                            document.getElementById("zipcode").value =
                                data.zonecode;
                            document.getElementById("address").value =
                                data.address;
                            document.getElementById("detailAddress").focus();
                        },
                    }).open();
                });

            // ì£¼ë¬¸ í™•ì¸ ëª¨ë‹¬ ì´ë²¤íŠ¸
            document
                .getElementById("confirmOrder")
                .addEventListener("click", async function () {
                    const modal = document.getElementById("orderConfirmModal");
                    const orderData = modal.orderData;

                    try {
                        // Firebaseì— ì£¼ë¬¸ ì €ì¥ (ì›”ë³„ í´ë” êµ¬ì¡°)
                        const now = new Date();
                        const yearMonth = `${now.getFullYear()}-${String(
                            now.getMonth() + 1
                        ).padStart(2, "0")}`;
                        const ordersRef = ref(database, `orders/${yearMonth}`);
                        await push(ordersRef, orderData);

                        // ëª¨ë‹¬ ë‹«ê¸°
                        modal.style.display = "none";

                        // ì£¼ë¬¸ë‚´ì—­ ì €ì¥ ëª¨ë‹¬ í‘œì‹œ
                        showSaveOrderModal(orderData);
                    } catch (error) {
                        console.error("ì£¼ë¬¸ ì €ì¥ ì˜¤ë¥˜:", error);
                        showMessage(
                            "âŒ ì£¼ë¬¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
                            "error"
                        );
                    }
                });

            // ë°°ì†¡ì¡°íšŒ ì²˜ë¦¬
            document
                .getElementById("btnSubmit")
                .addEventListener("click", async function (e) {
                    const orderType = document.querySelector(
                        'input[name="orderType"]:checked'
                    ).value;

                    if (orderType === "ë°°ì†¡ì¡°íšŒ") {
                        e.preventDefault(); // í¼ ì œì¶œ ë°©ì§€

                        // 1ì°¨ ë²„ì „: ì…ê¸ˆìëª…+ì „í™”ë²ˆí˜¸ë¡œë§Œ ì¡°íšŒ
                        const customerName = document.getElementById("searchCustomerName").value.trim();
                        const phone = document.getElementById("searchPhone").value.trim();
                        
                        if (!customerName || !phone) {
                            showMessage("âŒ ì…ê¸ˆìëª…ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
                                    return;
                                }

                        try {
                            const matchingOrders = await searchOrderByNameAndPhone(customerName, phone);
                            if (matchingOrders) {
                                if (matchingOrders.length === 1) {
                                    // ë‹¨ì¼ ì£¼ë¬¸ì¸ ê²½ìš° ë°”ë¡œ í‘œì‹œ
                                    const [id, order] = matchingOrders[0];
                                    displayOrderInfo(order);
                                } else {
                                    // ì—¬ëŸ¬ ì£¼ë¬¸ì¸ ê²½ìš° ëª©ë¡ í‘œì‹œ
                                    showMultipleOrdersModal(matchingOrders);
                                }
                            } else {
                                showMessage("âŒ í•´ë‹¹ ì •ë³´ë¡œ ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
                            }
                        } catch (error) {
                            console.error("ë°°ì†¡ì¡°íšŒ ì˜¤ë¥˜:", error);
                            showMessage("âŒ ë°°ì†¡ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
                        }
                        return;
                    }

                    // ë‹¤ë¥¸ ì£¼ë¬¸ ìœ í˜•ì€ ê¸°ì¡´ ë¡œì§ìœ¼ë¡œ ì§„í–‰
                    showOrderConfirmModal();
                });

            document
                .getElementById("cancelOrder")
                .addEventListener("click", function () {
                    document.getElementById("orderConfirmModal").style.display =
                        "none";
                });

            // ì£¼ë¬¸ë‚´ì—­ ì €ì¥ ëª¨ë‹¬ ì´ë²¤íŠ¸
            document
                .getElementById("saveToAlbum")
                .addEventListener("click", function () {
                    const modal = document.getElementById("saveOrderModal");
                    const orderData = modal.orderData;

                    try {
                        // ì£¼ë¬¸ë‚´ì—­ì„ ì´ë¯¸ì§€ë¡œ ìƒì„±
                        const imageData = generateOrderImage(orderData);

                        // PC/ëª¨ë°”ì¼ í™˜ê²½ë³„ ì´ë¯¸ì§€ ì €ì¥ í•¨ìˆ˜
                        async function saveImageToAlbum() {
                            try {
                                // Canvasë¥¼ Blobìœ¼ë¡œ ë³€í™˜
                                const canvas = document.createElement("canvas");
                                const ctx = canvas.getContext("2d");
                                const img = new Image();

                                img.onload = function () {
                                    canvas.width = img.width;
                                    canvas.height = img.height;
                                    ctx.drawImage(img, 0, 0);

                                    canvas.toBlob(async function (blob) {
                                        try {
                                            // PC í™˜ê²½ ê°ì§€ (ëª¨ë°”ì¼ì´ ì•„ë‹Œ ê²½ìš°)
                                            const isPC =
                                                !/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
                                                    navigator.userAgent
                                                );

                                            if (isPC) {
                                                // PC í™˜ê²½: ë°”ë¡œ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥
                                                const link =
                                                    document.createElement("a");
                                                link.download = `ì£¼ë¬¸ë‚´ì—­_${orderData.orderNumber}.png`;
                                                link.href = imageData;
                                                link.click();
                                                showMessage(
                                                    "âœ… ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.",
                                                    "success"
                                                );
                                                return;
                                            }

                                            // ëª¨ë°”ì¼ í™˜ê²½: ê¸°ì¡´ ë°©ì‹ ìœ ì§€
                                            // ëª¨ë°”ì¼ì—ì„œ ê³µìœ  API ì‚¬ìš© (iOS/Android)
                                            if (
                                                navigator.share &&
                                                navigator.canShare
                                            ) {
                                                const file = new File(
                                                    [blob],
                                                    `ì£¼ë¬¸ë‚´ì—­_${orderData.orderNumber}.png`,
                                                    { type: "image/png" }
                                                );

                                                if (
                                                    navigator.canShare({
                                                        files: [file],
                                                    })
                                                ) {
                                                    await navigator.share({
                                                        files: [file],
                                                        title: "ì£¼ë¬¸ë‚´ì—­",
                                                        text: "ì£¼ë¬¸ë‚´ì—­ ì´ë¯¸ì§€",
                                                    });
                                                    showMessage(
                                                        "âœ… ì´ë¯¸ì§€ë¥¼ ê³µìœ í–ˆìŠµë‹ˆë‹¤. ì•¨ë²”ì— ì €ì¥í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì•±ìœ¼ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                                                        "success"
                                                    );
                                                    return;
                                                }
                                            }

                                            // ê³µìœ  APIê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” ê²½ìš° ëŒ€ì²´ ë°©ë²•
                                            if (
                                                /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
                                                    navigator.userAgent
                                                )
                                            ) {
                                                // ëª¨ë°”ì¼ í™˜ê²½ - ìƒˆ ì°½ì—ì„œ ì´ë¯¸ì§€ ì—´ê¸°
                                                const url =
                                                    URL.createObjectURL(blob);
                                                const newWindow =
                                                    window.open(url);
                                                if (newWindow) {
                                                    showMessage(
                                                        "âœ… ì´ë¯¸ì§€ê°€ ìƒˆ ì°½ì—ì„œ ì—´ë ¸ìŠµë‹ˆë‹¤. ê¸¸ê²Œ ëˆŒëŸ¬ì„œ 'ì´ë¯¸ì§€ ì €ì¥'ì„ ì„ íƒí•˜ì„¸ìš”.",
                                                        "success"
                                                    );
                                                } else {
                                                    // íŒì—… ì°¨ë‹¨ëœ ê²½ìš° ë‹¤ìš´ë¡œë“œ
                                                    const link =
                                                        document.createElement(
                                                            "a"
                                                        );
                                                    link.href = url;
                                                    link.download = `ì£¼ë¬¸ë‚´ì—­_${orderData.orderNumber}.png`;
                                                    link.click();
                                                    showMessage(
                                                        "âœ… ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œ í´ë”ì—ì„œ í™•ì¸í•˜ì„¸ìš”.",
                                                        "success"
                                                    );
                                                }
                                                setTimeout(
                                                    () =>
                                                        URL.revokeObjectURL(
                                                            url
                                                        ),
                                                    1000
                                                );
                                            }
                                        } catch (shareError) {
                                            console.error(
                                                "ê³µìœ  ì˜¤ë¥˜:",
                                                shareError
                                            );
                                            // ê³µìœ  ì‹¤íŒ¨ ì‹œ ì¼ë°˜ ë‹¤ìš´ë¡œë“œ
                                            const link =
                                                document.createElement("a");
                                            link.download = `ì£¼ë¬¸ë‚´ì—­_${orderData.orderNumber}.png`;
                                            link.href = imageData;
                                            link.click();
                                            showMessage(
                                                "âœ… ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.",
                                                "success"
                                            );
                                        }
                                    }, "image/png");
                                };

                                img.src = imageData;
                            } catch (error) {
                                console.error("ì•¨ë²” ì €ì¥ ì˜¤ë¥˜:", error);
                                // ëŒ€ì²´ ë°©ë²•: ì¼ë°˜ ë‹¤ìš´ë¡œë“œ
                                const link = document.createElement("a");
                                link.download = `ì£¼ë¬¸ë‚´ì—­_${orderData.orderNumber}.png`;
                                link.href = imageData;
                                link.click();
                                showMessage(
                                    "âœ… ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.",
                                    "success"
                                );
                            }
                        }

                        // ì´ë¯¸ì§€ ì €ì¥ ì‹¤í–‰
                        saveImageToAlbum();

                        // ëª¨ë‹¬ ë‹«ê¸°
                        modal.style.display = "none";

                        // í¼ ì´ˆê¸°í™”
                        orderForm.reset();
                        showMessage(
                            "âœ… ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!",
                            "success"
                        );
                    } catch (error) {
                        console.error("ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:", error);
                        showMessage(
                            "âŒ ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
                            "error"
                        );
                    }
                });

            document
                .getElementById("skipSave")
                .addEventListener("click", function () {
                    const modal = document.getElementById("saveOrderModal");
                    modal.style.display = "none";

                    // í¼ ì´ˆê¸°í™” ë° ì„±ê³µ ë©”ì‹œì§€
                    orderForm.reset();
                    showMessage(
                        "âœ… ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!",
                        "success"
                    );
                });

            // ê´€ë¦¬ì í˜ì´ì§€ ì—´ê¸° (PIN ëŒ€ì‹  ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ)
            btnAdmin.addEventListener("click", function () {
                window.isAdminLoginFlow = true;
                document.getElementById("loginModal").style.display = "flex";
            });

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì£¼ì†Œ API ë¡œë“œ
            window.addEventListener("load", function () {
                if (typeof daum === "undefined") {
                    const script = document.createElement("script");
                    script.src =
                        "//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js";
                    document.head.appendChild(script);
                }
            });

            // Enter í‚¤ë¡œ ë¡œê·¸ì¸
            document
                .getElementById("loginPassword")
                .addEventListener("keypress", function (e) {
                    if (e.key === "Enter") {
                        login();
                    }
                });

            // ë¡œê·¸ì¸ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
            window.closeLoginModal = function () {
                document.getElementById("loginModal").style.display = "none";
                document.getElementById("loginEmail").value = "";
                document.getElementById("loginPassword").value = "";
                document.getElementById("loginError").textContent = "";
            };
        </script>
    </body>
</html>
