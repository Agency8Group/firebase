<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
        />
        <title>0000ì…€ëŸ¬ ì£¼ë¬¸ ìˆ˜ì§‘ í˜ì´ì§€</title>

        <!-- Firebase Authentication SDK -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
            import {
                getAuth,
                signInWithEmailAndPassword,
                onAuthStateChanged,
            } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

            // Firebase ì„¤ì • (config.jsì—ì„œ ë¡œë“œ)
            const firebaseConfig = window.firebaseConfig;

            // Firebase ì´ˆê¸°í™”
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);

            // ì „ì—­ ë³€ìˆ˜ë¡œ authì™€ app ê°ì²´ ì„¤ì •
            window.auth = auth;
            window.app = app;

            // ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€ (indexì—ì„œëŠ” ìë™ ì´ë™í•˜ì§€ ì•ŠìŒ)
            onAuthStateChanged(auth, () => {
                // no-op: ê´€ë¦¬ì ë²„íŠ¼ìœ¼ë¡œ ì‹œì‘í•œ ë¡œê·¸ì¸ íë¦„ì—ì„œë§Œ ì´ë™ ì²˜ë¦¬
            });

            // ë¡œê·¸ì¸ í•¨ìˆ˜
            window.login = async function () {
                const email = document.getElementById("loginEmail").value;
                const password = document.getElementById("loginPassword").value;

                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    document.getElementById("loginError").textContent = "";
                    // ê´€ë¦¬ì ë²„íŠ¼ì—ì„œ ì‹œì‘í•œ ê²½ìš°ì—ë§Œ adminìœ¼ë¡œ ì´ë™
                    if (window.isAdminLoginFlow) {
                        window.open("admin.html", "_blank");
                        window.isAdminLoginFlow = false;
                        document.getElementById("loginModal").style.display =
                            "none";
                    }
                } catch (error) {
                    document.getElementById("loginError").textContent =
                        "ì´ë©”ì¼ ì£¼ì†Œ ë° ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                }
            };
        </script>

        <style>
            *,
            *::before,
            *::after {
                box-sizing: border-box;
            }

            body {
                font-family: Arial, sans-serif;
                margin: 24px;
                line-height: 1.45;
                -webkit-text-size-adjust: 100%;
                background-color: #f8f9fa;
            }

            .wrap {
                max-width: 520px;
                margin: 0 auto;
                background: white;
                padding: 24px;
                border-radius: 12px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            h1 {
                font-size: 20px;
                margin-bottom: 24px;
                text-align: center;
                color: #333;
            }

            .title-row {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 12px;
                margin-bottom: 20px;
            }

            .icon-btn {
                background: #f0f0f0;
                color: #222;
                border: 1px solid #ddd;
                border-radius: 8px;
                padding: 8px 10px;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .icon-btn:hover {
                background: #e8e8e8;
            }

            .field {
                margin: 16px 0;
            }

            label {
                display: block;
                margin-bottom: 6px;
                font-weight: bold;
                color: #333;
            }

            input[type="text"],
            input[type="tel"],
            select {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 16px;
                min-height: 44px;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                transition: border-color 0.2s ease;
            }

            input::placeholder {
                color: #999;
                font-size: 14px;
                line-height: 1.4;
                opacity: 1;
            }

            select option[disabled] {
                color: #999;
                font-style: italic;
            }

            select:invalid {
                color: #999;
            }

            select:valid {
                color: #333;
            }

            #product::placeholder {
                font-size: 12px;
                line-height: 1.2;
                word-break: keep-all;
                white-space: normal;
            }

            input[type="text"]:focus,
            input[type="tel"]:focus,
            select:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
            }

            button {
                padding: 12px 16px;
                border: 0;
                background: #007bff;
                color: #fff;
                border-radius: 6px;
                cursor: pointer;
                font-size: 16px;
                min-height: 48px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
                transition: background-color 0.2s ease;
                -webkit-user-select: none;
                user-select: none;
            }

            button:hover {
                background: #0056b3;
                transform: translateY(-1px);
            }

            button:active {
                background: #004085;
                transform: translateY(0);
            }

            button[disabled] {
                opacity: 0.6;
                cursor: not-allowed;
            }

            #btnSubmit {
                width: 100%;
                background: #28a745;
                margin-top: 20px;
            }

            #btnSubmit:hover {
                background: #1e7e34;
            }

            #btnFindAddr {
                background: #e0e0e0;
                color: #666;
            }

            #btnFindAddr:hover {
                background: #d0d0d0;
            }

            .msg {
                margin-top: 12px;
                font-size: 14px;
                padding: 10px;
                border-radius: 4px;
            }

            .msg.error {
                color: #721c24;
                background-color: #f8d7da;
                border: 1px solid #f5c6cb;
            }

            .msg.success {
                color: #155724;
                background-color: #d4edda;
                border: 1px solid #c3e6cb;
            }

            .addr-row {
                display: flex;
                gap: 8px;
            }

            .addr-row input {
                flex: 1;
            }

            /* Radio Button Styles */
            .radio-group {
                display: flex;
                flex-direction: column;
                gap: 8px;
                flex-wrap: nowrap;
            }

            .radio-row {
                display: flex;
                gap: 12px;
                justify-content: center;
            }

            .radio-item {
                display: flex;
                align-items: center;
                gap: 8px;
                cursor: pointer;
                padding: 8px 12px;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                background: white;
                transition: all 0.2s ease;
                width: 100%;
                justify-content: flex-start;
                min-height: 36px;
            }

            .radio-item:hover {
                border-color: #007bff;
                background: #f8f9ff;
            }

            .radio-item input[type="radio"] {
                display: none;
            }

            .radio-custom {
                width: 14px;
                height: 14px;
                border: 2px solid #ddd;
                border-radius: 50%;
                position: relative;
                transition: all 0.2s ease;
                flex-shrink: 0;
            }

            .radio-item input[type="radio"]:checked + .radio-custom {
                border-color: #007bff;
                background: #007bff;
            }

            .radio-item input[type="radio"]:checked + .radio-custom::after {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 5px;
                height: 5px;
                background: white;
                border-radius: 50%;
            }

            .radio-item input[type="radio"]:checked ~ .radio-label {
                color: #007bff;
                font-weight: 600;
            }

            .radio-label {
                font-size: 13px;
                color: #495057;
                transition: all 0.2s ease;
                font-weight: 500;
            }

            /* SVG Icon Styles */
            .inline-icon {
                width: 18px;
                height: 18px;
                vertical-align: middle;
                margin-right: 6px;
            }

            .status-indicator {
                display: inline-block;
                width: 16px;
                height: 16px;
                border-radius: 50%;
                margin-left: 12px;
                vertical-align: middle;
                border: 2px solid #ddd;
                animation: pulse 2s infinite;
            }

            .status-indicator.connected {
                background-color: #28a745;
                border-color: #28a745;
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
                animation: pulse 2s infinite;
            }

            .status-indicator.disconnected {
                background-color: #dc3545;
                border-color: #dc3545;
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
                }
            }

            .status-indicator.disconnected {
                animation: pulse-disconnected 2s infinite;
            }

            @keyframes pulse-disconnected {
                0% {
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
                }
            }

            @media (max-width: 768px),
                (max-device-width: 768px),
                (orientation: portrait) and (max-width: 1024px) {
                body {
                    margin: 4px;
                    font-size: 15px;
                    -webkit-text-size-adjust: 100%;
                    -webkit-tap-highlight-color: transparent;
                }

                .wrap {
                    padding: 20px 16px;
                    border-radius: 12px;
                    max-width: 100%;
                    box-sizing: border-box;
                    overflow-x: hidden;
                    margin: 8px;
                }

                h1 {
                    font-size: 20px;
                    margin-bottom: 24px;
                    line-height: 1.3;
                }

                .field {
                    margin: 20px 0;
                }

                label {
                    font-size: 15px;
                    margin-bottom: 8px;
                    font-weight: 600;
                    color: #2c3e50;
                }

                input[type="text"],
                input[type="tel"],
                select {
                    font-size: 16px;
                    padding: 16px 14px;
                    min-height: 52px;
                    border-radius: 8px;
                    border: 2px solid #e9ecef;
                    background-color: #fafafa;
                }

                input[type="text"]:focus,
                input[type="tel"]:focus,
                select:focus {
                    border-color: #007bff;
                    background-color: white;
                    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
                }

                .addr-row {
                    flex-direction: column;
                    gap: 12px;
                }

                .radio-group {
                    gap: 8px;
                    flex-wrap: nowrap;
                    width: 100%;
                    overflow: hidden;
                }

                .radio-row {
                    gap: 10px;
                    flex-wrap: wrap;
                    justify-content: center;
                }

                .radio-item {
                    flex: 1;
                    padding: 12px 14px;
                    flex-shrink: 0;
                    border-radius: 8px;
                    min-height: 48px;
                    max-width: calc(50% - 5px);
                    border: 2px solid #e9ecef;
                    background: white;
                    transition: all 0.2s ease;
                }

                .radio-item:hover,
                .radio-item:active {
                    border-color: #007bff;
                    background: #f8f9ff;
                    transform: translateY(-1px);
                }

                .radio-label {
                    font-size: 13px;
                    font-weight: 500;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }

                #btnAdmin {
                    display: none !important;
                }

                .simple-footer {
                    margin-top: 32px;
                    padding: 20px 0;
                }

                /* ëª¨ë°”ì¼ ì „ìš© ì¶”ê°€ ìµœì í™” */
                button {
                    min-height: 56px;
                    font-size: 16px;
                    padding: 16px 20px;
                    border-radius: 8px;
                    font-weight: 600;
                    letter-spacing: 0.5px;
                }

                #btnSubmit {
                    min-height: 60px;
                    font-size: 18px;
                    font-weight: 700;
                    background: linear-gradient(135deg, #28a745, #20c997);
                    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
                    margin-top: 24px;
                }

                #btnSubmit:hover,
                #btnSubmit:active {
                    background: linear-gradient(135deg, #1e7e34, #1a9f7a);
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
                }

                .modal-content {
                    padding: 24px 20px;
                    margin: 20px;
                    width: calc(100% - 40px);
                    max-width: none;
                    border-radius: 16px;
                }

                .modal-buttons {
                    flex-direction: column;
                    gap: 16px;
                }

                .btn-confirm,
                .btn-cancel {
                    min-height: 56px;
                    font-size: 16px;
                    font-weight: 600;
                }

                .order-summary {
                    font-size: 14px;
                    padding: 16px;
                    border-radius: 8px;
                }

                .order-summary-item {
                    margin-bottom: 8px;
                    padding: 4px 0;
                }

                /* ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜í•˜ê¸° ì‰½ê²Œ ê°„ê²© ì¡°ì • */
                .field {
                    margin: 20px 0;
                }

                input[type="text"],
                input[type="tel"],
                select {
                    margin-bottom: 6px;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ë¼ë””ì˜¤ ë²„íŠ¼ í„°ì¹˜ ì˜ì—­ í™•ëŒ€ */
                .radio-item {
                    min-height: 48px;
                    padding: 12px 14px;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ì£¼ì†Œì°¾ê¸° ë²„íŠ¼ ìµœì í™” */
                #btnFindAddr {
                    min-height: 52px;
                    font-size: 15px;
                    padding: 14px 18px;
                    background: linear-gradient(135deg, #6c757d, #5a6268);
                    color: white;
                    border: none;
                    font-weight: 600;
                }

                #btnFindAddr:hover,
                #btnFindAddr:active {
                    background: linear-gradient(135deg, #5a6268, #495057);
                    transform: translateY(-1px);
                }

                /* ëª¨ë°”ì¼ì—ì„œ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ ê°œì„  */
                .msg {
                    margin-top: 16px;
                    padding: 14px 16px;
                    border-radius: 8px;
                    font-size: 15px;
                    font-weight: 500;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ì²˜ë¦¬ ì œí•œ ì•ˆë‚´ ê°œì„  */
                #processingLimits {
                    margin-top: 12px;
                    padding: 12px 16px;
                    background: #fff3cd;
                    border: 1px solid #ffeaa7;
                    border-radius: 8px;
                    font-size: 13px;
                    line-height: 1.5;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ì¸ë¼ì¸ ì•„ì´ì½˜ í¬ê¸° ì¡°ì • */
                .inline-icon {
                    width: 20px;
                    height: 20px;
                    margin-right: 8px;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ìƒíƒœ í‘œì‹œê¸° ê°œì„  */
                .status-indicator {
                    width: 18px;
                    height: 18px;
                    margin-left: 16px;
                }
            }

            /* ëª¨ë°”ì¼ í„°ì¹˜ ìµœì í™” ì¶”ê°€ ìŠ¤íƒ€ì¼ */
            @media (max-width: 768px) {
                /* í„°ì¹˜ ìŠ¤í¬ë¡¤ ìµœì í™” */
                * {
                    -webkit-overflow-scrolling: touch;
                    scroll-behavior: smooth;
                }

                /* ëª¨ë°”ì¼ì—ì„œ í¬ì»¤ìŠ¤ ë§ ì œê±° */
                *:focus {
                    outline: none;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ì„ íƒ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
                ::selection {
                    background: rgba(0, 123, 255, 0.2);
                    color: #2c3e50;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ì…ë ¥ í•„ë“œ ìë™ í™•ëŒ€ ë°©ì§€ */
                input[type="text"],
                input[type="tel"],
                select {
                    font-size: 16px !important;
                    transform: none !important;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ í„°ì¹˜ í”¼ë“œë°± */
                button:active {
                    transform: scale(0.98);
                    transition: transform 0.1s ease;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ë¼ë””ì˜¤ ë²„íŠ¼ í„°ì¹˜ í”¼ë“œë°± */
                .radio-item:active {
                    transform: scale(0.95);
                    transition: transform 0.1s ease;
                }

                /* ëª¨ë°”ì¼ì—ì„œ ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
                ::-webkit-scrollbar {
                    display: none;
                }

                /* ëª¨ë°”ì¼ì—ì„œ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ (ë²„íŠ¼ ì œì™¸) */
                .wrap {
                    -webkit-user-select: none;
                    -moz-user-select: none;
                    -ms-user-select: none;
                    user-select: none;
                }

                input,
                textarea,
                select {
                    -webkit-user-select: text;
                    -moz-user-select: text;
                    -ms-user-select: text;
                    user-select: text;
                }
            }

            /* Simple Footer */
            .simple-footer {
                margin-top: 40px;
                padding: 20px 0;
                text-align: center;
                border-top: 1px solid #e9ecef;
            }

            .simple-footer a {
                color: #6c757d;
                text-decoration: none;
                font-size: 12px;
                transition: color 0.2s ease;
            }

            .simple-footer a:hover {
                color: #495057;
            }

            /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
            .modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            }

            .modal-content {
                background: white;
                padding: 24px;
                border-radius: 12px;
                max-width: 90%;
                width: 400px;
                max-height: 80vh;
                overflow-y: auto;
            }

            .modal-content h3 {
                margin: 0 0 16px 0;
                color: #212529;
                font-size: 18px;
                text-align: center;
            }

            .order-summary {
                background: #f8f9fa;
                padding: 16px;
                border-radius: 8px;
                margin-bottom: 20px;
                font-size: 14px;
                line-height: 1.5;
            }

            .order-summary-item {
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
            }

            .order-summary-item:last-child {
                margin-bottom: 0;
            }

            .modal-buttons {
                display: flex;
                gap: 12px;
                justify-content: center;
            }

            .btn-confirm {
                background: #28a745;
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
                min-height: 44px;
                flex: 1;
            }

            .btn-confirm:hover {
                background: #1e7e34;
            }

            .btn-cancel {
                background: #6c757d;
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
                min-height: 44px;
                flex: 1;
            }

            .btn-cancel:hover {
                background: #545b62;
            }

            @media (max-width: 768px) {
                .modal-content {
                    padding: 20px;
                    margin: 16px;
                }

                .modal-buttons {
                    flex-direction: column;
                }
            }

            /* ë¡œê·¸ì¸ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
            .login-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            }

            .login-container {
                background: white;
                padding: 32px;
                border-radius: 12px;
                max-width: 90%;
                width: 400px;
                text-align: center;
            }

            .login-container h2 {
                margin: 0 0 24px 0;
                color: #333;
                font-size: 20px;
            }

            .login-input {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 16px;
                margin-bottom: 16px;
                box-sizing: border-box;
            }

            .login-input:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
            }

            .login-btn {
                width: 100%;
                background: #007bff;
                color: white;
                border: none;
                padding: 12px;
                border-radius: 6px;
                font-size: 16px;
                cursor: pointer;
                transition: background-color 0.2s ease;
            }

            .login-btn:hover {
                background: #0056b3;
            }

            .login-error {
                color: #dc3545;
                font-size: 14px;
                margin-top: 12px;
                min-height: 20px;
            }

            .close-btn {
                position: absolute;
                top: 16px;
                right: 16px;
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                color: #666;
                padding: 0;
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .close-btn:hover {
                color: #333;
            }
        </style>
    </head>
    <body>
        <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
        <div id="loginModal" class="login-modal">
            <div class="login-container">
                <button class="close-btn" onclick="closeLoginModal()">
                    &times;
                </button>
                <h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
                <input
                    type="email"
                    id="loginEmail"
                    class="login-input"
                    placeholder="ì´ë©”ì¼ ì£¼ì†Œ"
                    required
                />
                <input
                    type="password"
                    id="loginPassword"
                    class="login-input"
                    placeholder="ë¹„ë°€ë²ˆí˜¸"
                    required
                />
                <button onclick="login()" class="login-btn">ë¡œê·¸ì¸</button>
                <div id="loginError" class="login-error"></div>
            </div>
        </div>

        <div class="wrap">
            <h1>
                <svg
                    class="inline-icon"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                >
                    <path
                        d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h4c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"
                    />
                </svg>
                0000ì…€ëŸ¬ ì£¼ë¬¸ ìˆ˜ì§‘<span
                    id="status"
                    class="status-indicator disconnected"
                ></span>
            </h1>

            <form id="orderForm">
                <div class="field">
                    <label>ì£¼ë¬¸ ìœ í˜• *</label>
                    <div class="radio-group">
                        <div class="radio-row">
                            <label class="radio-item">
                                <input
                                    type="radio"
                                    name="orderType"
                                    value="ì‹ ê·œì£¼ë¬¸"
                                    checked
                                />
                                <span class="radio-custom"></span>
                                <span class="radio-label">ì‹ ê·œì£¼ë¬¸</span>
                            </label>
                            <label class="radio-item">
                                <input
                                    type="radio"
                                    name="orderType"
                                    value="ë°°ì†¡ì¡°íšŒ"
                                />
                                <span class="radio-custom"></span>
                                <span class="radio-label">ë°°ì†¡ì¡°íšŒ</span>
                            </label>
                        </div>
                        <div class="radio-row">
                            <label class="radio-item">
                                <input
                                    type="radio"
                                    name="orderType"
                                    value="êµí™˜"
                                />
                                <span class="radio-custom"></span>
                                <span class="radio-label">êµí™˜</span>
                            </label>
                            <label class="radio-item">
                                <input
                                    type="radio"
                                    name="orderType"
                                    value="ë°˜í’ˆ"
                                />
                                <span class="radio-custom"></span>
                                <span class="radio-label">ë°˜í’ˆ</span>
                            </label>
                            <label class="radio-item">
                                <input
                                    type="radio"
                                    name="orderType"
                                    value="ì·¨ì†Œ"
                                />
                                <span class="radio-custom"></span>
                                <span class="radio-label">ì·¨ì†Œ</span>
                            </label>
                        </div>
                    </div>
                    <div
                        id="processingLimits"
                        style="
                            margin-top: 8px;
                            font-size: 12px;
                            color: #666;
                            line-height: 1.4;
                            display: none;
                        "
                    >
                        <strong>ì²˜ë¦¬ ì œí•œ:</strong><br />
                        â€¢ ì·¨ì†Œ: ì ‘ìˆ˜ ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥<br />
                        â€¢ êµí™˜/ë°˜í’ˆ: ë°°ì†¡ì™„ë£Œ ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥
                    </div>
                </div>

                <div
                    class="field"
                    id="existingOrderField"
                    style="display: none"
                >
                    <label for="existingOrderNumber">ê¸°ì¡´ ì£¼ë¬¸ë²ˆí˜¸ *</label>
                    <input
                        type="text"
                        id="existingOrderNumber"
                        name="existingOrderNumber"
                        placeholder="êµí™˜/ë°˜í’ˆ/ì·¨ì†Œí•  ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                    />
                </div>

                <div class="field">
                    <label for="customerName">ê³ ê°ëª… *</label>
                    <input
                        type="text"
                        id="customerName"
                        name="customerName"
                        placeholder="ì…ê¸ˆìëª… ê³¼ ë™ì¼í•œ ì„±í•¨ì„ ë„£ì–´ì£¼ì„¸ìš”"
                        required
                    />
                </div>

                <div class="field">
                    <label for="phone">ì—°ë½ì²˜ *</label>
                    <input
                        type="tel"
                        id="phone"
                        name="phone"
                        placeholder="010-0000-0000"
                        required
                    />
                </div>

                <div class="field">
                    <label for="product">ìƒí’ˆëª… *</label>
                    <input
                        type="text"
                        id="product"
                        name="product"
                        placeholder="ìƒí’ˆëª…/ì‚¬ì´ì¦ˆ/ìƒ‰ìƒ ìˆœ
 ë¸Œëœë“œ í‹°ì…”ì¸  sì‚¬ì´ì¦ˆ ë¸”ë™"
                        required
                    />
                </div>

                <div class="field">
                    <label for="quantity">ìˆ˜ëŸ‰ *</label>
                    <select id="quantity" name="quantity" required>
                        <option value="" disabled selected>
                            ìˆ˜ëŸ‰ì„ ì„ íƒí•˜ì„¸ìš”
                        </option>
                        <option value="1">1ê°œ</option>
                        <option value="2">2ê°œ</option>
                        <option value="3">3ê°œ</option>
                        <option value="4">4ê°œ</option>
                        <option value="5">5ê°œ</option>
                        <option value="6">6ê°œ</option>
                        <option value="7">7ê°œ</option>
                        <option value="8">8ê°œ</option>
                        <option value="9">9ê°œ</option>
                        <option value="10">10ê°œ</option>
                    </select>
                </div>

                <div class="field">
                    <label for="zipcode">ìš°í¸ë²ˆí˜¸</label>
                    <div class="addr-row">
                        <input
                            type="text"
                            id="zipcode"
                            name="zipcode"
                            placeholder="ìš°í¸ë²ˆí˜¸"
                            readonly
                        />
                        <button type="button" id="btnFindAddr" class="icon-btn">
                            ì£¼ì†Œì°¾ê¸°
                        </button>
                    </div>
                </div>

                <div class="field">
                    <label for="address">ì£¼ì†Œ</label>
                    <input
                        type="text"
                        id="address"
                        name="address"
                        placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                    />
                </div>

                <div class="field">
                    <label for="detailAddress">ìƒì„¸ì£¼ì†Œ</label>
                    <input
                        type="text"
                        id="detailAddress"
                        name="detailAddress"
                        placeholder="ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                    />
                </div>

                <div class="field">
                    <label for="memo">ë°°ì†¡ë©”ì„¸ì§€</label>
                    <input
                        type="text"
                        id="memo"
                        name="memo"
                        placeholder="ë°°ì†¡ ê´€ë ¨ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                    />
                </div>

                <!-- í™˜ë¶ˆ ê³„ì¢Œì •ë³´ ì…ë ¥ì¹¸ (ë°˜í’ˆ/ì·¨ì†Œ ì‹œì—ë§Œ í‘œì‹œ) -->
                <div
                    class="field"
                    id="refundAccountField"
                    style="display: none"
                >
                    <label for="refundAccount">í™˜ë¶ˆë°›ì„ ê³„ì¢Œì •ë³´ *</label>
                    <input
                        type="text"
                        id="refundAccount"
                        name="refundAccount"
                        placeholder="ì€í–‰ëª… - ê³„ì¢Œë²ˆí˜¸ - ì˜ˆê¸ˆì£¼ëª… (ì˜ˆ: ì‹ í•œì€í–‰ - 110-123456789 - í™ê¸¸ë™)"
                    />
                </div>

                <button type="submit" id="btnSubmit">
                    <svg
                        class="inline-icon"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                    >
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>
                    ì£¼ë¬¸ ì ‘ìˆ˜í•˜ê¸°
                </button>
            </form>

            <div id="message" class="msg" style="display: none"></div>

            <!-- ì£¼ë¬¸ ì™„ë£Œ í™•ì¸ ëª¨ë‹¬ -->
            <div id="orderConfirmModal" class="modal" style="display: none">
                <div class="modal-content">
                    <h3>ğŸ“‹ ì£¼ë¬¸ ë‚´ì—­ í™•ì¸</h3>
                    <div id="orderSummary" class="order-summary"></div>
                    <div class="modal-buttons">
                        <button
                            type="button"
                            id="confirmOrder"
                            class="btn-confirm"
                        >
                            ë„¤, ë§ìŠµë‹ˆë‹¤
                        </button>
                        <button
                            type="button"
                            id="cancelOrder"
                            class="btn-cancel"
                        >
                            ìˆ˜ì •í•˜ê¸°
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì£¼ë¬¸ë‚´ì—­ ì €ì¥ í™•ì¸ ëª¨ë‹¬ -->
            <div id="saveOrderModal" class="modal" style="display: none">
                <div class="modal-content">
                    <h3>ğŸ’¾ ì£¼ë¬¸ë‚´ì—­ ì €ì¥</h3>
                    <p>ì£¼ë¬¸ë‚´ì—­ì„ ì•¨ë²”ì— ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                    <div class="modal-buttons">
                        <button
                            type="button"
                            id="saveToAlbum"
                            class="btn-confirm"
                        >
                            ì €ì¥í•˜ê¸°
                        </button>
                        <button type="button" id="skipSave" class="btn-cancel">
                            ê±´ë„ˆë›°ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê´€ë¦¬ì ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨) -->
        <button
            type="button"
            id="btnAdmin"
            class="icon-btn"
            style="
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                width: 40px;
                height: 40px;
            "
        >
            <svg
                class="inline-icon"
                viewBox="0 0 24 24"
                fill="currentColor"
                style="margin: 0"
            >
                <path
                    d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                />
            </svg>
        </button>

        <!-- Simple Footer -->
        <footer class="simple-footer">
            <a href="https://cx-tech-builder.netlify.app/" target="_blank">
                Powered by CX Tech Builder
            </a>
        </footer>

        <!-- ì„¤ì • íŒŒì¼ (Firebase ì„¤ì • ë¡œë“œ) -->
        <script src="config.js"></script>

        <!-- Firebase SDK -->
        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
            import {
                getDatabase,
                ref,
                push,
                onValue,
                get,
            } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

            // Firebase ì„¤ì •ì€ ì´ë¯¸ headì—ì„œ ì´ˆê¸°í™”ë¨
            const database = getDatabase(window.app);

            // DOM ìš”ì†Œë“¤
            const statusDiv = document.getElementById("status");
            const orderForm = document.getElementById("orderForm");
            const messageDiv = document.getElementById("message");
            const btnAdmin = document.getElementById("btnAdmin");

            // ì—°ê²° ìƒíƒœ í™•ì¸
            const connectedRef = ref(database, ".info/connected");
            onValue(connectedRef, (snap) => {
                if (snap.val() === true) {
                    statusDiv.className = "status-indicator connected";
                } else {
                    statusDiv.className = "status-indicator disconnected";
                }
            });

            // ì£¼ë¬¸ ì ‘ìˆ˜ ì²˜ë¦¬
            orderForm.addEventListener("submit", async (e) => {
                e.preventDefault();

                const submitBtn = document.getElementById("btnSubmit");
                submitBtn.disabled = true;
                submitBtn.textContent = "ğŸ“¤ ì£¼ë¬¸ ì ‘ìˆ˜ ì¤‘...";

                try {
                    const formData = new FormData(orderForm);
                    const orderType = formData.get("orderType");
                    const existingOrderNumber = formData.get(
                        "existingOrderNumber"
                    );
                    const phone = formData.get("phone");

                    // êµí™˜/ë°˜í’ˆ/ì·¨ì†Œì¸ ê²½ìš° ê¸°ì¡´ ì£¼ë¬¸ ë§¤ì¹­ ê²€ì¦ ë° ìƒíƒœ í™•ì¸
                    if (orderType !== "ì‹ ê·œì£¼ë¬¸") {
                        const existingOrder = await findExistingOrder(
                            existingOrderNumber,
                            phone
                        );
                        if (!existingOrder) {
                            showMessage(
                                "âŒ ê¸°ì¡´ ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì£¼ë¬¸ë²ˆí˜¸ì™€ íœ´ëŒ€í°ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.",
                                "error"
                            );
                            return;
                        }

                        // ì£¼ë¬¸ ìƒíƒœì— ë”°ë¥¸ ì²˜ë¦¬ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
                        const statusCheck = await checkOrderStatusForClaim(
                            existingOrderNumber,
                            orderType
                        );
                        if (!statusCheck.canProcess) {
                            showMessage(`âŒ ${statusCheck.reason}`, "error");
                            return;
                        }

                        // ë°˜í’ˆ/ì·¨ì†Œ ì‹œ í™˜ë¶ˆ ê³„ì¢Œì •ë³´ í•„ìˆ˜ ì…ë ¥ í™•ì¸
                        if (
                            (orderType === "ë°˜í’ˆ" || orderType === "ì·¨ì†Œ") &&
                            !formData.get("refundAccount")
                        ) {
                            showMessage(
                                "âŒ í™˜ë¶ˆë°›ì„ ê³„ì¢Œì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.",
                                "error"
                            );
                            return;
                        }
                    }

                    // ì£¼ë¬¸ ë‚´ì—­ ìƒì„±
                    const orderData = {
                        customerName: formData.get("customerName"),
                        phone: formData.get("phone"),
                        product: formData.get("product"),
                        quantity: parseInt(formData.get("quantity")),
                        orderType: orderType,
                        existingOrderNumber: existingOrderNumber || null,
                        zipcode: formData.get("zipcode"),
                        address: formData.get("address"),
                        detailAddress: formData.get("detailAddress"),
                        memo: formData.get("memo"),
                        refundAccount: formData.get("refundAccount") || null,
                        status: getStatusByOrderType(orderType),
                        createdAt: Date.now(),
                        orderNumber: generateOrderNumber(),
                    };

                    // ì£¼ë¬¸ ë‚´ì—­ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
                    showOrderConfirmModal(orderData);
                } catch (error) {
                    console.error("ì£¼ë¬¸ ì ‘ìˆ˜ ì˜¤ë¥˜:", error);
                    showMessage(
                        "âŒ ì£¼ë¬¸ ì ‘ìˆ˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                        "error"
                    );
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = "ğŸ“¦ ì£¼ë¬¸ ì ‘ìˆ˜í•˜ê¸°";
                }
            });

            // ê¸°ì¡´ ì£¼ë¬¸ ê²€ìƒ‰ (ì›”ë³„ í´ë” êµ¬ì¡°ì—ì„œ ê²€ìƒ‰)
            async function findExistingOrder(orderNumber, phone = "") {
                try {
                    const ordersRef = ref(database, "orders");
                    const snapshot = await get(ordersRef);
                    const data = snapshot.val();

                    if (!data) return null;

                    // ëª¨ë“  ì›”ë³„ í´ë”ì—ì„œ ì£¼ë¬¸ ê²€ìƒ‰
                    let allOrders = [];
                    for (const [yearMonth, monthOrders] of Object.entries(
                        data
                    )) {
                        if (monthOrders && typeof monthOrders === "object") {
                            const monthOrderEntries =
                                Object.entries(monthOrders);
                            allOrders = allOrders.concat(monthOrderEntries);
                        }
                    }
                    let existingOrder;

                    if (phone) {
                        // íœ´ëŒ€í°ë²ˆí˜¸ì™€ ì£¼ë¬¸ë²ˆí˜¸ ëª¨ë‘ë¡œ ê²€ìƒ‰ (ì£¼ë¬¸ ì ‘ìˆ˜ ì‹œ)
                        existingOrder = allOrders.find(
                            ([id, order]) =>
                                order.orderNumber === orderNumber &&
                                order.phone === phone
                        );
                    } else {
                        // ì£¼ë¬¸ë²ˆí˜¸ë§Œìœ¼ë¡œ ê²€ìƒ‰ (ìë™ ì •ë³´ ë¡œë“œ ì‹œ)
                        existingOrder = allOrders.find(
                            ([id, order]) => order.orderNumber === orderNumber
                        );
                    }

                    return existingOrder ? existingOrder[1] : null;
                } catch (error) {
                    console.error("ê¸°ì¡´ ì£¼ë¬¸ ê²€ìƒ‰ ì˜¤ë¥˜:", error);
                    return null;
                }
            }

            // ì£¼ë¬¸ ìœ í˜•ì— ë”°ë¥¸ ìƒíƒœ ì„¤ì •
            function getStatusByOrderType(orderType) {
                // ëª¨ë“  ì ‘ìˆ˜ëŠ” "ì ‘ìˆ˜"ë¡œ í†µì¼ (ì£¼ë¬¸ìœ í˜•ìœ¼ë¡œ êµ¬ë¶„)
                return "ì ‘ìˆ˜";
            }

            // ì£¼ë¬¸ë²ˆí˜¸ ìƒì„±
            function generateOrderNumber() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, "0");
                const day = String(now.getDate()).padStart(2, "0");
                const hours = String(now.getHours()).padStart(2, "0");
                const minutes = String(now.getMinutes()).padStart(2, "0");
                const seconds = String(now.getSeconds()).padStart(2, "0");

                return `ORD${year}${month}${day}${hours}${minutes}${seconds}`;
            }

            // ì£¼ë¬¸ ë‚´ì—­ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
            function showOrderConfirmModal(orderData) {
                const modal = document.getElementById("orderConfirmModal");
                const summary = document.getElementById("orderSummary");

                summary.innerHTML = `
                    <div class="order-summary-item">
                        <span>ê³ ê°ëª…:</span>
                        <span>${orderData.customerName}</span>
                    </div>
                    <div class="order-summary-item">
                        <span>ì—°ë½ì²˜:</span>
                        <span>${orderData.phone}</span>
                    </div>
                    <div class="order-summary-item">
                        <span>ìƒí’ˆëª…:</span>
                        <span>${orderData.product}</span>
                    </div>
                    <div class="order-summary-item">
                        <span>ìˆ˜ëŸ‰:</span>
                        <span>${orderData.quantity}ê°œ</span>
                    </div>
                    <div class="order-summary-item">
                        <span>ì£¼ë¬¸ ìœ í˜•:</span>
                        <span>${orderData.orderType}</span>
                    </div>
                    ${
                        orderData.address
                            ? `
                    <div class="order-summary-item">
                        <span>ì£¼ì†Œ:</span>
                        <span>${orderData.address} ${
                                  orderData.detailAddress || ""
                              }</span>
                    </div>
                    `
                            : ""
                    }
                    ${
                        orderData.memo
                            ? `
                    <div class="order-summary-item">
                        <span>ë©”ëª¨:</span>
                        <span>${orderData.memo}</span>
                    </div>
                    `
                            : ""
                    }
                    ${
                        orderData.refundAccount
                            ? `
                    <div class="order-summary-item">
                        <span>í™˜ë¶ˆ ê³„ì¢Œì •ë³´:</span>
                        <span>${orderData.refundAccount}</span>
                    </div>
                    `
                            : ""
                    }
                    <div class="order-summary-item">
                        <span>ì…ê¸ˆê³„ì¢Œ:</span>
                        <span>0000-0000-0000-0000 (0000ì…€ëŸ¬)</span>
                    </div>
                `;

                modal.style.display = "flex";

                // ëª¨ë‹¬ì— ì£¼ë¬¸ ë°ì´í„° ì €ì¥
                modal.orderData = orderData;
            }

            // ì£¼ë¬¸ë‚´ì—­ ì €ì¥ ëª¨ë‹¬ í‘œì‹œ
            function showSaveOrderModal(orderData) {
                const modal = document.getElementById("saveOrderModal");
                modal.style.display = "flex";
                modal.orderData = orderData;
            }

            // ì£¼ë¬¸ë‚´ì—­ì„ ì´ë¯¸ì§€ë¡œ ìƒì„±
            function generateOrderImage(orderData) {
                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");

                canvas.width = 400;
                canvas.height = 600;

                // ë°°ê²½
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(0, 0, 400, 600);

                // ì œëª©
                ctx.fillStyle = "#333333";
                ctx.font = "bold 24px Arial";
                ctx.textAlign = "center";
                ctx.fillText("ì£¼ë¬¸ ë‚´ì—­", 200, 40);

                // ì£¼ë¬¸ ì •ë³´
                ctx.font = "16px Arial";
                ctx.textAlign = "left";
                let y = 80;

                const items = [
                    `ì£¼ë¬¸ë²ˆí˜¸: ${orderData.orderNumber}`,
                    `ê³ ê°ëª…: ${orderData.customerName}`,
                    `ì—°ë½ì²˜: ${orderData.phone}`,
                    `ìƒí’ˆëª…: ${orderData.product}`,
                    `ìˆ˜ëŸ‰: ${orderData.quantity}ê°œ`,
                    `ì£¼ë¬¸ ìœ í˜•: ${orderData.orderType}`,
                    `ì£¼ë¬¸ ì‹œê°„: ${new Date(orderData.createdAt).toLocaleString(
                        "ko-KR"
                    )}`,
                    `ì…ê¸ˆê³„ì¢Œ: 0000-0000-0000-0000 (0000ì…€ëŸ¬)`,
                ];

                if (orderData.address) {
                    items.push(
                        `ì£¼ì†Œ: ${orderData.address} ${
                            orderData.detailAddress || ""
                        }`
                    );
                }
                if (orderData.memo) {
                    items.push(`ë©”ëª¨: ${orderData.memo}`);
                }
                if (orderData.refundAccount) {
                    items.push(`í™˜ë¶ˆ ê³„ì¢Œì •ë³´: ${orderData.refundAccount}`);
                }

                items.forEach((item) => {
                    ctx.fillText(item, 20, y);
                    y += 30;
                });

                return canvas.toDataURL("image/png");
            }

            // ë©”ì‹œì§€ í‘œì‹œ
            function showMessage(text, type) {
                messageDiv.textContent = text;
                messageDiv.className = `msg ${type}`;
                messageDiv.style.display = "block";

                setTimeout(() => {
                    messageDiv.style.display = "none";
                }, 5000);
            }

            // ì—°ë½ì²˜ ìë™ í¬ë§·íŒ…
            const phoneInput = document.getElementById("phone");
            phoneInput.addEventListener("input", function (e) {
                let value = e.target.value.replace(/[^0-9]/g, ""); // ìˆ«ìë§Œ ì¶”ì¶œ

                if (value.length <= 3) {
                    e.target.value = value;
                } else if (value.length <= 7) {
                    e.target.value = value.slice(0, 3) + "-" + value.slice(3);
                } else {
                    e.target.value =
                        value.slice(0, 3) +
                        "-" +
                        value.slice(3, 7) +
                        "-" +
                        value.slice(7, 11);
                }
            });

            // ì£¼ë¬¸ ìœ í˜• ë³€ê²½ ì‹œ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€ (ì„±ëŠ¥ ìµœì í™”)
            const orderTypeRadios = document.querySelectorAll(
                'input[name="orderType"]'
            );
            const existingOrderField =
                document.getElementById("existingOrderField");
            const existingOrderInput = document.getElementById(
                "existingOrderNumber"
            );

            // ì£¼ë¬¸ ìƒíƒœì— ë”°ë¥¸ êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ì²˜ë¦¬ ì œí•œ í•¨ìˆ˜
            async function checkOrderStatusForClaim(orderNumber, claimType) {
                try {
                    const ordersRef = ref(database, "orders");
                    const snapshot = await get(ordersRef);
                    const data = snapshot.val();

                    if (!data)
                        return {
                            canProcess: false,
                            reason: "ì£¼ë¬¸ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
                        };

                    // ì›”ë³„ í´ë” êµ¬ì¡°ì—ì„œ ëª¨ë“  ì£¼ë¬¸ ê²€ìƒ‰
                    let allOrders = [];
                    for (const [yearMonth, monthOrders] of Object.entries(
                        data
                    )) {
                        if (monthOrders && typeof monthOrders === "object") {
                            const monthOrderEntries =
                                Object.entries(monthOrders);
                            allOrders = allOrders.concat(monthOrderEntries);
                        }
                    }

                    // í•´ë‹¹ ì£¼ë¬¸ë²ˆí˜¸ë¡œ ì›ë³¸ ì£¼ë¬¸ ì°¾ê¸°
                    const originalOrder = allOrders.find(
                        ([id, order]) => order.orderNumber === orderNumber
                    );

                    if (!originalOrder) {
                        return {
                            canProcess: false,
                            reason: "í•´ë‹¹ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
                        };
                    }

                    const status = originalOrder[1].status;

                    // ì·¨ì†ŒëŠ” ì ‘ìˆ˜ ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥
                    if (claimType === "ì·¨ì†Œ") {
                        if (status !== "ì ‘ìˆ˜") {
                            return {
                                canProcess: false,
                                reason: `ì·¨ì†ŒëŠ” ì ‘ìˆ˜ ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. (í˜„ì¬ ìƒíƒœ: ${status})`,
                            };
                        }
                    }

                    // êµí™˜/ë°˜í’ˆì€ ë°°ì†¡ì™„ë£Œ ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥
                    if (claimType === "êµí™˜" || claimType === "ë°˜í’ˆ") {
                        if (status !== "ë°°ì†¡ì™„ë£Œ") {
                            return {
                                canProcess: false,
                                reason: `êµí™˜/ë°˜í’ˆì€ ë°°ì†¡ì™„ë£Œ ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. (í˜„ì¬ ìƒíƒœ: ${status})`,
                            };
                        }
                    }

                    return { canProcess: true };
                } catch (error) {
                    console.error("ì£¼ë¬¸ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:", error);
                    return {
                        canProcess: false,
                        reason: "ì£¼ë¬¸ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
                    };
                }
            }

            // êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ì‹œ ìˆ¨ê¸¸ í•„ë“œë“¤
            const customerNameField = document.querySelector(
                ".field:nth-child(3)"
            ); // ê³ ê°ëª…
            const phoneField = document.querySelector(".field:nth-child(4)"); // ì—°ë½ì²˜
            const zipcodeField = document.querySelector(".field:nth-child(7)"); // ìš°í¸ë²ˆí˜¸
            const addressField = document.querySelector(".field:nth-child(8)"); // ì£¼ì†Œ
            const detailAddressField = document.querySelector(
                ".field:nth-child(9)"
            ); // ìƒì„¸ì£¼ì†Œ
            const memoField = document.querySelector(".field:nth-child(10)"); // ìš”ì²­ì‚¬í•­
            const refundAccountField =
                document.getElementById("refundAccountField"); // í™˜ë¶ˆ ê³„ì¢Œì •ë³´

            // ìƒí’ˆ/ìˆ˜ëŸ‰ í•„ë“œ DOM
            const productField = document
                .getElementById("product")
                ?.closest(".field");
            const quantityField = document
                .getElementById("quantity")
                ?.closest(".field");

            orderTypeRadios.forEach((radio) => {
                radio.addEventListener("change", async function () {
                    const memoLabel =
                        document.querySelector('label[for="memo"]');
                    const memoInput = document.getElementById("memo");
                    const customerNameInput =
                        document.getElementById("customerName");
                    const phoneInputEl = document.getElementById("phone");
                    const productInput = document.getElementById("product");
                    const quantityInput = document.getElementById("quantity");
                    const submitBtn = document.getElementById("btnSubmit");

                    // ì²˜ë¦¬ ì œí•œ ì•ˆë‚´ ìˆ¨ê¹€
                    const processingLimits =
                        document.getElementById("processingLimits");

                    if (this.value === "ë°°ì†¡ì¡°íšŒ") {
                        // ë°°ì†¡ì¡°íšŒ: ì£¼ë¬¸ë²ˆí˜¸ë§Œ ì…ë ¥, ë‚˜ë¨¸ì§€ëŠ” ìˆ¨ê¹€
                        existingOrderField.style.display = "block";
                        existingOrderInput.required = true;

                        customerNameField.style.display = "none";
                        phoneField.style.display = "none";
                        zipcodeField.style.display = "none";
                        addressField.style.display = "none";
                        detailAddressField.style.display = "none";
                        memoField.style.display = "none";
                        refundAccountField.style.display = "none";
                        if (productField) productField.style.display = "none";
                        if (quantityField) quantityField.style.display = "none";

                        // í•„ìˆ˜ í•´ì œ
                        if (customerNameInput)
                            customerNameInput.required = false;
                        if (phoneInputEl) phoneInputEl.required = false;
                        if (productInput) productInput.required = false;
                        if (quantityInput) quantityInput.required = false;

                        existingOrderInput.placeholder =
                            "ë°°ì†¡ì¡°íšŒí•  ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”";
                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.textContent = "ğŸ” ë°°ì†¡ì¡°íšŒí•˜ê¸°";
                        }
                        return;
                    }

                    if (this.value !== "ì‹ ê·œì£¼ë¬¸") {
                        // êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ì‹œ - ê¸°ì¡´ ì£¼ë¬¸ë²ˆí˜¸ í•„ë“œ í‘œì‹œ
                        existingOrderField.style.display = "block";
                        existingOrderInput.required = true;

                        // ì²˜ë¦¬ ì œí•œ ì•ˆë‚´ í‘œì‹œ
                        processingLimits.style.display = "block";

                        // ê¸°ì¡´ ì£¼ë¬¸ë²ˆí˜¸ê°€ ì…ë ¥ë˜ì–´ ìˆë‹¤ë©´ ìƒíƒœ í™•ì¸
                        const existingOrderNumber =
                            existingOrderInput.value.trim();
                        if (existingOrderNumber) {
                            const statusCheck = await checkOrderStatusForClaim(
                                existingOrderNumber,
                                this.value
                            );
                            if (!statusCheck.canProcess) {
                                showMessage(
                                    `âŒ ${statusCheck.reason}`,
                                    "error"
                                );
                                // ì„ íƒëœ ë¼ë””ì˜¤ ë²„íŠ¼ì„ ê·¸ëŒ€ë¡œ ìœ ì§€ (ë˜ëŒë¦¬ì§€ ì•ŠìŒ)
                                return;
                            }
                        }

                        // ê¸°ì¡´ ì£¼ë¬¸ë²ˆí˜¸, ìƒí’ˆëª…, ìˆ˜ëŸ‰ë§Œ í‘œì‹œ
                        customerNameField.style.display = "none";
                        phoneField.style.display = "none";
                        zipcodeField.style.display = "none";
                        addressField.style.display = "none";
                        detailAddressField.style.display = "none";
                        memoField.style.display = "block"; // ìš”ì²­ì‚¬í•­ì€ í‘œì‹œ (êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ì‚¬ìœ )

                        // ë°˜í’ˆ/ì·¨ì†Œ ì‹œì—ë§Œ í™˜ë¶ˆ ê³„ì¢Œì •ë³´ í‘œì‹œ
                        if (this.value === "ë°˜í’ˆ" || this.value === "ì·¨ì†Œ") {
                            refundAccountField.style.display = "block";
                            document.getElementById(
                                "refundAccount"
                            ).required = true;
                        } else {
                            refundAccountField.style.display = "none";
                            document.getElementById(
                                "refundAccount"
                            ).required = false;
                        }

                        if (productField) productField.style.display = "block";
                        if (quantityField)
                            quantityField.style.display = "block";

                        // í•„ìˆ˜ í•´ì œ (ìˆ¨ê¸´ í•„ë“œë“¤)
                        if (customerNameInput)
                            customerNameInput.required = false;
                        if (phoneInputEl) phoneInputEl.required = false;

                        // ë¼ë²¨ê³¼ í”Œë ˆì´ìŠ¤í™€ë” ë³€ê²½
                        memoLabel.textContent = "ìš”ì²­ì‚¬í•­";
                        memoInput.placeholder =
                            "êµí™˜/ë°˜í’ˆ/ì·¨ì†Œ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”";

                        // í•„ë“œ ì´ˆê¸°í™”
                        document.getElementById("customerName").value = "";
                        document.getElementById("phone").value = "";
                        document.getElementById("address").value = "";
                        document.getElementById("detailAddress").value = "";
                        document.getElementById("memo").value = "";
                        document.getElementById("refundAccount").value = "";

                        // ì œì¶œ ê°€ëŠ¥
                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.textContent = "ğŸ“¦ ì£¼ë¬¸ ì ‘ìˆ˜í•˜ê¸°";
                        }
                    } else {
                        // ì‹ ê·œì£¼ë¬¸ ì‹œ
                        existingOrderField.style.display = "none";
                        existingOrderInput.required = false;
                        existingOrderInput.value = "";

                        // ì²˜ë¦¬ ì œí•œ ì•ˆë‚´ ìˆ¨ê¹€
                        processingLimits.style.display = "none";

                        // ëª¨ë“  í•„ë“œ í‘œì‹œ
                        customerNameField.style.display = "block";
                        phoneField.style.display = "block";
                        zipcodeField.style.display = "block";
                        addressField.style.display = "block";
                        detailAddressField.style.display = "block";
                        memoField.style.display = "block";

                        // í™˜ë¶ˆ ê³„ì¢Œì •ë³´ í•„ë“œ ìˆ¨ê¹€
                        refundAccountField.style.display = "none";
                        document.getElementById(
                            "refundAccount"
                        ).required = false;

                        if (productField) productField.style.display = "block";
                        if (quantityField)
                            quantityField.style.display = "block";
                        // í•„ìˆ˜ ë³µì›
                        if (customerNameInput)
                            customerNameInput.required = true;
                        if (phoneInputEl) phoneInputEl.required = true;
                        if (productInput) productInput.required = true;
                        if (quantityInput) quantityInput.required = true;

                        // ë¼ë²¨ê³¼ í”Œë ˆì´ìŠ¤í™€ë” ë³€ê²½
                        memoLabel.textContent = "ë°°ì†¡ë©”ì„¸ì§€";
                        memoInput.placeholder =
                            "ë°°ì†¡ ê´€ë ¨ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”";
                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.textContent = "ğŸ“¦ ì£¼ë¬¸ ì ‘ìˆ˜í•˜ê¸°";
                        }
                    }
                });
            });

            // ê¸°ì¡´ ì£¼ë¬¸ë²ˆí˜¸ ì…ë ¥ ì‹œ ìë™ ì •ë³´ ë¡œë“œ ë° ìƒíƒœ í™•ì¸ (ë°°ì†¡ì¡°íšŒ ì œì™¸)
            document
                .getElementById("existingOrderNumber")
                .addEventListener("blur", async function () {
                    const orderNumber = this.value.trim();
                    const orderType = document.querySelector(
                        'input[name="orderType"]:checked'
                    ).value;

                    // êµí™˜/ë°˜í’ˆ/ì·¨ì†Œì¸ ê²½ìš° ì£¼ë¬¸ ìƒíƒœ í™•ì¸
                    if (
                        orderNumber &&
                        orderType !== "ì‹ ê·œì£¼ë¬¸" &&
                        orderType !== "ë°°ì†¡ì¡°íšŒ"
                    ) {
                        const statusCheck = await checkOrderStatusForClaim(
                            orderNumber,
                            orderType
                        );
                        if (!statusCheck.canProcess) {
                            showMessage(`âŒ ${statusCheck.reason}`, "error");
                            // ì„ íƒëœ ì£¼ë¬¸ìœ í˜•ì„ ê·¸ëŒ€ë¡œ ìœ ì§€ (ë˜ëŒë¦¬ì§€ ì•ŠìŒ)
                            return;
                        }
                    }

                    if (
                        orderNumber &&
                        orderType !== "ì‹ ê·œì£¼ë¬¸" &&
                        orderType !== "ë°°ì†¡ì¡°íšŒ"
                    ) {
                        try {
                            const existingOrder = await findExistingOrder(
                                orderNumber,
                                ""
                            );
                            if (existingOrder) {
                                // ê¸°ì¡´ ì£¼ë¬¸ ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ì±„ì›Œì¤Œ
                                document.getElementById("customerName").value =
                                    existingOrder.customerName;
                                document.getElementById("phone").value =
                                    existingOrder.phone;
                                document.getElementById("product").value =
                                    existingOrder.product;
                                document.getElementById("quantity").value =
                                    existingOrder.quantity;
                                document.getElementById("address").value =
                                    existingOrder.address || "";
                                document.getElementById("detailAddress").value =
                                    existingOrder.detailAddress || "";

                                // ê¸°ì¡´ ì£¼ë¬¸ì˜ ë°°ì†¡ë©”ì„¸ì§€ë¥¼ ìš”ì²­ì‚¬í•­ì— ìë™ìœ¼ë¡œ ì±„ì›Œì¤Œ
                                if (existingOrder.memo) {
                                    document.getElementById(
                                        "memo"
                                    ).value = `[ê¸°ì¡´ì£¼ë¬¸] ${existingOrder.memo}`;
                                }

                                // ì„±ê³µ ë©”ì‹œì§€
                                showMessage(
                                    `âœ… ê¸°ì¡´ ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. (${existingOrder.customerName}ë‹˜)`,
                                    "success"
                                );
                            } else {
                                showMessage(
                                    "âŒ í•´ë‹¹ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
                                    "error"
                                );
                            }
                        } catch (error) {
                            console.error("ê¸°ì¡´ ì£¼ë¬¸ ê²€ìƒ‰ ì˜¤ë¥˜:", error);
                        }
                    }
                });

            // ì£¼ì†Œ ì°¾ê¸° ê¸°ëŠ¥ (Daum ìš°í¸ë²ˆí˜¸ API)
            document
                .getElementById("btnFindAddr")
                .addEventListener("click", function () {
                    new daum.Postcode({
                        oncomplete: function (data) {
                            document.getElementById("zipcode").value =
                                data.zonecode;
                            document.getElementById("address").value =
                                data.address;
                            document.getElementById("detailAddress").focus();
                        },
                    }).open();
                });

            // ì£¼ë¬¸ í™•ì¸ ëª¨ë‹¬ ì´ë²¤íŠ¸
            document
                .getElementById("confirmOrder")
                .addEventListener("click", async function () {
                    const modal = document.getElementById("orderConfirmModal");
                    const orderData = modal.orderData;

                    try {
                        // Firebaseì— ì£¼ë¬¸ ì €ì¥ (ì›”ë³„ í´ë” êµ¬ì¡°)
                        const now = new Date();
                        const yearMonth = `${now.getFullYear()}-${String(
                            now.getMonth() + 1
                        ).padStart(2, "0")}`;
                        const ordersRef = ref(database, `orders/${yearMonth}`);
                        await push(ordersRef, orderData);

                        // ëª¨ë‹¬ ë‹«ê¸°
                        modal.style.display = "none";

                        // ì£¼ë¬¸ë‚´ì—­ ì €ì¥ ëª¨ë‹¬ í‘œì‹œ
                        showSaveOrderModal(orderData);
                    } catch (error) {
                        console.error("ì£¼ë¬¸ ì €ì¥ ì˜¤ë¥˜:", error);
                        showMessage(
                            "âŒ ì£¼ë¬¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
                            "error"
                        );
                    }
                });

            // ë°°ì†¡ì¡°íšŒ ì²˜ë¦¬
            document
                .getElementById("btnSubmit")
                .addEventListener("click", async function (e) {
                    const orderType = document.querySelector(
                        'input[name="orderType"]:checked'
                    ).value;

                    if (orderType === "ë°°ì†¡ì¡°íšŒ") {
                        e.preventDefault(); // í¼ ì œì¶œ ë°©ì§€

                        const orderNumber = document
                            .getElementById("existingOrderNumber")
                            .value.trim();
                        if (!orderNumber) {
                            showMessage("âŒ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
                            return;
                        }

                        try {
                            // ì •í™•í•œ ì£¼ë¬¸ë²ˆí˜¸ë¡œ ê²€ìƒ‰ (ë¶€ë¶„ ì¼ì¹˜ê°€ ì•„ë‹Œ ì™„ì „ ì¼ì¹˜)
                            const existingOrder = await findExistingOrder(
                                orderNumber,
                                ""
                            );
                            if (existingOrder) {
                                // ì£¼ë¬¸ë²ˆí˜¸ê°€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
                                if (existingOrder.orderNumber !== orderNumber) {
                                    showMessage(
                                        "âŒ ì£¼ë¬¸ë²ˆí˜¸ê°€ ì •í™•íˆ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
                                        "error"
                                    );
                                    return;
                                }

                                const canShow =
                                    existingOrder.status === "ë°°ì†¡ì¤‘" ||
                                    existingOrder.status === "ë°°ì†¡ì™„ë£Œ";
                                if (
                                    canShow &&
                                    (existingOrder.invoiceNumber ||
                                        existingOrder.courier)
                                ) {
                                    showMessage(
                                        `ğŸ“¦ íƒë°°ì‚¬: ${
                                            existingOrder.courier || "-"
                                        } / ì†¡ì¥ë²ˆí˜¸: ${
                                            existingOrder.invoiceNumber || "-"
                                        }`,
                                        "info"
                                    );
                                } else {
                                    showMessage(
                                        "ğŸšš ì•„ì§ ë°°ì†¡ì •ë³´ê°€ ì—†ê±°ë‚˜ ì†¡ì¥ ë¯¸ë“±ë¡ ìƒíƒœì…ë‹ˆë‹¤.",
                                        "warning"
                                    );
                                }
                            } else {
                                showMessage(
                                    "âŒ í•´ë‹¹ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
                                    "error"
                                );
                            }
                        } catch (error) {
                            console.error("ë°°ì†¡ì¡°íšŒ ì˜¤ë¥˜:", error);
                            showMessage(
                                "âŒ ë°°ì†¡ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
                                "error"
                            );
                        }
                        return;
                    }

                    // ë‹¤ë¥¸ ì£¼ë¬¸ ìœ í˜•ì€ ê¸°ì¡´ ë¡œì§ìœ¼ë¡œ ì§„í–‰
                    showOrderConfirmModal();
                });

            document
                .getElementById("cancelOrder")
                .addEventListener("click", function () {
                    document.getElementById("orderConfirmModal").style.display =
                        "none";
                });

            // ì£¼ë¬¸ë‚´ì—­ ì €ì¥ ëª¨ë‹¬ ì´ë²¤íŠ¸
            document
                .getElementById("saveToAlbum")
                .addEventListener("click", function () {
                    const modal = document.getElementById("saveOrderModal");
                    const orderData = modal.orderData;

                    try {
                        // ì£¼ë¬¸ë‚´ì—­ì„ ì´ë¯¸ì§€ë¡œ ìƒì„±
                        const imageData = generateOrderImage(orderData);

                        // PC/ëª¨ë°”ì¼ í™˜ê²½ë³„ ì´ë¯¸ì§€ ì €ì¥ í•¨ìˆ˜
                        async function saveImageToAlbum() {
                            try {
                                // Canvasë¥¼ Blobìœ¼ë¡œ ë³€í™˜
                                const canvas = document.createElement("canvas");
                                const ctx = canvas.getContext("2d");
                                const img = new Image();

                                img.onload = function () {
                                    canvas.width = img.width;
                                    canvas.height = img.height;
                                    ctx.drawImage(img, 0, 0);

                                    canvas.toBlob(async function (blob) {
                                        try {
                                            // PC í™˜ê²½ ê°ì§€ (ëª¨ë°”ì¼ì´ ì•„ë‹Œ ê²½ìš°)
                                            const isPC =
                                                !/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
                                                    navigator.userAgent
                                                );

                                            if (isPC) {
                                                // PC í™˜ê²½: ë°”ë¡œ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥
                                                const link =
                                                    document.createElement("a");
                                                link.download = `ì£¼ë¬¸ë‚´ì—­_${orderData.orderNumber}.png`;
                                                link.href = imageData;
                                                link.click();
                                                showMessage(
                                                    "âœ… ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.",
                                                    "success"
                                                );
                                                return;
                                            }

                                            // ëª¨ë°”ì¼ í™˜ê²½: ê¸°ì¡´ ë°©ì‹ ìœ ì§€
                                            // ëª¨ë°”ì¼ì—ì„œ ê³µìœ  API ì‚¬ìš© (iOS/Android)
                                            if (
                                                navigator.share &&
                                                navigator.canShare
                                            ) {
                                                const file = new File(
                                                    [blob],
                                                    `ì£¼ë¬¸ë‚´ì—­_${orderData.orderNumber}.png`,
                                                    { type: "image/png" }
                                                );

                                                if (
                                                    navigator.canShare({
                                                        files: [file],
                                                    })
                                                ) {
                                                    await navigator.share({
                                                        files: [file],
                                                        title: "ì£¼ë¬¸ë‚´ì—­",
                                                        text: "ì£¼ë¬¸ë‚´ì—­ ì´ë¯¸ì§€",
                                                    });
                                                    showMessage(
                                                        "âœ… ì´ë¯¸ì§€ë¥¼ ê³µìœ í–ˆìŠµë‹ˆë‹¤. ì•¨ë²”ì— ì €ì¥í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì•±ìœ¼ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                                                        "success"
                                                    );
                                                    return;
                                                }
                                            }

                                            // ê³µìœ  APIê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” ê²½ìš° ëŒ€ì²´ ë°©ë²•
                                            if (
                                                /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
                                                    navigator.userAgent
                                                )
                                            ) {
                                                // ëª¨ë°”ì¼ í™˜ê²½ - ìƒˆ ì°½ì—ì„œ ì´ë¯¸ì§€ ì—´ê¸°
                                                const url =
                                                    URL.createObjectURL(blob);
                                                const newWindow =
                                                    window.open(url);
                                                if (newWindow) {
                                                    showMessage(
                                                        "âœ… ì´ë¯¸ì§€ê°€ ìƒˆ ì°½ì—ì„œ ì—´ë ¸ìŠµë‹ˆë‹¤. ê¸¸ê²Œ ëˆŒëŸ¬ì„œ 'ì´ë¯¸ì§€ ì €ì¥'ì„ ì„ íƒí•˜ì„¸ìš”.",
                                                        "success"
                                                    );
                                                } else {
                                                    // íŒì—… ì°¨ë‹¨ëœ ê²½ìš° ë‹¤ìš´ë¡œë“œ
                                                    const link =
                                                        document.createElement(
                                                            "a"
                                                        );
                                                    link.href = url;
                                                    link.download = `ì£¼ë¬¸ë‚´ì—­_${orderData.orderNumber}.png`;
                                                    link.click();
                                                    showMessage(
                                                        "âœ… ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œ í´ë”ì—ì„œ í™•ì¸í•˜ì„¸ìš”.",
                                                        "success"
                                                    );
                                                }
                                                setTimeout(
                                                    () =>
                                                        URL.revokeObjectURL(
                                                            url
                                                        ),
                                                    1000
                                                );
                                            }
                                        } catch (shareError) {
                                            console.error(
                                                "ê³µìœ  ì˜¤ë¥˜:",
                                                shareError
                                            );
                                            // ê³µìœ  ì‹¤íŒ¨ ì‹œ ì¼ë°˜ ë‹¤ìš´ë¡œë“œ
                                            const link =
                                                document.createElement("a");
                                            link.download = `ì£¼ë¬¸ë‚´ì—­_${orderData.orderNumber}.png`;
                                            link.href = imageData;
                                            link.click();
                                            showMessage(
                                                "âœ… ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.",
                                                "success"
                                            );
                                        }
                                    }, "image/png");
                                };

                                img.src = imageData;
                            } catch (error) {
                                console.error("ì•¨ë²” ì €ì¥ ì˜¤ë¥˜:", error);
                                // ëŒ€ì²´ ë°©ë²•: ì¼ë°˜ ë‹¤ìš´ë¡œë“œ
                                const link = document.createElement("a");
                                link.download = `ì£¼ë¬¸ë‚´ì—­_${orderData.orderNumber}.png`;
                                link.href = imageData;
                                link.click();
                                showMessage(
                                    "âœ… ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.",
                                    "success"
                                );
                            }
                        }

                        // ì´ë¯¸ì§€ ì €ì¥ ì‹¤í–‰
                        saveImageToAlbum();

                        // ëª¨ë‹¬ ë‹«ê¸°
                        modal.style.display = "none";

                        // í¼ ì´ˆê¸°í™”
                        orderForm.reset();
                        showMessage(
                            "âœ… ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!",
                            "success"
                        );
                    } catch (error) {
                        console.error("ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:", error);
                        showMessage(
                            "âŒ ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
                            "error"
                        );
                    }
                });

            document
                .getElementById("skipSave")
                .addEventListener("click", function () {
                    const modal = document.getElementById("saveOrderModal");
                    modal.style.display = "none";

                    // í¼ ì´ˆê¸°í™” ë° ì„±ê³µ ë©”ì‹œì§€
                    orderForm.reset();
                    showMessage(
                        "âœ… ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!",
                        "success"
                    );
                });

            // ê´€ë¦¬ì í˜ì´ì§€ ì—´ê¸° (PIN ëŒ€ì‹  ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ)
            btnAdmin.addEventListener("click", function () {
                window.isAdminLoginFlow = true;
                document.getElementById("loginModal").style.display = "flex";
            });

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì£¼ì†Œ API ë¡œë“œ
            window.addEventListener("load", function () {
                if (typeof daum === "undefined") {
                    const script = document.createElement("script");
                    script.src =
                        "//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js";
                    document.head.appendChild(script);
                }
            });

            // Enter í‚¤ë¡œ ë¡œê·¸ì¸
            document
                .getElementById("loginPassword")
                .addEventListener("keypress", function (e) {
                    if (e.key === "Enter") {
                        login();
                    }
                });

            // ë¡œê·¸ì¸ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
            window.closeLoginModal = function () {
                document.getElementById("loginModal").style.display = "none";
                document.getElementById("loginEmail").value = "";
                document.getElementById("loginPassword").value = "";
                document.getElementById("loginError").textContent = "";
            };
        </script>
    </body>
</html>
